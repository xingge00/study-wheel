var ze=Object.defineProperty;var He=(o,n,t)=>n in o?ze(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t;var $e=(o,n,t)=>(He(o,typeof n!="symbol"?n+"":n,t),t);import{a as Ke,d as qe,l as ce,i as fe,c as Ge,_ as We,w as Xe}from"./base-083a4d6e.js";import{i as Ce,a as Ye,b as Je,d as Ze,c as Qe,E as Ae}from"./el-button-9ed51a92.js";import{l as me,A as xe,v as S,r as B,d as se,k as Te,o as v,c as $,L as x,i as s,E as O,R as et,C as A,w as R,D as te,G as T,V as H,b as P,H as Q,S as ee,j as ie,n as tt,ar as Ve,_ as z,$ as de,t as U,M as Y,F,B as q,a as j,U as Z,a0 as ve,as as J,a4 as Ee,am as nt,an as at,Q as pe,at as Le,Z as ot,a2 as st,a8 as lt,I as ae}from"./index-e8c6a594.js";import{C as Ne}from"./index-e8a169f3.js";import{E as rt,a as ct}from"./el-tab-pane-e85b091e.js";import{E as ut,a as it}from"./el-form-item-d404711e.js";import{E as dt,a as vt}from"./el-radio-button-b52bbe4e.js";import{E as pt}from"./el-input-fb643135.js";import{u as ft,f as mt,E as re,l as ht}from"./index-e1070bac.js";import{i as _t}from"./validator-cdc3f740.js";import{U as he,C as _e,I as ge,d as gt,t as yt}from"./event-e06a23af.js";import"./index-77d8bc5e.js";import"./get-e7313515.js";import"./index-26922a77.js";import"./typescript-defaf979.js";import"./strings-743a323d.js";import"./aria-60e0cdc6.js";import"./vnode-998e830d.js";import"./objects-6348cf70.js";import"./isNil-c75b1b34.js";const bt=Ke({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:Ce},inactiveIcon:{type:Ce},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:qe(Function)},size:{type:String,validator:_t},tabindex:{type:[String,Number]}}),Nt={[he]:o=>ce(o)||me(o)||fe(o),[_e]:o=>ce(o)||me(o)||fe(o),[ge]:o=>ce(o)||me(o)||fe(o)},wt=["onClick"],It=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],Dt=["aria-hidden"],$t=["aria-hidden"],Ct=["aria-hidden"],ye="ElSwitch",Vt=xe({name:ye}),Lt=xe({...Vt,props:bt,emits:Nt,setup(o,{expose:n,emit:t}){const e=o,l=ie(),{formItem:u}=Ye(),c=Je(),a=Ge("switch");ft({from:'"value"',replacement:'"model-value" or "v-model"',scope:ye,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},S(()=>{var r;return!!((r=l.vnode.props)!=null&&r.value)}));const{inputId:f}=Ze(e,{formItemContext:u}),m=Qe(S(()=>e.loading)),_=B(e.modelValue!==!1),p=B(),y=B(),d=S(()=>[a.b(),a.m(c.value),a.is("disabled",m.value),a.is("checked",h.value)]),D=S(()=>({width:mt(e.width)}));se(()=>e.modelValue,()=>{_.value=!0}),se(()=>e.value,()=>{_.value=!1});const w=S(()=>_.value?e.modelValue:e.value),h=S(()=>w.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(w.value)||(t(he,e.inactiveValue),t(_e,e.inactiveValue),t(ge,e.inactiveValue)),se(h,r=>{var b;p.value.checked=r,e.validateEvent&&((b=u==null?void 0:u.validate)==null||b.call(u,"change").catch(I=>gt()))});const g=()=>{const r=h.value?e.inactiveValue:e.activeValue;t(he,r),t(_e,r),t(ge,r),tt(()=>{p.value.checked=h.value})},k=()=>{if(m.value)return;const{beforeChange:r}=e;if(!r){g();return}const b=r();[Ve(b),ce(b)].includes(!0)||yt(ye,"beforeChange must return type `Promise<boolean>` or `boolean`"),Ve(b)?b.then(C=>{C&&g()}).catch(C=>{}):b&&g()},L=S(()=>a.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),i=()=>{var r,b;(b=(r=p.value)==null?void 0:r.focus)==null||b.call(r)};return Te(()=>{p.value.checked=h.value}),n({focus:i,checked:h}),(r,b)=>(v(),$("div",{class:O(s(d)),style:Q(s(L)),onClick:ee(k,["prevent"])},[x("input",{id:s(f),ref_key:"input",ref:p,class:O(s(a).e("input")),type:"checkbox",role:"switch","aria-checked":s(h),"aria-disabled":s(m),name:r.name,"true-value":r.activeValue,"false-value":r.inactiveValue,disabled:s(m),tabindex:r.tabindex,onChange:g,onKeydown:et(k,["enter"])},null,42,It),!r.inlinePrompt&&(r.inactiveIcon||r.inactiveText)?(v(),$("span",{key:0,class:O([s(a).e("label"),s(a).em("label","left"),s(a).is("active",!s(h))])},[r.inactiveIcon?(v(),A(s(re),{key:0},{default:R(()=>[(v(),A(te(r.inactiveIcon)))]),_:1})):T("v-if",!0),!r.inactiveIcon&&r.inactiveText?(v(),$("span",{key:1,"aria-hidden":s(h)},H(r.inactiveText),9,Dt)):T("v-if",!0)],2)):T("v-if",!0),x("span",{ref_key:"core",ref:y,class:O(s(a).e("core")),style:Q(s(D))},[r.inlinePrompt?(v(),$("div",{key:0,class:O(s(a).e("inner"))},[r.activeIcon||r.inactiveIcon?(v(),A(s(re),{key:0,class:O(s(a).is("icon"))},{default:R(()=>[(v(),A(te(s(h)?r.activeIcon:r.inactiveIcon)))]),_:1},8,["class"])):r.activeText||r.inactiveText?(v(),$("span",{key:1,class:O(s(a).is("text")),"aria-hidden":!s(h)},H(s(h)?r.activeText:r.inactiveText),11,$t)):T("v-if",!0)],2)):T("v-if",!0),x("div",{class:O(s(a).e("action"))},[r.loading?(v(),A(s(re),{key:0,class:O(s(a).is("loading"))},{default:R(()=>[P(s(ht))]),_:1},8,["class"])):T("v-if",!0)],2)],6),!r.inlinePrompt&&(r.activeIcon||r.activeText)?(v(),$("span",{key:1,class:O([s(a).e("label"),s(a).em("label","right"),s(a).is("active",s(h))])},[r.activeIcon?(v(),A(s(re),{key:0},{default:R(()=>[(v(),A(te(r.activeIcon)))]),_:1})):T("v-if",!0),!r.activeIcon&&r.activeText?(v(),$("span",{key:1,"aria-hidden":!s(h)},H(r.activeText),9,Ct)):T("v-if",!0)],2)):T("v-if",!0)],14,wt))}});var kt=We(Lt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Pe=Xe(kt);const Bt=["onClick"],St={key:0,class:"line"},At={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(o,{emit:n}){const t=o,e=de(),l=U("addNodeDialogRef"),u=m=>{if(m.id==="canvas-main"||!m)return{x:0,y:0};const _=u(m.offsetParent);return{x:_.x+m.offsetLeft,y:_.y+m.offsetTop}},c=m=>{n("toAdd",m)},a=ie(),f=m=>{if(t.addType==="branch")return n("toAdd");const{target:_,offsetY:p}=m,{x:y,y:d}=u(_);l.value.show({x:_.clientWidth+y,y:p+d},c,a)};return(m,_)=>(v(),$(F,null,[x("div",Y({class:"add-node"},s(e),{onClick:ee(f,["stop"])})," + ",16,Bt),o.endLine?(v(),$("div",St)):T("",!0)],64))}},we=z(At,[["__scopeId","data-v-77b265a2"]]);const xt=["onClick"],Tt={__name:"SubBtn",emits:["toSub"],setup(o,{emit:n}){const t=U("hoverStack"),e=l=>{t.value=[],n("toSub")};return(l,u)=>(v(),$("div",{class:"sub-node",onClick:ee(e,["stop"])}," - ",8,xt))}},Me=z(Tt,[["__scopeId","data-v-554bf87e"]]),Et={},Pt={class:"node-wrapper"},Mt={class:"c-circle c-start"};function Rt(o,n){return v(),$("div",Pt,[x("div",Mt,[q(o.$slots,"showName",{},()=>[j(" start ")])])])}const Ot=z(Et,[["render",Rt]]),Ft={},jt={class:"node-wrapper"},Ut={class:"c-circle c-end"};function zt(o,n){return v(),$("div",jt,[x("div",Ut,[q(o.$slots,"showName",{},()=>[j(" end ")])])])}const Ht=z(Ft,[["render",zt]]),Kt={},qt={class:"node-wrapper"},Gt={class:"c-circle c-other"};function Wt(o,n){return v(),$("div",qt,[q(o.$slots,"default"),x("div",Gt,[q(o.$slots,"showName",{},()=>[j(" error ")])])])}const Re=z(Kt,[["render",Wt]]),Ie=o=>{var n;return o?(n=o==null?void 0:o.branchList)!=null&&n.length?o.branchList.reduce((t,e)=>t+Math.max(...e.map(l=>Ie(l)),1),0):1:0},ke=o=>Array.isArray(o)?Math.max(...o.map(n=>Ie(n)),1):1,Xt=x("div",{class:"line"},null,-1),Oe={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(o,{emit:n}){const t=o,e=S({get:()=>t.modelValue||[],set:i=>n("update:modelValue",i)}),l=S(()=>{var i,r,b,I,C,V;return((i=t.curNode)==null?void 0:i.type)==="switch"?(((b=(r=t.curNode)==null?void 0:r.nodeInfo)==null?void 0:b.branchInfoList)||[]).map(N=>N==null?void 0:N.branchName):((I=t.curNode)==null?void 0:I.type)==="if"?(((V=(C=t.curNode)==null?void 0:C.nodeInfo)==null?void 0:V.branchInfoList)||[]).map(N=>N.branchName):[]}),u=S(()=>Ie(t.curNode)),c=S(()=>{var i;return ke((i=e.value)==null?void 0:i[0])}),a=S(()=>{var i;return ke((i=e.value)==null?void 0:i[e.value.length-1])}),f=U("activateNode"),m=U("hoverStack"),_=S(()=>m.value[0]),p=i=>m.value.unshift(e.value[i]),y=i=>m.value.shift(),d=B(null),D=i=>{d.value=i,e.value[i]},w=()=>{d.value=null},h=i=>{d.value!==null&&i.preventDefault()},g=(i,r,b)=>{let I=Math.min(r,b),C=Math.max(r,b);const V=i[r];for(;I<C;)r<b?i[I]=i[++I]:i[C]=i[--C],I===C&&(i[I]=V)},k=i=>{var r,b;d.value===i||d.value===null||(g(e.value||[],d.value,i),g(((b=(r=t.curNode)==null?void 0:r.nodeInfo)==null?void 0:b.branchInfoList)||[],d.value,i),d.value=null)},L=i=>{f.value=e.value[i]};return(i,r)=>(v(),$(F,null,[Xt,["switch"].includes(o.curNode.type)?(v(),A(we,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:r[0]||(r[0]=b=>n("addBranch"))})):T("",!0),x("div",{class:"branch-wrapper branch-wrapper-width",style:Q({"--var-col-count":s(u),"--var-first-branch-col-count":s(c),"--var-last-branch-col-count":s(a)})},[(v(!0),$(F,null,Z(s(e),(b,I)=>(v(),A(je,{key:I,modelValue:s(e)[I],"onUpdate:modelValue":C=>s(e)[I]=C,class:O({"hover-branch":s(_)===s(e)[I]||s(f)===s(e)[I],"can-drop-branch":d.value!==null&&d.value!==I}),"branch-count":s(e).length,"branch-name":s(l)[I],draggable:!0,onMouseenter:()=>p(I),onMouseleave:()=>y(),onRemoveBranch:()=>n("removeBranch",I),onDragstart:ee(()=>D(I),["stop"]),onDragover:r[1]||(r[1]=C=>h(C)),onDropCapture:()=>k(I),onDragend:w,onClick:ee(()=>L(I),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},Yt={class:"c-circle c-if"},Jt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:n}){const t=o,e=S({get:()=>t.modelValue.branchList,set:c=>n("update:modelValue",{...t.modelValue,branchList:c})}),l=de(),u=c=>{var a;return c?(a=c==null?void 0:c.branchList)!=null&&a.length?c.branchList.reduce((f,m)=>f+Math.max(...m.map(_=>u(_)),1),0):1:0};return S(()=>u(t.modelValue)),(c,a)=>(v(),$(F,null,[x("div",Y({class:"node-wrapper"},s(l)),[q(c.$slots,"default"),x("div",Yt,[q(c.$slots,"showName",{},()=>[j(" if ")])])],16),o.isPreview?T("",!0):(v(),A(Oe,{key:0,modelValue:s(e),"onUpdate:modelValue":a[0]||(a[0]=f=>ve(e)?e.value=f:null),"cur-node":o.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Zt={class:"c-circle c-switch"},Qt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:n}){const t=o,e=S({get:()=>t.modelValue.branchList||[],set:a=>n("update:modelValue",{...t.modelValue,branchList:a})}),l=de(),u=()=>{const a=e.value.push([]);t.modelValue.nodeInfo.branchInfoList[a]={}},c=a=>{e.value.splice(a,1),t.modelValue.nodeInfo.branchInfoList.splice(a,1)};return(a,f)=>(v(),$(F,null,[x("div",Y({class:"node-wrapper"},s(l)),[q(a.$slots,"default",{},void 0,!0),x("div",Zt,[q(a.$slots,"showName",{},()=>[j(" switch ")],!0)])],16),o.isPreview?T("",!0):(v(),A(Oe,{key:0,modelValue:s(e),"onUpdate:modelValue":f[0]||(f[0]=m=>ve(e)?e.value=m:null),"cur-node":o.modelValue,onAddBranch:u,onRemoveBranch:c},null,8,["modelValue","cur-node"]))],64))}},en=z(Qt,[["__scopeId","data-v-c8b2d440"]]),tn={class:"node-wrapper"},nn={class:"c-circle c-feat"},an={__name:"Feat",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(o){return(n,t)=>(v(),$("div",tn,[q(n.$slots,"default"),x("div",nn,[q(n.$slots,"showName",{},()=>[j(" Feat ")])])]))}},De=[{type:"start",component:J(Ot),generateNode:()=>new E("start")},{type:"end",component:J(Ht),generateNode:()=>new E("end")},{type:"if",component:J(Jt),generateNode:()=>new E("if")},{type:"switch",component:J(en),generateNode:(o=[[],[]])=>new E("switch",{branchList:o})},{type:"feat",component:J(an),generateNode:()=>new E("feat")}],ne=2,Be=(o,n=ne)=>{const t=o==null?void 0:o.filter(Array.isArray);return t!=null&&t.length?n?t.length>=n?t.slice(0,n):t.slice().concat(new Array(n-t.length).fill(0).map(e=>[])):t.slice():new Array(n).fill(0).map(e=>[])},Se=()=>({code:""}),on=({type:o,branchList:n})=>{const e={if:{condition:"",branchInfoList:[{branchName:"分支1",type:!0},{branchName:"分支2",type:!1}]},switch:{condition:"",branchInfoList:(n||[]).map((l,u)=>({branchName:`分支${u+1}`,condition:""}))}}[o]||{};return e.type=o,e.nodeName=o,e},X=class{constructor(n,t){const{branchList:e=[],nodeInfo:l={}}=t||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++X.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:De.some(a=>a.type===n)?n:"error"}),n==="if"){const a=Be(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(a,{get(f,m,_){return Reflect.get(f,m,_)},set(f,m,_,p){return["0","1"].includes(m)?Reflect.set(f,m,_,p):(console.error(`分支数量必须为${ne}`),!1)}})}})}if(n==="switch"){let a=Be(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>a,set(f){if(f.length<ne)throw new Re(`分支数量至少为${ne}`);a=f}})}const u=on(this);Object.assign(u,l);const c=new Proxy(u,{get(a,f,m){return Reflect.get(a,f,m)},set(a,f,m,_){return console.log("修改了",a,"的",f,"为",m),Reflect.set(a,f,m,_)}});this.nodeInfo=c}static copyBranchList(n){return(n==null?void 0:n.map(t=>(t==null?void 0:t.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new X(this.type,{branchList:X.copyBranchList(this.branchList),nodeInfo:JSON.parse(JSON.stringify(this.nodeInfo))})}static executeNode(n,t=[],e){e||(e=Se());const{type:l,branchList:u}=n;let c;l==="if"&&(c=X.executeList(u[0],t)),l==="switch"&&(c=X.executeList(u[0],t));const a={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${c.context.code}
        }
      `,switch:()=>`switch(){
        ${c.context.code}
      }
      `};return e.code+=a[l](),{result:t,context:e}}static executeList(n,t=[]){const e=Se();return{result:n.reduce((u,c)=>X.executeNode(c,u,e).result,t),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((n,t)=>{let e=`${n},${t}:`;return Array.isArray(this[t])?e+=`[${this[t].toString()}]`:typeof this[t]=="number"?e+=`${this[t].toString()}`:typeof this[t]=="string"?e+=`"${this[t].toString()}"`:e+=`{${this[t].toString()}}`,e},"").slice(1)}}`}};let E=X;$e(E,"id",0);const sn={type:"error",component:J(Re),generateNode:()=>new E("error")},Fe=(o,n,t=null)=>{for(let e in o){e=e-0;const l=o[e];if(l===n)return{nodeList:o,parentNode:t,nodeIdx:e,branchIdx:null};for(let u in l.branchList||[]){u=u-0;const c=l.branchList[u];if(c===n)return{nodeList:c,parentNode:l,branchIdx:u,nodeIdx:null};const a=Fe(c,n,l);if(a)return a}}return null},oe=o=>{var e,l;const n=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],t=((l=window==null?void 0:window.__activateNode)==null?void 0:l.value)||null;return Fe(n||[],o||t)},ln=["draggable","onDragstart","onClick"],rn=x("div",{class:"line"},null,-1),cn={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(o,{emit:n}){const t=o,e=S({get:()=>t.modelValue,set:i=>n("update:modelValue",i)}),l=S({get:()=>t.nodeList,set:i=>n("update:nodeList",i)}),u=S(()=>(De.find(i=>i.type===e.value.type)||sn).component),c=U("hoverStack"),a=U("dragConf"),f=U("activateNode"),m=S(()=>c.value[0]),_=()=>c.value.unshift(e.value),p=()=>c.value.shift(),y=()=>{console.log("dragstart"),a.value.customDragData={node:e.value,curBranch:l.value,target:null};const i=[],r=(b,I)=>{var C;!I&&i.push(b),(C=b==null?void 0:b.branchList)!=null&&C.length&&b.branchList.forEach(V=>{i.push(V),V.forEach(N=>r(N))})};r(e.value,!0),a.value.dragFlag=!0,a.value.banDropNodeList=i},d=()=>{a.value.dragFlag=!1,a.value.banDropNodeList=[]},D=ie(),w=()=>{a.value.customDragData&&(a.value.banDropNodeList.includes(e)||Ee(a.value.customDragData.target)===D&&(n("moveTo",a.value.customDragData.node,a.value.customDragData.curBranch),a.value.customDragData=null,c.value=[]))},h=()=>{a.value.customDragData&&(a.value.customDragData.target=D)},g=()=>{a.value.customDragData&&(a.value.customDragData.target=null)},k=i=>{a.value.dragFlag&&!a.value.banDropNodeList.includes(e.value)&&i.preventDefault()},L=()=>{f.value=e.value};return(i,r)=>(v(),$(F,null,[x("div",{draggable:!["start","end"].includes(s(e).type),class:O(["node-box",{"hover-node":s(m)===s(e)||s(f)===s(e),"no-branch-box":!["if","switch"].includes(s(e).type)}]),onMouseenter:_,onMouseleave:p,onDragstart:ee(y,["stop"]),onDragend:d,onClick:ee(L,["stop"])},[(v(),A(te(s(u)),{modelValue:s(e),"onUpdate:modelValue":r[1]||(r[1]=b=>ve(e)?e.value=b:null)},{showName:R(()=>[j(H(s(e).nodeInfo.nodeName||s(e).type),1)]),default:R(()=>[P(Me,{onToSub:r[0]||(r[0]=b=>n("subNode"))})]),_:1},8,["modelValue"]))],42,ln),s(e).type!=="end"?(v(),$(F,{key:0},[rn,P(we,{class:O({canDropFlag:s(a).dragFlag&&!s(a).banDropNodeList.includes(s(e))}),onToAdd:r[2]||(r[2]=b=>n("addNode",b)),onDragover:k,onDrop:w,onDragenter:h,onDragleave:g},null,8,["class"])],64)):T("",!0)],64))}};const un=o=>(nt("data-v-435c42c5"),o=o(),at(),o),dn=un(()=>x("div",{class:"line"},null,-1)),vn={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(o,{emit:n}){const t=o,e=de(),l=S({get:()=>t.modelValue,set:h=>n("update:modelValue",h)}),u=U("branchNameFlag"),c=U("dragConf"),a=U("hoverStack"),f=(h,g)=>{const k=g.generateNode();l.value.splice(h+1,0,k)},m=(h,g,k)=>{const L=g.findIndex(i=>i===h);if(g===l.value){if(L===k+1||L===k)return;L>k?(g.splice(L,1),g.splice(k+1,0,h)):(g.splice(k+1,0,h),g.splice(L,1))}else g.splice(L,1),l.value.splice(k+1,0,h)},_=h=>{l.value.splice(h,1)},p=ie(),y=()=>{c.value.customDragData&&(c.value.banDropNodeList.includes(l)||Ee(c.value.customDragData.target)===p&&(m(c.value.customDragData.node,c.value.customDragData.curBranch,-1),a.value=[],c.value.customDragData=null))},d=()=>{c.value.customDragData&&(c.value.customDragData.target=p)},D=()=>{c.value.customDragData&&(c.value.customDragData.target=null)},w=h=>{c.value.dragFlag&&!c.value.banDropNodeList.includes(l.value)&&h.preventDefault()};return(h,g)=>(v(),$("div",Y({class:"render-list-wrapper"},s(e)),[o.startLine?(v(),$(F,{key:0},[o.branchCount>2?(v(),A(Me,{key:0,onClick:g[0]||(g[0]=k=>n("removeBranch"))})):T("",!0),s(u)?(v(),$("div",{key:1,class:O(["branch-name",{placeholder:!o.branchName}])},H(o.branchName||"未命名"),3)):T("",!0),dn,P(we,{class:O({canDropFlag:s(c).dragFlag&&!s(c).banDropNodeList.includes(s(l))}),droppable:s(c).dragFlag&&!s(c).banDropNodeList.includes(s(l)),onToAdd:g[1]||(g[1]=k=>f(-1,k)),onDragover:w,onDrop:y,onDragenter:d,onDragleave:D},null,8,["class","droppable"])],64)):T("",!0),(v(!0),$(F,null,Z(s(l),(k,L)=>(v(),A(cn,{key:k.id,modelValue:s(l)[L],"onUpdate:modelValue":i=>s(l)[L]=i,"node-list":s(l),"onUpdate:nodeList":g[2]||(g[2]=i=>ve(l)?l.value=i:null),onAddNode:i=>f(L,i),onSubNode:()=>_(L),onMoveTo:(i,r)=>m(i,r,L)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},je=z(vn,[["__scopeId","data-v-435c42c5"]]);const pn={class:"select-node-wrapper"},fn={__name:"AddNodeDialog",props:{scale:{type:Number,default:1}},setup(o,{expose:n}){const t=B({x:1,y:1}),e=B(!1);let l,u;const c=()=>{e.value=!1,l=null,u=null},a=(_,p,y)=>{if(u===y)return c();u=y,l=p,t.value=_,e.value=!0},f=_=>{l==null||l(_),c()},m=B(De.filter(_=>!["start","end"].includes(_.type)));return n({show:a,close:c}),(_,p)=>pe((v(),$("div",{class:"add-node-dialog",style:Q({"--var-dialog-left":`${t.value.x+15}px`,"--var-dialog-top":`${t.value.y+15}px`,"--var-dialog-size":e.value?"300px":"0","--var-position-scale":o.scale})},[j(H(o.scale)+" ",1),x("div",pn,[(v(!0),$(F,null,Z(m.value,y=>(v(),A(te(y.component),{key:y.type,"is-preview":!0,onClick:()=>f(y)},null,8,["onClick"]))),128))])],4)),[[s(Ne),c]])}},mn=z(fn,[["__scopeId","data-v-ea1ca24d"]]);const hn={__name:"Condition",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},attr:{type:Object,default:()=>({})}},emits:["change"],setup(o,{emit:n}){const t=o,e=B(t.modelValue.findIndex(a=>a.type)),l=t.attr.curActivateBranchIdx,u=(t.attr.curActivateBranchIdx+1)%2,c=a=>{t.modelValue[l].type=a===l,t.modelValue[u].type=a!==l,n("change",t.modelValue)};return(a,f)=>{const m=Pe;return v(),$("div",null,[P(m,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=_=>e.value=_),disabled:o.disabled,"active-value":s(l),"inactive-value":u,onChange:c},null,8,["modelValue","disabled","active-value"])])}}};const _n={class:"tab-pane-content"},gn={class:"module-name"},yn={__name:"NodeInfo",setup(o){const n=U("activateNode"),t=S(()=>Array.isArray(n.value)),e=B(null),l=B(null);se(()=>n.value,d=>{if(t.value){const{parentNode:D,branchIdx:w}=oe(n.value);l.value=w,e.value=D}else l.value=null,e.value=n.value},{deep:!0,immediate:!0});const u=S({get:()=>{var d;return((d=e.value)==null?void 0:d.nodeInfo)||{}},set:d=>{e.value.nodeInfo=d}}),c=d=>{if(!d)return{};const{type:D}=d,w=(h,g,k,L,i={})=>h&&h!==D?!1:{label:g,field:k,type:L,...i};return{base:[{moduleName:"基本信息",attrs:[w(null,"节点类型","type","input",{disabled:!0}),w(null,"节点名称","nodeName","input"),w("if","判断条件","condition","input",{required:!0}),w("switch","判断变量","condition","input",{required:!0})].filter(Boolean)},{moduleName:"分支信息",attrs:[w("if","分支名称",`branchInfoList.${l.value}.branchName`,"input",{disabled:!1}),w("if","设为true分支","branchInfoList","custom",{component:J(hn),nodeInfo:u,curActivateBranchIdx:l.value}),w("switch","分支名称",`branchInfoList.${l.value}.branchName`,"input"),w("switch","判断条件",`branchInfoList.${l.value}.condition`,"input",{required:!0})].filter(Boolean).filter(h=>t.value)},{moduleName:"输入参数",attrs:[].filter(Boolean)},{moduleName:"输出参数",attrs:[].filter(Boolean)}].filter(h=>{var g;return(g=h==null?void 0:h.attrs)==null?void 0:g.length}),other:[].filter(h=>{var g;return(g=h==null?void 0:h.attrs)==null?void 0:g.length})}},a=S(()=>{const{base:d,other:D}=c(e.value);return[{label:"基础属性",modules:d},{label:"其他属性",modules:D}]}),f=B("基础属性"),m=S({get(){return d=>{const D=(d==null?void 0:d.split("."))||[];return D.reduce((w,h)=>(w==null?void 0:w[h])||void 0,D.length?u.value:void 0)}}}),_=d=>typeof d=="object"&&d!==null,p=(d,D)=>{const w=(D==null?void 0:D.split("."))||[];if(w.length)if(w.length===1)u.value[w[0]]=d;else{const h=w.pop();try{let g="nodeInfo";const k=w.reduce((L,i)=>(g+=`.${i}`,_(L[i])||(console.warn(`${g}不是一个对象，已强制转化为对象`),L[i]={}),L[i]),w.length?u.value:void 0);k[h]=d}catch(g){console.error(`nodeInfo数据异常，无法读取${D}字段`),console.error(g)}}},y=d=>({disabled:d==null?void 0:d.disabled,modelValue:d.field&&m.value(d.field)||d.defaultValue,onInput:D=>p(D,d.field),onChange:D=>p(D,d.field)});return(d,D)=>{const w=pt,h=Pe,g=dt,k=vt,L=ut,i=it,r=rt,b=ct;return v(),A(b,{modelValue:f.value,"onUpdate:modelValue":D[0]||(D[0]=I=>f.value=I),stretch:!0},{default:R(()=>[(v(!0),$(F,null,Z(s(a),I=>(v(),A(r,{key:I.label,label:I.label,name:I.label},{default:R(()=>[P(i,{model:s(u),"label-width":"100px"},{default:R(()=>[j(H(s(u))+" ",1),x("div",_n,[(v(!0),$(F,null,Z(I.modules,(C,V)=>(v(),$("div",{key:V,class:"module-content"},[x("div",gn,H(C.moduleName),1),(v(!0),$(F,null,Z(C.attrs,(N,W)=>(v(),$("div",{key:W},[P(L,{label:N.label,rules:N.required&&[{required:!0,message:""}]},{default:R(()=>[N.type==="input"?(v(),A(w,Le(Y({key:0},y(N))),null,16)):N.type==="switch"?(v(),A(h,Y({key:N},y(N),{"active-value":N.activeValue,"inactive-value":N.inactiveValue}),null,16,["active-value","inactive-value"])):N.type==="radio"?(v(),A(k,Le(Y({key:2},y(N))),{default:R(()=>[(v(!0),$(F,null,Z(N.options,M=>(v(),A(g,{key:M.value,label:M.label,value:M.value},null,8,["label","value"]))),128))]),_:2},1040)):N.type==="custom"?(v(),A(te(N.component),Y({key:3},y(N),{attr:N}),null,16,["attr"])):T("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},bn=z(yn,[["__scopeId","data-v-c36cb234"]]);const Nn={__name:"index",setup(o){const n="350px",t=U("activateNode"),e=B(null),l=B(!1);se(()=>t.value,c=>{c&&(e.value=c,l.value=!0)});const u=()=>{l.value=!1,e.value=null};return(c,a)=>pe((v(),$("div",{style:Q({"--var-width":n,"--var-right":l.value?0:`-${n}`,"--var-opacity":Number(l.value)}),class:"custom-drawer"},[e.value?(v(),A(bn,{key:0})):T("",!0)],4)),[[s(Ne),u]])}},wn=z(Nn,[["__scopeId","data-v-04587e00"]]);let be=o=>{const n=e=>{if(!e)return console.error("复制内容为空");const l=document.createElement("textarea");try{l.setAttribute("readonly","readonly"),l.value=e.replace(/\n/g,"\r"),l.value=e,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l)}catch{console.error("自动复制被禁用，请手动选取复制")}},t=e=>{if(!e)return console.log("复制内容为空");try{navigator.clipboard.writeText(e).then(()=>{},()=>{n(e)});return}catch(l){n(e),console.error("不支持异步剪切板:",l)}};be=navigator.clipboard?t:n,be(o)};const In={__name:"index",setup(o,{expose:n}){const t="500px",e=B(!1),l=B(""),u=f=>{e.value=!0,l.value=f},c=()=>{e.value=!1},a=f=>{be(f)};return n({show:u}),(f,m)=>{const _=Ae,p=ot("highlightjs");return pe((v(),$("div",{style:Q({"--var-width":t,"--var-right":e.value?0:`-${t}`,"--var-opacity":Number(e.value)}),class:"custom-drawer"},[P(_,{link:"",type:"primary",onClick:m[0]||(m[0]=()=>a(l.value))},{default:R(()=>[j(" 复制代码 ")]),_:1}),P(p,{style:{height:"100%",overflow:"auto"},language:"js",code:l.value},null,8,["code"]),x("pre",null,"      "+H(l.value)+`
    `,1)],4)),[[s(Ne),c]])}}},Dn=z(In,[["__scopeId","data-v-00d29365"]]);function $n(){let n=[0,0];const t=B([0,0]),e=B([0,0]),l=p=>{var y;![...p.target.classList].includes("canvas-main")&&!([...p.target.classList].includes("render-list-wrapper")&&((y=p.target.attributes.draggable)==null?void 0:y.value)!=="true")||(p.target.style.cursor="grab",console.log("e.target.style.cursor",p.target.style.cursor),n=[p.screenX,p.screenY],document.onmousemove=function(d){d.target.style.cursor="grabbing",console.log("onmousemove"),e.value=[(d.screenX-n[0])*1,(d.screenY-n[1])*1]})},u=p=>{var h;(h=p==null?void 0:p.target)!=null&&h.style&&(p.target.style.cursor="default");const[y,d]=t.value,[D,w]=e.value;t.value=[y+D,d+w],e.value=[0,0],document.onmousemove=document.onmouseup=null},c=B(100),a=S(()=>c.value/100);let f=null;const m=p=>{if(p===0)return;const y=c.value+p;return p>0&&y>=300||p<0&&y<=10?!1:(c.value+=p,!0)},_=p=>{var I;(I=p.preventDefault)==null||I.call(p);const[y,d]=t.value,D=p.wheelDelta?p.wheelDelta<0:p.detail>0;if(!p.ctrlKey){D?t.value=[y,d-30]:t.value=[y,d+30];return}const{width:w=0,height:h=0}=(f==null?void 0:f.getBoundingClientRect())||{},{pageX:g,pageY:k}=p,[L,i]=[w/2,h/2],[r,b]=[(g-L)/L*20,(k-i)/i*20];if(D){if(!m(-10))return;t.value=[y+r,d+b]}else{if(!m(10))return;t.value=[y-r,d-b]}};return Te(()=>{f=document.querySelector("#canvas-main"),document.addEventListener("mouseleave",p=>{u(p)})}),{handleMouseDown:l,handleMouseUp:u,positionDist:t,calcDist:e,onMouseWheel:_,scale:a}}const ue=(o,n=0)=>{console.log("nodeList",o);const t="	",e="".padStart(n,t),l=`${t}${e}`,u={start:()=>`${e}
`,end:()=>`${e}
`,if:a=>{const{branchList:f}=a,{condition:m,branchInfoList:_}=a.nodeInfo,p=_.findIndex(d=>d.type),y=_.findIndex(d=>!d.type);return`${e}if(${m}){
${ue(f[p],n+1)}${e}}else{
${ue(f[y],n+1)}${e}}
`},switch:a=>{const{branchList:f}=a,{condition:m,branchInfoList:_}=a.nodeInfo;return`${e}switch(${m}){
${_.map((p,y)=>`${l}case ${p.condition}:
${ue(f[y],n+1)||`
`}${l}break;
`).join(`
`)}${e}}
`},feat:()=>`${e}feat
`};return o.reduce((a,f)=>{var m;return a+(((m=u[f.type])==null?void 0:m.call(u,f))||"")},"")};const Cn={class:"left-top-wrapper"},Vn={class:"canvas-node-container"},Ln={__name:"Main",setup(o){const n=B([new E("start"),new E("feat"),new E("if",{branchList:[[new E("feat")]]}),new E("switch",{branchList:[[new E("feat")],[new E("feat")],[new E("feat")]]}),new E("end")]);window.__nodeList=n;const t=B(null);ae("addNodeDialogRef",t);const e=B([]);ae("hoverStack",e);const l=B({banDropNodeList:[],dragFlag:!1,customDragData:null});ae("dragConf",l);const u=B(null);ae("activateNode",u),window.__activateNode=u,st(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const c=B(null),a=()=>{var K;const C=u.value;if(!C||["start","end"].includes(C.type))return;const{parentNode:V,branchIdx:N,nodeList:W,nodeIdx:M}=oe(C);let le=null;if(Array.isArray(C)){if(((K=V.branchList)==null?void 0:K.length)<=ne)throw new Error(`分支数量至少为${ne},剪切失败！`);(V.branchList||[]).splice(N,1),le=V.nodeInfo.branchInfoList.splice(N,1)[0]}else W.splice(M,1);c.value={type:"shear",data:C,branchInfo:le}},f=()=>{const C=u.value;if(!C||["start","end"].includes(C.type))return;const{branchIdx:V,parentNode:N}=oe();c.value={type:"copy",data:C,branchInfo:V===null?null:JSON.parse(JSON.stringify(N.nodeInfo.branchInfoList[V]||{}))}},m=C=>{if(!c.value)return;const{type:V,data:N,branchInfo:W}=c.value;if(!N||["end"].includes(u.value.type))return;const M={copyNode:()=>{if(!u.value||Array.isArray(u.value))return;const{nodeList:K,nodeIdx:G}=oe();K.splice(G+1,0,N.copySelf())},shearNode:()=>{if(!u.value||Array.isArray(u.value))return;const{nodeList:K,nodeIdx:G}=oe();K.splice(G+1,0,N),c.value=null},copyBranch:()=>{var G;if(((G=u.value)==null?void 0:G.type)!=="switch")return;const K=u.value.branchList.push(N.map(Ue=>Ue.copySelf()));u.value.nodeInfo.branchInfoList[K-1]=W},shearBranch:()=>{var G;if(((G=u.value)==null?void 0:G.type)!=="switch")return;const K=u.value.branchList.push(N);u.value.nodeInfo.branchInfoList[K-1]=W,c.value=null}},le=V+(Array.isArray(N)?"Branch":"Node");M[le]()},_=B(!0),p=()=>{_.value=!_.value},y=B(!0),d=()=>{y.value=!y.value};ae("branchNameFlag",y);const D=B(""),w=()=>{},h=B(null),g=()=>{const C=ue(n.value);D.value=C,h.value.show(D.value)},{handleMouseDown:k,handleMouseUp:L,positionDist:i,calcDist:r,onMouseWheel:b,scale:I}=$n();return(C,V)=>{const N=Ae,W=lt("mousetrap");return v(),$(F,null,[x("div",{id:"canvas-main",class:"canvas-main",style:Q({"--var-position-x":`${s(i)[0]+s(r)[0]}px`,"--var-position-y":`${s(i)[1]+s(r)[1]}px`,"--var-position-scale":s(I)}),onClickCapture:V[1]||(V[1]=M=>u.value=null),onMousedown:V[2]||(V[2]=(...M)=>s(k)&&s(k)(...M)),onMouseup:V[3]||(V[3]=(...M)=>s(L)&&s(L)(...M)),onMousewheel:V[4]||(V[4]=(...M)=>s(b)&&s(b)(...M))},[x("div",Cn,[P(N,{onClick:p},{default:R(()=>[j(" 快捷建："+H(_.value?"开启":"关闭"),1)]),_:1}),P(N,{onClick:d},{default:R(()=>[j(" 显示分支名："+H(y.value?"开启":"关闭"),1)]),_:1}),P(N,{onClick:w},{default:R(()=>[j(" 执行 ")]),_:1}),P(N,{onClick:g},{default:R(()=>[j(" 生成代码 ")]),_:1})]),x("div",Vn,[P(je,{modelValue:n.value,"onUpdate:modelValue":V[0]||(V[0]=M=>n.value=M),"start-line":!1},null,8,["modelValue"])])],36),P(mn,{ref_key:"addNodeDialogRef",ref:t,scale:s(I)},null,8,["scale"]),P(s(wn)),P(s(Dn),{ref_key:"codePanelRef",ref:h},null,512),_.value?pe((v(),$("div",{key:0,"onMod+c":V[5]||(V[5]=()=>f()),"onMod+x":V[6]||(V[6]=()=>a()),"onMod+v":m},null,544)),[[W,["mod+c","mod+v","mod+x"]]]):T("",!0)],64)}}},kn=z(Ln,[["__scopeId","data-v-c1782f04"]]),Jn={__name:"index",setup(o){return(n,t)=>(v(),A(kn))}};export{Jn as default};
