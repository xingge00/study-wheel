var U=Object.defineProperty;var E=(n,e,s)=>e in n?U(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var R=(n,e,s)=>(E(n,typeof e!="symbol"?e+"":e,s),s);import{_ as y,a2 as C,e as M,o as a,c as u,E as p,G as A,S as T,j as _,y as N,F as v,f as w,Y as x,s as V,z as B,b,am as F,an as z,ar as g,R as Y,v as j,r as $,P as X,A as G}from"./index-42a3b3d9.js";import{C as q}from"./index-7ea428a2.js";import"./types-963db8e3.js";const H=["onClick"],J={key:0,class:"line"},K={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(n,{emit:e}){const s=n,t=C(),r=M("addNodeDialogRef"),l=o=>{if(o.id==="canvas-main"||!o)return{x:0,y:0};const d=l(o.offsetParent);return{x:d.x+o.offsetLeft,y:d.y+o.offsetTop}},i=o=>{e("toAdd",o)},c=o=>{if(s.addType==="branch")return e("toAdd");const{x:d,y:f}=l(o.target);r.value.show({x:o.offsetX+d,y:o.offsetY+f},i)};return(o,d)=>(a(),u(v,null,[p("div",A({class:"add-node"},_(t),{onClick:T(c,["stop"])})," + ",16,H),n.endLine?(a(),u("div",J)):N("",!0)],64))}},P=y(K,[["__scopeId","data-v-4349605a"]]),Q={},W={class:"node-wrapper"},Z=p("div",{class:"c-circle c-start"}," start ",-1),ee=[Z];function te(n,e){return a(),u("div",W,ee)}const ne=y(Q,[["render",te]]),oe={},se={class:"node-wrapper"},ae=p("div",{class:"c-circle c-end"}," end ",-1),ce=[ae];function de(n,e){return a(),u("div",se,ce)}const re=y(oe,[["render",de]]),le={},ie={class:"node-wrapper"},ue=p("div",{class:"c-circle c-other"}," Error ",-1),_e=[ue];function pe(n,e){return a(),u("div",ie,_e)}const k=y(le,[["render",pe]]),me=p("div",{class:"c-circle c-if"}," if ",-1),fe=[me],he=p("div",{class:"line"},null,-1),ve={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,t=w({get:()=>s.modelValue.branchList,set:c=>e("update:modelValue",{...s.modelValue,branchList:c})}),r=C(),l=c=>{var o;return c?(o=c==null?void 0:c.branchList)!=null&&o.length?c.branchList.reduce((d,f)=>d+Math.max(...f.map(h=>l(h)),1),0):1:0},i=w(()=>l(s.modelValue));return(c,o)=>(a(),u(v,null,[p("div",A({class:"node-wrapper"},_(r)),fe,16),n.isPreview?N("",!0):(a(),u(v,{key:0},[he,p("div",{class:"branch-wrapper branch-wrapper-width",style:B({"--var-col-count":_(i)})},[(a(!0),u(v,null,x(_(t),(d,f)=>(a(),V(D,{key:f,modelValue:_(t)[f],"onUpdate:modelValue":h=>_(t)[f]=h},null,8,["modelValue","onUpdate:modelValue"]))),128))],4)],64))],64))}};const O=n=>(F("data-v-42050447"),n=n(),z(),n),ye=O(()=>p("div",{class:"c-circle c-switch"}," switch ",-1)),we=[ye],ge=O(()=>p("div",{class:"line"},null,-1)),Ve={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,t=w({get:()=>s.modelValue.branchList,set:o=>e("update:modelValue",{...s.modelValue,branchList:o})}),r=C(),l=()=>{t.value.push([])},i=o=>{var d;return o?(d=o==null?void 0:o.branchList)!=null&&d.length?o.branchList.reduce((f,h)=>f+Math.max(...h.map(L=>i(L)),1),0):1:0},c=w(()=>i(s.modelValue));return(o,d)=>(a(),u(v,null,[p("div",A({class:"node-wrapper"},_(r)),we,16),n.isPreview?N("",!0):(a(),u(v,{key:0},[ge,b(P,{class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:l}),p("div",{class:"branch-wrapper branch-wrapper-width",style:B({"--var-col-count":_(c)})},[(a(!0),u(v,null,x(_(t),(f,h)=>(a(),V(D,{key:h,modelValue:_(t)[h],"onUpdate:modelValue":L=>_(t)[h]=L},null,8,["modelValue","onUpdate:modelValue"]))),128))],4)],64))],64))}},$e=y(Ve,[["__scopeId","data-v-42050447"]]),be={},Ne={class:"node-wrapper"},xe=p("div",{class:"c-circle c-feat"}," Feat ",-1),Le=[xe];function ke(n,e){return a(),u("div",Ne,Le)}const Ce=y(be,[["render",ke]]),S=[{type:"start",component:g(ne),generateNode:()=>new m("start")},{type:"end",component:g(re),generateNode:()=>new m("end")},{type:"if",component:g(ve),generateNode:()=>new m("if")},{type:"switch",component:g($e),generateNode:n=>new m("switch",{branchList:n})},{type:"feat",component:g(Ce),generateNode:()=>new m("feat")}],I=class{constructor(e,s={branchList:[]}){if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++I.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:S.some(t=>t.type===e)?e:"error"}),e==="if"){let t=[[],[]];Object.defineProperty(this,"branchList",{configurable:!1,get:()=>t,set(r){if(r.length!==2)throw new k("分支数量必须为2");t=r}})}if(e==="switch"){let t=[[],[]];Object.defineProperty(this,"branchList",{configurable:!1,get:()=>t,set(r){if(r.length<2)throw new k("分支数量至少为2");t=r}})}}toString(){return"BaseNode"}};let m=I;R(m,"id",0);const Ae={type:"error",component:g(k),generateNode:()=>new m("error")},Be=p("div",{class:"line"},null,-1),Pe={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","addNode"],setup(n,{emit:e}){const s=n,t=w({get:()=>s.modelValue,set:l=>e("update:modelValue",l)}),r=w(()=>(S.find(l=>l.type===t.value.type)||Ae).component);return(l,i)=>(a(),u(v,null,[(a(),V(j(_(r)),{modelValue:_(t),"onUpdate:modelValue":i[0]||(i[0]=c=>Y(t)?t.value=c:null)},null,8,["modelValue"])),_(t).type!=="end"?(a(),u(v,{key:0},[Be,b(P,{onToAdd:i[1]||(i[1]=c=>e("addNode",c))})],64)):N("",!0)],64))}},Se={class:"render-list-wrapper"},De=p("div",{class:"line"},null,-1),D={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,t=w({get:()=>s.modelValue,set:l=>e("update:modelValue",l)}),r=(l,i)=>{const c=i.generateNode();t.value.splice(l+1,0,c)};return(l,i)=>(a(),u("div",Se,[n.startLine?(a(),u(v,{key:0},[De,b(P,{onToAdd:i[0]||(i[0]=c=>r(-1,c))})],64)):N("",!0),(a(!0),u(v,null,x(_(t),(c,o)=>(a(),V(Pe,{key:c.id,modelValue:_(t)[o],"onUpdate:modelValue":d=>_(t)[o]=d,onAddNode:d=>r(o,d)},null,8,["modelValue","onUpdate:modelValue","onAddNode"]))),128))]))}};const Ie={class:"select-node-wrapper"},Re={__name:"AddNodeDialog",setup(n,{expose:e}){const s=$({x:1,y:1}),t=$(!1);let r;const l=(d,f)=>{r=f,s.value=d,t.value=!0},i=()=>{t.value=!1},c=d=>{i(),r(d)},o=$(S.filter(d=>!["start","end"].includes(d.type)));return e({show:l,close:i}),(d,f)=>X((a(),u("div",{class:"add-node-dialog",style:B({"--var-dialog-left":`${s.value.x}px`,"--var-dialog-top":`${s.value.y}px`,"--var-dialog-size":t.value?"300px":"0"})},[p("div",Ie,[(a(!0),u(v,null,x(o.value,h=>(a(),V(j(h.component),{key:h.type,"is-preview":!0,onClick:()=>c(h)},null,8,["onClick"]))),128))])],4)),[[_(q),i]])}},je=y(Re,[["__scopeId","data-v-632790f7"]]);const Oe={id:"canvas-main",class:"canvas-main"},Ue={__name:"Main",setup(n){const e=$([new m("start"),new m("feat"),new m("if"),new m("switch"),new m("end")]);console.log(e.value);const s=$(null);return G("addNodeDialogRef",s),(t,r)=>(a(),u("div",Oe,[b(D,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=l=>e.value=l),"start-line":!1},null,8,["modelValue"]),b(je,{ref_key:"addNodeDialogRef",ref:s},null,512)]))}},Ee=y(Ue,[["__scopeId","data-v-c49345dc"]]),Ye={__name:"index",setup(n){return(e,s)=>(a(),V(Ee))}};export{Ye as default};
