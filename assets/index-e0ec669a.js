import{b as d,a as c,F as g,K as h,M as w,m as y,d as v,r as p,as as C,X as D,am as T,o as f,p as m,w as x,t as $}from"./index-4bd6017e.js";import"./el-scrollbar-04c5e21b.js";import{E as A}from"./el-input-408b4cf3.js";import{E,S,a as B}from"./sortable.esm-80f078f4.js";import{E as R}from"./index-1dbd4696.js";import"./index-8c9b0b59.js";import"./index-ba601c6e.js";import"./event-9519ab40.js";const k={name:"Column",props:{colums:Array},render:r=>{const o=(a,e)=>{const{render:l,type:n,prop:s}=a;if(!["index","selection"].includes(n))return l?l(e):d("span",{class:"no-drag"},[e.row[s]??"—"])},t=a=>a.map(e=>{const{children:l,...n}=e,{require:s,labelRender:i,label:b,render:U,..._}=n;return d(E,_,{default:u=>Array.isArray(l)&&l.length>1?t(l):o(n,u),header:()=>{const u=s?d("span",{style:"color:red;"},[c("*")]):null;return d(g,null,[u,i?i():d("span",null,[b])])}})});return t(r.colums)}};function q(r,o){let t=null;const a=()=>{var n;if(!((n=r==null?void 0:r.value)!=null&&n.$el))return;const l=r.value.$el.querySelector(".el-table__body tbody");l&&(t=new S(l,{handle:".el-table__row .el-table__cell",filter:".el-table__row .cell > .no-drag",preventOnFilter:!1,sort:!0,animation:300,forceFallback:!1,onEnd:o}))},e=()=>{t&&(t==null||t.destroy(),t=null)};h(()=>{a()}),w(()=>{e()})}const F=y({components:{Column:k},props:{tableData:{type:Array,default:()=>[]},colums:{type:Array,default:()=>[]},useDrag:{type:Boolean,default:!1}},emits:["update:tableData","sortChange"],setup(r,{expose:o,emit:t}){const a=v({get:()=>r.tableData,set:l=>t("update:tableData",l)}),e=p(null);return r.useDrag&&q(e,async({oldIndex:l,newIndex:n})=>{const s=a.value,i=s.splice(l,1)[0];s.splice(n,0,i),a.value=[],await D(),a.value=s,t("sortChange")}),o({getSelectionRows:()=>e.value.getSelectionRows(),clearSelection:()=>e.value.clearSelection(),getRef:()=>e.value}),{tableRef:e,newTableData:a}}});function V(r,o,t,a,e,l){const n=T("Column"),s=B;return f(),m(s,{ref:"tableRef",border:"",data:r.newTableData,style:{width:"100%"},"highlight-current-row":"",class:"cell-no-padding render-table"},{default:x(()=>[d(n,{colums:r.colums},null,8,["colums"])]),_:1},8,["data"])}const M=C(F,[["render",V]]),G={__name:"index",setup(r){const o=p([{field1:"field1",field2:"field2","field1-1":"field1-1的数据"},{field1:"aafield1",field2:"aaafield2","field1-1":"aafield1-1的数据"},{field1:"bbfield1",field2:"bbfield2","field1-1":"bbfield1-1的数据"}]),t=[{label:"序号",type:"index",width:"55",align:"center"},{require:!0,prop:"field1",label:"字段1",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100"}]}]},{prop:"field2",label:"字段2编辑",width:"250",render:({row:a})=>d(A,{class:"no-drag",modelValue:a.field2,"onUpdate:modelValue":e=>a.field2=e},null)},{prop:"field2",labelRender:()=>d(R,{size:"small"},{default:()=>[c("字段2展示")]}),width:"300"},{prop:"field3",label:"备注",minWidth:"100"}];return(a,e)=>(f(),m($(M),{"table-data":o.value,"onUpdate:tableData":e[0]||(e[0]=l=>o.value=l),"use-drag":!0,colums:t},null,8,["table-data"]))}};export{G as default};
