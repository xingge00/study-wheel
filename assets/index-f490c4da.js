import"./base-98489d78.js";import"./el-scrollbar-05a40835.js";import{E as f}from"./el-input-6d41e96e.js";import{E as c}from"./el-button-538d7386.js";import{p as g,m as v}from"./index-c161bbc8.js";import{E as D,S as k,a as $}from"./sortable.esm-277ab97b.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-0b33539f.js";import{b as a,a as _,F as E,k as S,z as T,B as V,v as A,r as u,_ as b,n as y,Z as z,o as h,D as U,w,M as F,c as C,i as R}from"./index-33795f6e.js";import{E as I}from"./index-eb8d05f6.js";import"./index-361d71c2.js";import"./index-1ffef1ed.js";import"./event-e06a23af.js";import"./typescript-defaf979.js";import"./isNil-c75b1b34.js";import"./index-65936caa.js";import"./index-650d25f6.js";import"./_initCloneObject-8c809355.js";import"./index-f3fb22ff.js";import"./aria-60e0cdc6.js";import"./focus-trap-386e63f5.js";const q={name:"Column",props:{colums:Array},render:s=>{console.log("render触发111111111111",s);const i=(r,n)=>{const{render:o,type:e,prop:l}=r;if(!["index","selection"].includes(e))return o?o(n):a("span",{class:"no-drag"},[n.row[l]??"—"])},t=r=>r.map(n=>{const{children:o,...e}=n,{require:l,labelRender:d,label:p,render:G,...x}=e;return a(D,x,{default:m=>Array.isArray(o)&&o.length>0?t(o):i(e,m),header:()=>{const m=l?a("span",{style:"color:red;"},[_("*")]):null;return a(E,null,[m,d?d():a("span",null,[p])])}})});return t(s.colums)}};function N(s,i){let t=null;const r=()=>{var e;if(!((e=s==null?void 0:s.value)!=null&&e.$el))return;const o=s.value.$el.querySelector(".el-table__body tbody");o&&(t=new k(o,{handle:".el-table__row .el-table__cell",filter:".el-table__row .cell > .no-drag",preventOnFilter:!1,sort:!0,animation:300,forceFallback:!1,onEnd:i}))},n=()=>{t&&(t==null||t.destroy(),t=null)};S(()=>{r()}),T(()=>{n()})}const M=V({components:{Column:q},props:{tableData:{type:Array,default:()=>[]},colums:{type:Array,default:()=>[]},useDrag:{type:Boolean,default:!1}},emits:["update:tableData","sortChange"],setup(s,{expose:i,emit:t}){const r=A({get:()=>s.tableData,set:o=>t("update:tableData",o)}),n=u(null);return s.useDrag&&N(n,async({oldIndex:o,newIndex:e})=>{const l=r.value,d=l.splice(o,1)[0];l.splice(e,0,d),r.value=[],await y(),r.value=l,t("sortChange")}),i({getSelectionRows:()=>n.value.getSelectionRows(),clearSelection:()=>n.value.clearSelection(),getRef:()=>n.value}),{tableRef:n,newTableData:r}}});function O(s,i,t,r,n,o){const e=z("Column"),l=$;return h(),U(l,F({ref:"tableRef",border:"",data:s.newTableData,style:{width:"100%"},"highlight-current-row":"",class:"cell-no-padding render-table"},s.$attrs),{default:w(()=>[a(e,{colums:s.colums},null,8,["colums"])]),_:1},16,["data"])}const B=b(M,[["render",O]]),W={class:"right-bar"},J={__name:"rightBar",emits:["reRender"],setup(s,{emit:i}){console.log("RightBarRightBar");const t=u([{prop:"field1",label:"字段1",width:"100px"},{prop:"field3",label:"label",width:"100px"},{prop:"field2",label:"field2",width:"100px"}]),r=(e=null)=>{const l={label:"字段label",prop:"字段prop",children:[]};console.log(e,l),e?e.children?e.children.push(l):e.children=[l]:t.value.push(l)},n=[{prop:"label",label:"label",minWidth:"80",render:({row:e})=>a(f,{class:"no-drag",modelValue:e.label,"onUpdate:modelValue":l=>e.label=l},null)},{prop:"prop",label:"prop",minWidth:"80",render:({row:e})=>a(f,{class:"no-drag",modelValue:e.prop,"onUpdate:modelValue":l=>e.prop=l},null)},{prop:"操作",width:"85",labelRender:()=>a("span",null,[a(c,{onClick:()=>r(),size:"small",circle:!0,icon:g},null),a(c,{onClick:()=>r(),size:"small",circle:!0,icon:v},null)]),render:({row:e})=>a("span",null,[a(c,{onClick:()=>r(e),size:"small",circle:!0,icon:g},null),a(c,{onClick:()=>r(),size:"small",circle:!0,icon:v},null)])}],o=()=>{console.log("点击了重新渲染"),i("reRender",JSON.parse(JSON.stringify(t.value)))};return(e,l)=>{const d=c;return h(),C("div",W,[a(d,{onClick:o},{default:w(()=>[_(" 重新渲染 ")]),_:1}),a(R(B),{"table-data":t.value,"onUpdate:tableData":l[0]||(l[0]=p=>t.value=p),class:"right-bar-table","use-drag":!0,colums:n,"row-key":"prop"},null,8,["table-data"])])}}};const P=b(J,[["__scopeId","data-v-2c774921"]]),Z={class:"wrapper"},j={__name:"index",setup(s){const i=u([{field1:"field1",field2:"field2","field1-1":"field1-1的数据"},{field1:"aafield1",field2:"aaafield2","field1-1":"aafield1-1的数据"},{field1:"bbfield1",field2:"bbfield2","field1-1":"bbfield1-1的数据"}]),t=u([{label:"序号",type:"index",width:"55",align:"center"},{require:!0,prop:"field1",label:"字段1",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100"}]}]},{prop:"field2",label:"字段2编辑",width:"250",render:({row:e})=>a(f,{class:"no-drag",modelValue:e.field2,"onUpdate:modelValue":l=>e.field2=l},null)},{prop:"field2",labelRender:()=>a(I,{size:"small"},{default:()=>[_("字段2展示")]}),width:"300"},{prop:"field3",label:"备注",minWidth:"100"}]),r=u(null),n=u(!0),o=async e=>{n.value=!1,t.value=e,await y(),n.value=!0};return(e,l)=>(h(),C("div",Z,[a(R(B),{"table-data":i.value,"onUpdate:tableData":l[0]||(l[0]=d=>i.value=d),"use-drag":!0,colums:t.value},null,8,["table-data","colums"]),a(P,{ref_key:"rightBarRef",ref:r,onReRender:o},null,512)]))}};const _e=b(j,[["__scopeId","data-v-507da829"]]);export{_e as default};
