var F=Object.defineProperty;var z=(n,e,t)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var O=(n,e,t)=>(z(n,typeof e!="symbol"?e+"":e,t),t);import{_ as y,a2 as C,e as Y,o as s,c as u,E as m,G as S,S as M,j as p,y as V,F as h,f as w,Y as B,s as g,z as P,b as x,am as X,an as G,ar as $,R as H,v as T,r as k,P as q,A as J}from"./index-021b1ded.js";import{C as K}from"./index-b9a496b3.js";import"./types-5bc7d143.js";const Q=["onClick"],W={key:0,class:"line"},Z={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(n,{emit:e}){const t=n,a=C(),r=Y("addNodeDialogRef"),c=d=>{if(d.id==="canvas-main"||!d)return{x:0,y:0};const o=c(d.offsetParent);return{x:o.x+d.offsetLeft,y:o.y+d.offsetTop}},i=d=>{e("toAdd",d)},l=d=>{if(t.addType==="branch")return e("toAdd");const{x:o,y:f}=c(d.target);r.value.show({x:d.offsetX+o,y:d.offsetY+f},i)};return(d,o)=>(s(),u(h,null,[m("div",S({class:"add-node"},p(a),{onClick:M(l,["stop"])})," + ",16,Q),n.endLine?(s(),u("div",W)):V("",!0)],64))}},R=y(Z,[["__scopeId","data-v-4349605a"]]),ee={},te={class:"node-wrapper"},ne=m("div",{class:"c-circle c-start"}," start ",-1),ae=[ne];function oe(n,e){return s(),u("div",te,ae)}const se=y(ee,[["render",oe]]),ce={},re={class:"node-wrapper"},le=m("div",{class:"c-circle c-end"}," end ",-1),de=[le];function ie(n,e){return s(),u("div",re,de)}const ue=y(ce,[["render",ie]]),_e={},pe={class:"node-wrapper"},me=m("div",{class:"c-circle c-other"}," Error ",-1),fe=[me];function he(n,e){return s(),u("div",pe,fe)}const A=y(_e,[["render",he]]),ve=m("div",{class:"c-circle c-if"}," if ",-1),ye=[ve],we=m("div",{class:"line"},null,-1),ge={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,a=w({get:()=>t.modelValue.branchList,set:l=>e("update:modelValue",{...t.modelValue,branchList:l})}),r=C(),c=l=>{var d;return l?(d=l==null?void 0:l.branchList)!=null&&d.length?l.branchList.reduce((o,f)=>o+Math.max(...f.map(v=>c(v)),1),0):1:0},i=w(()=>c(t.modelValue));return(l,d)=>(s(),u(h,null,[m("div",S({class:"node-wrapper"},p(r)),ye,16),n.isPreview?V("",!0):(s(),u(h,{key:0},[we,m("div",{class:"branch-wrapper branch-wrapper-width",style:P({"--var-col-count":p(i)})},[(s(!0),u(h,null,B(p(a),(o,f)=>(s(),g(D,{key:f,modelValue:p(a)[f],"onUpdate:modelValue":v=>p(a)[f]=v},null,8,["modelValue","onUpdate:modelValue"]))),128))],4)],64))],64))}};const E=n=>(X("data-v-aa73329e"),n=n(),G(),n),be=E(()=>m("div",{class:"c-circle c-switch"}," switch ",-1)),$e=[be],Ve=E(()=>m("div",{class:"line"},null,-1)),Ne={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,a=w({get:()=>t.modelValue.branchList,set:o=>e("update:modelValue",{...t.modelValue,branchList:o})}),r=C(),c=()=>{a.value.push([])},i=o=>{var f;return o?(f=o==null?void 0:o.branchList)!=null&&f.length?o.branchList.reduce((v,b)=>v+Math.max(...b.map(L=>i(L)),1),0):1:0},l=w(()=>i(t.modelValue)),d=o=>{a.value.splice(o,1)};return(o,f)=>(s(),u(h,null,[m("div",S({class:"node-wrapper"},p(r)),$e,16),n.isPreview?V("",!0):(s(),u(h,{key:0},[Ve,x(R,{class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:c}),m("div",{class:"branch-wrapper branch-wrapper-width",style:P({"--var-col-count":p(l)})},[(s(!0),u(h,null,B(p(a),(v,b)=>(s(),g(D,{key:b,modelValue:p(a)[b],"onUpdate:modelValue":L=>p(a)[b]=L,"branch-count":p(a).length,onRemoveBranch:()=>d(b)},null,8,["modelValue","onUpdate:modelValue","branch-count","onRemoveBranch"]))),128))],4)],64))],64))}},ke=y(Ne,[["__scopeId","data-v-aa73329e"]]),xe={},Be={class:"node-wrapper"},Le=m("div",{class:"c-circle c-feat"}," Feat ",-1),Ae=[Le];function Ce(n,e){return s(),u("div",Be,Ae)}const Se=y(xe,[["render",Ce]]),I=[{type:"start",component:$(se),generateNode:()=>new _("start")},{type:"end",component:$(ue),generateNode:()=>new _("end")},{type:"if",component:$(ge),generateNode:()=>new _("if")},{type:"switch",component:$(ke),generateNode:(n=[[],[]])=>new _("switch",{branchList:n})},{type:"feat",component:$(Se),generateNode:()=>new _("feat")}],N=2,U=(n,e=N)=>{const t=n==null?void 0:n.filter(Array.isArray);return t!=null&&t.length?e?t.length>=e?t.slice(0,e):t.slice().concat(new Array(e-t.length).fill(0).map(a=>[])):t.slice():new Array(e).fill(0).map(a=>[])},j=class{constructor(e,t={branchList:[]}){const{branchList:a}=t;if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++j.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:I.some(r=>r.type===e)?e:"error"}),e==="if"){let r=U(a);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>r,set(c){if(c.length!==N)throw new A(`分支数量必须为${N}`);r=c}})}if(e==="switch"){let r=U(a,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>r,set(c){if(c.length<N)throw new A(`分支数量至少为${N}`);r=c}})}}};let _=j;O(_,"id",0);const Pe={type:"error",component:$(A),generateNode:()=>new _("error")},Re=m("div",{class:"line"},null,-1),Ie={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","addNode"],setup(n,{emit:e}){const t=n,a=w({get:()=>t.modelValue,set:c=>e("update:modelValue",c)}),r=w(()=>(I.find(c=>c.type===a.value.type)||Pe).component);return(c,i)=>(s(),u(h,null,[(s(),g(T(p(r)),{modelValue:p(a),"onUpdate:modelValue":i[0]||(i[0]=l=>H(a)?a.value=l:null)},null,8,["modelValue"])),p(a).type!=="end"?(s(),u(h,{key:0},[Re,x(R,{onToAdd:i[1]||(i[1]=l=>e("addNode",l))})],64)):V("",!0)],64))}};const De=["onClick"],je={__name:"SubBtn",emits:["toSub"],setup(n,{emit:e}){const t=a=>e("toSub");return(a,r)=>(s(),u("div",{class:"sub-node",onClick:M(t,["stop"])}," - ",8,De))}},Oe=y(je,[["__scopeId","data-v-a0ec305d"]]),Ue={class:"render-list-wrapper"},Me=m("div",{class:"line"},null,-1),D={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1}},emits:["update:modelValue","removeBranch"],setup(n,{emit:e}){const t=n,a=w({get:()=>t.modelValue,set:c=>e("update:modelValue",c)}),r=(c,i)=>{const l=i.generateNode();a.value.splice(c+1,0,l)};return(c,i)=>(s(),u("div",Ue,[n.startLine?(s(),u(h,{key:0},[n.branchCount>2?(s(),g(Oe,{key:0,onClick:i[0]||(i[0]=l=>e("removeBranch"))})):V("",!0),Me,x(R,{onToAdd:i[1]||(i[1]=l=>r(-1,l))})],64)):V("",!0),(s(!0),u(h,null,B(p(a),(l,d)=>(s(),g(Ie,{key:l.id,modelValue:p(a)[d],"onUpdate:modelValue":o=>p(a)[d]=o,onAddNode:o=>r(d,o)},null,8,["modelValue","onUpdate:modelValue","onAddNode"]))),128))]))}};const Te={class:"select-node-wrapper"},Ee={__name:"AddNodeDialog",setup(n,{expose:e}){const t=k({x:1,y:1}),a=k(!1);let r;const c=(o,f)=>{r=f,t.value=o,a.value=!0},i=()=>{a.value=!1},l=o=>{i(),r(o)},d=k(I.filter(o=>!["start","end"].includes(o.type)));return e({show:c,close:i}),(o,f)=>q((s(),u("div",{class:"add-node-dialog",style:P({"--var-dialog-left":`${t.value.x}px`,"--var-dialog-top":`${t.value.y}px`,"--var-dialog-size":a.value?"300px":"0"})},[m("div",Te,[(s(!0),u(h,null,B(d.value,v=>(s(),g(T(v.component),{key:v.type,"is-preview":!0,onClick:()=>l(v)},null,8,["onClick"]))),128))])],4)),[[p(K),i]])}},Fe=y(Ee,[["__scopeId","data-v-97bc81a4"]]);const ze={id:"canvas-main",class:"canvas-main"},Ye={__name:"Main",setup(n){const e=k([new _("start"),new _("feat"),new _("if",{branchList:[]}),new _("switch",{branchList:[[new _("feat")],[new _("feat")],[new _("feat")],[new _("feat")],[new _("feat")],[new _("feat")]]}),new _("end")]);console.log(e.value);const t=k(null);return J("addNodeDialogRef",t),(a,r)=>(s(),u("div",ze,[x(D,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=c=>e.value=c),"start-line":!1},null,8,["modelValue"]),x(Fe,{ref_key:"addNodeDialogRef",ref:t},null,512)]))}},Xe=y(Ye,[["__scopeId","data-v-36a11126"]]),Ke={__name:"index",setup(n){return(e,t)=>(s(),g(Xe))}};export{Ke as default};
