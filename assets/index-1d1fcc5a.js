import"./base-a1e67152.js";import"./el-scrollbar-018b6f49.js";import{E as f}from"./el-input-7ed1380a.js";import{E as c}from"./el-button-11b5761a.js";import{p as g,m as v}from"./index-06104fad.js";import{E as k,S as D,a as $}from"./sortable.esm-a399430d.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-8b837e4f.js";import{b as t,a as _,F as E,k as S,m as T,p as V,f as A,r as u,_ as b,M as y,a1 as U,o as h,s as z,w,G as F,c as C,j as R}from"./index-602d1ac0.js";import{E as I}from"./index-1645ee74.js";import"./index-bdde0dfa.js";import"./index-e2a4b06e.js";import"./types-2a216b00.js";import"./event-e06a23af.js";import"./typescript-defaf979.js";import"./isNil-c75b1b34.js";import"./index-a01669f0.js";import"./focus-trap-5be08c03.js";import"./aria-60e0cdc6.js";import"./objects-21f092ee.js";import"./index-325a4ae6.js";const q={name:"Column",props:{colums:Array},render:s=>{console.log("render触发111111111111",s);const i=(r,n)=>{const{render:o,type:e,prop:l}=r;if(!["index","selection"].includes(e))return o?o(n):t("span",{class:"no-drag"},[n.row[l]??"—"])},a=r=>r.map(n=>{const{children:o,...e}=n,{require:l,labelRender:d,label:p,render:H,...x}=e;return t(k,x,{default:m=>Array.isArray(o)&&o.length>0?a(o):i(e,m),header:()=>{const m=l?t("span",{style:"color:red;"},[_("*")]):null;return t(E,null,[m,d?d():t("span",null,[p])])}})});return a(s.colums)}};function N(s,i){let a=null;const r=()=>{var e;if(!((e=s==null?void 0:s.value)!=null&&e.$el))return;const o=s.value.$el.querySelector(".el-table__body tbody");o&&(a=new D(o,{handle:".el-table__row .el-table__cell",filter:".el-table__row .cell > .no-drag",preventOnFilter:!1,sort:!0,animation:300,forceFallback:!1,onEnd:i}))},n=()=>{a&&(a==null||a.destroy(),a=null)};S(()=>{r()}),T(()=>{n()})}const M=V({components:{Column:q},props:{tableData:{type:Array,default:()=>[]},colums:{type:Array,default:()=>[]},useDrag:{type:Boolean,default:!1}},emits:["update:tableData","sortChange"],setup(s,{expose:i,emit:a}){const r=A({get:()=>s.tableData,set:o=>a("update:tableData",o)}),n=u(null);return s.useDrag&&N(n,async({oldIndex:o,newIndex:e})=>{const l=r.value,d=l.splice(o,1)[0];l.splice(e,0,d),r.value=[],await y(),r.value=l,a("sortChange")}),i({getSelectionRows:()=>n.value.getSelectionRows(),clearSelection:()=>n.value.clearSelection(),getRef:()=>n.value}),{tableRef:n,newTableData:r}}});function O(s,i,a,r,n,o){const e=U("Column"),l=$;return h(),z(l,F({ref:"tableRef",border:"",data:s.newTableData,style:{width:"100%"},"highlight-current-row":"",class:"cell-no-padding render-table"},s.$attrs),{default:w(()=>[t(e,{colums:s.colums},null,8,["colums"])]),_:1},16,["data"])}const B=b(M,[["render",O]]),W={class:"right-bar"},J={__name:"rightBar",emits:["reRender"],setup(s,{emit:i}){console.log("RightBarRightBar");const a=u([{prop:"field1",label:"字段1",width:"100px"},{prop:"field3",label:"label",width:"100px"},{prop:"field2",label:"field2",width:"100px"}]),r=(e=null)=>{const l={label:"字段label",prop:"字段prop",children:[]};console.log(e,l),e?e.children?e.children.push(l):e.children=[l]:a.value.push(l)},n=[{prop:"label",label:"label",minWidth:"80",render:({row:e})=>t(f,{class:"no-drag",modelValue:e.label,"onUpdate:modelValue":l=>e.label=l},null)},{prop:"prop",label:"prop",minWidth:"80",render:({row:e})=>t(f,{class:"no-drag",modelValue:e.prop,"onUpdate:modelValue":l=>e.prop=l},null)},{prop:"操作",width:"85",labelRender:()=>t("span",null,[t(c,{onClick:()=>r(),size:"small",circle:!0,icon:g},null),t(c,{onClick:()=>r(),size:"small",circle:!0,icon:v},null)]),render:({row:e})=>t("span",null,[t(c,{onClick:()=>r(e),size:"small",circle:!0,icon:g},null),t(c,{onClick:()=>r(),size:"small",circle:!0,icon:v},null)])}],o=()=>{console.log("点击了重新渲染"),i("reRender",JSON.parse(JSON.stringify(a.value)))};return(e,l)=>{const d=c;return h(),C("div",W,[t(d,{onClick:o},{default:w(()=>[_(" 重新渲染 ")]),_:1}),t(R(B),{"table-data":a.value,"onUpdate:tableData":l[0]||(l[0]=p=>a.value=p),class:"right-bar-table","use-drag":!0,colums:n,"row-key":"prop"},null,8,["table-data"])])}}};const j=b(J,[["__scopeId","data-v-2c774921"]]),G={class:"wrapper"},P={__name:"index",setup(s){const i=u([{field1:"field1",field2:"field2","field1-1":"field1-1的数据"},{field1:"aafield1",field2:"aaafield2","field1-1":"aafield1-1的数据"},{field1:"bbfield1",field2:"bbfield2","field1-1":"bbfield1-1的数据"}]),a=u([{label:"序号",type:"index",width:"55",align:"center"},{require:!0,prop:"field1",label:"字段1",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100"}]}]},{prop:"field2",label:"字段2编辑",width:"250",render:({row:e})=>t(f,{class:"no-drag",modelValue:e.field2,"onUpdate:modelValue":l=>e.field2=l},null)},{prop:"field2",labelRender:()=>t(I,{size:"small"},{default:()=>[_("字段2展示")]}),width:"300"},{prop:"field3",label:"备注",minWidth:"100"}]),r=u(null),n=u(!0),o=async e=>{n.value=!1,a.value=e,await y(),n.value=!0};return(e,l)=>(h(),C("div",G,[t(R(B),{"table-data":i.value,"onUpdate:tableData":l[0]||(l[0]=d=>i.value=d),"use-drag":!0,colums:a.value},null,8,["table-data","colums"]),t(j,{ref_key:"rightBarRef",ref:r,onReRender:o},null,512)]))}};const _e=b(P,[["__scopeId","data-v-507da829"]]);export{_e as default};
