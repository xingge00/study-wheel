import{b as t,a as _,F as D,l as x,p as E,A as S,d as $,r as u,P as b,Z as w,aw as T,o as g,C as A,w as y,W as V,c as C,k as R,aE as h,aF as v,m as F}from"./index-274faae7.js";import"./el-scrollbar-ce87f6cc.js";import{E as m}from"./el-input-4516e7eb.js";import{E as c}from"./el-button-44cd7fe3.js";import{E as N,S as U,a as z}from"./sortable.esm-8518297e.js";import{E as I}from"./index-dbd292ce.js";import"./get-e7313515.js";import"./index-a170027c.js";import"./event-9519ab40.js";import"./index-b6b8256e.js";import"./objects-42526cee.js";import"./index-197c75cb.js";const O={name:"Column",props:{colums:Array},render:s=>{console.log("render触发111111111111",s);const i=(r,n)=>{const{render:o,type:e,prop:l}=r;if(!["index","selection"].includes(e))return o?o(n):t("span",{class:"no-drag"},[n.row[l]??"—"])},a=r=>r.map(n=>{const{children:o,...e}=n,{require:l,labelRender:d,label:p,render:H,...k}=e;return t(N,k,{default:f=>Array.isArray(o)&&o.length>0?a(o):i(e,f),header:()=>{const f=l?t("span",{style:"color:red;"},[_("*")]):null;return t(D,null,[f,d?d():t("span",null,[p])])}})});return a(s.colums)}};function q(s,i){let a=null;const r=()=>{var e;if(!((e=s==null?void 0:s.value)!=null&&e.$el))return;const o=s.value.$el.querySelector(".el-table__body tbody");o&&(a=new U(o,{handle:".el-table__row .el-table__cell",filter:".el-table__row .cell > .no-drag",preventOnFilter:!1,sort:!0,animation:300,forceFallback:!1,onEnd:i}))},n=()=>{a&&(a==null||a.destroy(),a=null)};x(()=>{r()}),E(()=>{n()})}const J=S({components:{Column:O},props:{tableData:{type:Array,default:()=>[]},colums:{type:Array,default:()=>[]},useDrag:{type:Boolean,default:!1}},emits:["update:tableData","sortChange"],setup(s,{expose:i,emit:a}){const r=$({get:()=>s.tableData,set:o=>a("update:tableData",o)}),n=u(null);return s.useDrag&&q(n,async({oldIndex:o,newIndex:e})=>{const l=r.value,d=l.splice(o,1)[0];l.splice(e,0,d),r.value=[],await w(),r.value=l,a("sortChange")}),i({getSelectionRows:()=>n.value.getSelectionRows(),clearSelection:()=>n.value.clearSelection(),getRef:()=>n.value}),{tableRef:n,newTableData:r}}});function W(s,i,a,r,n,o){const e=T("Column"),l=z;return g(),A(l,V({ref:"tableRef",border:"",data:s.newTableData,style:{width:"100%"},"highlight-current-row":"",class:"cell-no-padding render-table"},s.$attrs),{default:y(()=>[t(e,{colums:s.colums},null,8,["colums"])]),_:1},16,["data"])}const B=b(J,[["render",W]]),M={class:"right-bar"},P={__name:"rightBar",emits:["reRender"],setup(s,{emit:i}){console.log("RightBarRightBar");const a=u([{prop:"field1",label:"字段1",width:"100"},{prop:"field3",label:"label",width:"100"},{prop:"field2",label:"field2",width:"100"},{prop:"field2",label:"field2",width:"100"}]),r=(e=null)=>{const l={label:"字段label",prop:"字段prop",children:[]};console.log(e,l),e?e.children?e.children.push(l):e.children=[l]:a.value.push(l)},n=[{prop:"label",label:"label",minWidth:"80",render:({row:e})=>t(m,{class:"no-drag",modelValue:e.label,"onUpdate:modelValue":l=>e.label=l},null)},{prop:"prop",label:"prop",minWidth:"80",render:({row:e})=>t(m,{class:"no-drag",modelValue:e.prop,"onUpdate:modelValue":l=>e.prop=l},null)},{prop:"操作",width:"85",labelRender:()=>t("span",null,[t(c,{onClick:()=>r(),size:"small",circle:!0,icon:h},null),t(c,{onClick:()=>r(),size:"small",circle:!0,icon:v},null)]),render:({row:e})=>t("span",null,[t(c,{onClick:()=>r(e),size:"small",circle:!0,icon:h},null),t(c,{onClick:()=>r(),size:"small",circle:!0,icon:v},null)])}],o=()=>{console.log("点击了重新渲染"),console.log(JSON.parse(JSON.stringify(a.value))),i("reRender",JSON.parse(JSON.stringify(a.value)))};return(e,l)=>{const d=c;return g(),C("div",M,[t(d,{onClick:o},{default:y(()=>[_(" 重新渲染 ")]),_:1}),t(R(B),{"table-data":a.value,"onUpdate:tableData":l[0]||(l[0]=p=>a.value=p),class:"right-bar-table","use-drag":!0,colums:n,"row-key":"prop"},null,8,["table-data"])])}}};const Z=b(P,[["__scopeId","data-v-581eeaf5"]]),j={class:"wrapper"},G={__name:"index",setup(s){const i=u([{field1:"field1",field2:"field2","field1-1":"field1-1的数据"},{field1:"aafield1",field2:"aaafield2","field1-1":"aafield1-1的数据"},{field1:"bbfield1",field2:"bbfield2","field1-1":"bbfield1-1的数据"}]),a=u([{label:"序号",type:"index",width:"55",align:"center"},{require:!0,prop:"field1",label:"字段1",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100"}]}]},{prop:"field2",label:"字段2编辑",width:"250",render:({row:e})=>t(m,{class:"no-drag",modelValue:e.field2,"onUpdate:modelValue":l=>e.field2=l},null)},{prop:"field2",labelRender:()=>t(I,{size:"small"},{default:()=>[_("字段2展示")]}),width:"300"},{prop:"field3",label:"备注",minWidth:"100"}]);F(()=>a.value,()=>{console.log("tableColums",a.value)});const r=u(null),n=u(!0),o=async e=>{n.value=!1,a.value=e,await w(),n.value=!0};return(e,l)=>(g(),C("div",j,[t(R(B),{"table-data":i.value,"onUpdate:tableData":l[0]||(l[0]=d=>i.value=d),"use-drag":!0,colums:a.value},null,8,["table-data","colums"]),t(Z,{ref_key:"rightBarRef",ref:r,onReRender:o},null,512)]))}};const se=b(G,[["__scopeId","data-v-f6348491"]]);export{se as default};
