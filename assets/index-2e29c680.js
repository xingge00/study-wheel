import{b as r,a as b,F as D,l as $,p as E,A as S,d as T,r as u,as as h,X as y,am as V,o as p,C as w,w as C,au as A,c as R,k as x,a7 as g,a5 as v,H as U}from"./index-a458e504.js";import"./el-scrollbar-192d852f.js";import{E as _}from"./el-input-aaccd64b.js";import{E as c}from"./el-button-b19e4c7f.js";import{E as z,S as F,a as I}from"./sortable.esm-92f5c4ca.js";import{E as N}from"./index-1b7dd29c.js";import"./index-53563a1d.js";import"./event-9519ab40.js";import"./index-708d6a25.js";const q={name:"Column",props:{colums:Array},render:s=>{const d=(n,t)=>{const{render:o,type:e,prop:l}=n;if(!["index","selection"].includes(e))return o?o(t):r("span",{class:"no-drag"},[t.row[l]??"—"])},a=n=>n.map(t=>{const{children:o,...e}=t,{require:l,labelRender:i,label:f,render:G,...k}=e;return r(z,k,{default:m=>Array.isArray(o)&&o.length>0?a(o):d(e,m),header:()=>{const m=l?r("span",{style:"color:red;"},[b("*")]):null;return r(D,null,[m,i?i():r("span",null,[f])])}})});return a(s.colums)}};function O(s,d){let a=null;const n=()=>{var e;if(!((e=s==null?void 0:s.value)!=null&&e.$el))return;const o=s.value.$el.querySelector(".el-table__body tbody");o&&(a=new F(o,{handle:".el-table__row .el-table__cell",filter:".el-table__row .cell > .no-drag",preventOnFilter:!1,sort:!0,animation:300,forceFallback:!1,onEnd:d}))},t=()=>{a&&(a==null||a.destroy(),a=null)};$(()=>{n()}),E(()=>{t()})}const W=S({components:{Column:q},props:{tableData:{type:Array,default:()=>[]},colums:{type:Array,default:()=>[]},useDrag:{type:Boolean,default:!1}},emits:["update:tableData","sortChange"],setup(s,{expose:d,emit:a}){const n=T({get:()=>s.tableData,set:o=>a("update:tableData",o)}),t=u(null);return s.useDrag&&O(t,async({oldIndex:o,newIndex:e})=>{const l=n.value,i=l.splice(o,1)[0];l.splice(e,0,i),n.value=[],await y(),n.value=l,a("sortChange")}),d({getSelectionRows:()=>t.value.getSelectionRows(),clearSelection:()=>t.value.clearSelection(),getRef:()=>t.value}),{tableRef:t,newTableData:n}}});function J(s,d,a,n,t,o){const e=V("Column"),l=I;return p(),w(l,A({ref:"tableRef",border:"",data:s.newTableData,style:{width:"100%"},"highlight-current-row":"",class:"cell-no-padding render-table"},s.$attrs),{default:C(()=>[r(e,{colums:s.colums},null,8,["colums"])]),_:1},16,["data"])}const B=h(W,[["render",J]]),M={class:"right-bar"},H={__name:"rightBar",emits:["reRender"],setup(s,{emit:d}){console.log("RightBarRightBar");const a=u([{prop:"field1",label:"字段1",width:"100px"},{prop:"field3",label:"label",width:"100px"},{prop:"field2",label:"field2",width:"100px"}]),n=(e=null)=>{const l={label:"字段label",prop:"字段prop",children:[]};console.log(e,l),e?e.children?e.children.push(l):e.children=[l]:a.value.push(l)},t=[{prop:"label",label:"label",minWidth:"80",render:({row:e})=>r(_,{class:"no-drag",modelValue:e.label,"onUpdate:modelValue":l=>e.label=l},null)},{prop:"prop",label:"prop",minWidth:"80",render:({row:e})=>r(_,{class:"no-drag",modelValue:e.prop,"onUpdate:modelValue":l=>e.prop=l},null)},{prop:"操作",width:"85",labelRender:()=>r("span",null,[r(c,{onClick:()=>n(),size:"small",circle:!0,icon:g},null),r(c,{onClick:()=>n(),size:"small",circle:!0,icon:v},null)]),render:({row:e})=>r("span",null,[r(c,{onClick:()=>n(e),size:"small",circle:!0,icon:g},null),r(c,{onClick:()=>n(),size:"small",circle:!0,icon:v},null)])}],o=()=>{console.log("点击了重新渲染"),d("reRender",JSON.parse(JSON.stringify(a.value)))};return(e,l)=>{const i=c;return p(),R("div",M,[r(i,{onClick:o},{default:C(()=>[b(" 重新渲染 ")]),_:1}),r(x(B),{"table-data":a.value,"onUpdate:tableData":l[0]||(l[0]=f=>a.value=f),class:"right-bar-table","use-drag":!0,colums:t,"row-key":"prop"},null,8,["table-data"])])}}};const P=h(H,[["__scopeId","data-v-2c774921"]]),X={class:"wrapper"},j={__name:"index",setup(s){const d=u([{field1:"field1",field2:"field2","field1-1":"field1-1的数据"},{field1:"aafield1",field2:"aaafield2","field1-1":"aafield1-1的数据"},{field1:"bbfield1",field2:"bbfield2","field1-1":"bbfield1-1的数据"}]),a=u([{label:"序号",type:"index",width:"55",align:"center"},{require:!0,prop:"field1",label:"字段1",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100",children:[{prop:"field1-1",label:"字段1-1",width:"100"},{prop:"field1-2",label:"字段1-2",width:"100"}]}]},{prop:"field2",label:"字段2编辑",width:"250",render:({row:e})=>r(_,{class:"no-drag",modelValue:e.field2,"onUpdate:modelValue":l=>e.field2=l},null)},{prop:"field2",labelRender:()=>r(N,{size:"small"},{default:()=>[b("字段2展示")]}),width:"300"},{prop:"field3",label:"备注",minWidth:"100"}]),n=u(null),t=u(!0),o=async e=>{t.value=!1,a.value=e,await y(),t.value=!0};return(e,l)=>(p(),R("div",X,[t.value?(p(),w(x(B),{key:0,"table-data":d.value,"onUpdate:tableData":l[0]||(l[0]=i=>d.value=i),"use-drag":!0,colums:a.value},null,8,["table-data","colums"])):U("",!0),r(P,{ref_key:"rightBarRef",ref:n,onReRender:o},null,512)]))}};const re=h(j,[["__scopeId","data-v-f66804a5"]]);export{re as default};
