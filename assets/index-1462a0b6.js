var Re=Object.defineProperty;var Oe=(s,n,t)=>n in s?Re(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var ye=(s,n,t)=>(Oe(s,typeof n!="symbol"?n+"":n,t),t);import{a as Fe,d as Ue,l as le,i as ie,c as je,_ as ze,w as Ke}from"./base-3b388ce9.js";import{i as Ne,a as Ge,b as He,d as Xe,c as Ye,E as qe}from"./el-button-1392d39d.js";import{l as de,A as $e,v as k,r as B,d as oe,k as Le,o as v,c as C,L as A,i as a,E as M,R as We,C as S,w as O,D as Z,G as T,V as H,b as F,H as te,S as J,j as re,n as Je,ar as we,_ as z,$ as ce,t as U,M as Y,F as P,B as K,a as j,U as W,a0 as ue,as as q,a4 as ke,am as Qe,an as Ze,Q as he,at as Ie,a2 as et,a8 as tt,I as ne}from"./index-e472d089.js";import{C as Be}from"./index-a592b2f1.js";import{E as nt,a as at}from"./el-tab-pane-9362d50d.js";import{E as ot,a as st}from"./el-form-item-ab97699d.js";import{E as lt,a as rt}from"./el-radio-button-1d4dd7bb.js";import{E as ct}from"./el-input-e48268a3.js";import{u as ut,f as it,E as se,l as dt}from"./index-75784bb9.js";import{i as vt}from"./validator-d98c31c3.js";import{U as ve,C as pe,I as fe,d as pt,t as ft}from"./event-e06a23af.js";import"./index-4f922f19.js";import"./get-e7313515.js";import"./index-ca67eeff.js";import"./typescript-defaf979.js";import"./strings-67d04ee4.js";import"./aria-60e0cdc6.js";import"./vnode-82c350ad.js";import"./objects-ff0defaa.js";import"./isNil-c75b1b34.js";const mt=Fe({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:Ne},inactiveIcon:{type:Ne},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:Ue(Function)},size:{type:String,validator:vt},tabindex:{type:[String,Number]}}),ht={[ve]:s=>le(s)||de(s)||ie(s),[pe]:s=>le(s)||de(s)||ie(s),[fe]:s=>le(s)||de(s)||ie(s)},_t=["onClick"],gt=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],bt=["aria-hidden"],yt=["aria-hidden"],Nt=["aria-hidden"],me="ElSwitch",wt=$e({name:me}),It=$e({...wt,props:mt,emits:ht,setup(s,{expose:n,emit:t}){const e=s,c=re(),{formItem:i}=Ge(),r=He(),o=je("switch");ut({from:'"value"',replacement:'"model-value" or "v-model"',scope:me,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},k(()=>{var l;return!!((l=c.vnode.props)!=null&&l.value)}));const{inputId:g}=Xe(e,{formItemContext:i}),_=Ye(k(()=>e.loading)),y=B(e.modelValue!==!1),m=B(),N=B(),d=k(()=>[o.b(),o.m(r.value),o.is("disabled",_.value),o.is("checked",f.value)]),D=k(()=>({width:it(e.width)}));oe(()=>e.modelValue,()=>{y.value=!0}),oe(()=>e.value,()=>{y.value=!1});const w=k(()=>y.value?e.modelValue:e.value),f=k(()=>w.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(w.value)||(t(ve,e.inactiveValue),t(pe,e.inactiveValue),t(fe,e.inactiveValue)),oe(f,l=>{var h;m.value.checked=l,e.validateEvent&&((h=i==null?void 0:i.validate)==null||h.call(i,"change").catch(p=>pt()))});const b=()=>{const l=f.value?e.inactiveValue:e.activeValue;t(ve,l),t(pe,l),t(fe,l),Je(()=>{m.value.checked=f.value})},L=()=>{if(_.value)return;const{beforeChange:l}=e;if(!l){b();return}const h=l();[we(h),le(h)].includes(!0)||ft(me,"beforeChange must return type `Promise<boolean>` or `boolean`"),we(h)?h.then(V=>{V&&b()}).catch(V=>{}):h&&b()},$=k(()=>o.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),u=()=>{var l,h;(h=(l=m.value)==null?void 0:l.focus)==null||h.call(l)};return Le(()=>{m.value.checked=f.value}),n({focus:u,checked:f}),(l,h)=>(v(),C("div",{class:M(a(d)),style:te(a($)),onClick:J(L,["prevent"])},[A("input",{id:a(g),ref_key:"input",ref:m,class:M(a(o).e("input")),type:"checkbox",role:"switch","aria-checked":a(f),"aria-disabled":a(_),name:l.name,"true-value":l.activeValue,"false-value":l.inactiveValue,disabled:a(_),tabindex:l.tabindex,onChange:b,onKeydown:We(L,["enter"])},null,42,gt),!l.inlinePrompt&&(l.inactiveIcon||l.inactiveText)?(v(),C("span",{key:0,class:M([a(o).e("label"),a(o).em("label","left"),a(o).is("active",!a(f))])},[l.inactiveIcon?(v(),S(a(se),{key:0},{default:O(()=>[(v(),S(Z(l.inactiveIcon)))]),_:1})):T("v-if",!0),!l.inactiveIcon&&l.inactiveText?(v(),C("span",{key:1,"aria-hidden":a(f)},H(l.inactiveText),9,bt)):T("v-if",!0)],2)):T("v-if",!0),A("span",{ref_key:"core",ref:N,class:M(a(o).e("core")),style:te(a(D))},[l.inlinePrompt?(v(),C("div",{key:0,class:M(a(o).e("inner"))},[l.activeIcon||l.inactiveIcon?(v(),S(a(se),{key:0,class:M(a(o).is("icon"))},{default:O(()=>[(v(),S(Z(a(f)?l.activeIcon:l.inactiveIcon)))]),_:1},8,["class"])):l.activeText||l.inactiveText?(v(),C("span",{key:1,class:M(a(o).is("text")),"aria-hidden":!a(f)},H(a(f)?l.activeText:l.inactiveText),11,yt)):T("v-if",!0)],2)):T("v-if",!0),A("div",{class:M(a(o).e("action"))},[l.loading?(v(),S(a(se),{key:0,class:M(a(o).is("loading"))},{default:O(()=>[F(a(dt))]),_:1},8,["class"])):T("v-if",!0)],2)],6),!l.inlinePrompt&&(l.activeIcon||l.activeText)?(v(),C("span",{key:1,class:M([a(o).e("label"),a(o).em("label","right"),a(o).is("active",a(f))])},[l.activeIcon?(v(),S(a(se),{key:0},{default:O(()=>[(v(),S(Z(l.activeIcon)))]),_:1})):T("v-if",!0),!l.activeIcon&&l.activeText?(v(),C("span",{key:1,"aria-hidden":!a(f)},H(l.activeText),9,Nt)):T("v-if",!0)],2)):T("v-if",!0)],14,_t))}});var Dt=ze(It,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Se=Ke(Dt);const Vt=["onClick"],Ct={key:0,class:"line"},$t={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(s,{emit:n}){const t=s,e=ce(),c=U("addNodeDialogRef"),i=_=>{if(_.id==="canvas-main"||!_)return{x:0,y:0};const y=i(_.offsetParent);return{x:y.x+_.offsetLeft,y:y.y+_.offsetTop}},r=_=>{n("toAdd",_)},o=re(),g=_=>{if(t.addType==="branch")return n("toAdd");const{target:y,offsetY:m}=_,{x:N,y:d}=i(y);c.value.show({x:y.clientWidth+N,y:m+d},r,o)};return(_,y)=>(v(),C(P,null,[A("div",Y({class:"add-node"},a(e),{onClick:J(g,["stop"])})," + ",16,Vt),s.endLine?(v(),C("div",Ct)):T("",!0)],64))}},_e=z($t,[["__scopeId","data-v-77b265a2"]]);const Lt=["onClick"],kt={__name:"SubBtn",emits:["toSub"],setup(s,{emit:n}){const t=U("hoverStack"),e=c=>{t.value=[],n("toSub")};return(c,i)=>(v(),C("div",{class:"sub-node",onClick:J(e,["stop"])}," - ",8,Lt))}},Ae=z(kt,[["__scopeId","data-v-554bf87e"]]),Bt={},St={class:"node-wrapper"},At={class:"c-circle c-start"};function xt(s,n){return v(),C("div",St,[A("div",At,[K(s.$slots,"showName",{},()=>[j(" start ")])])])}const Tt=z(Bt,[["render",xt]]),Et={},Mt={class:"node-wrapper"},Pt={class:"c-circle c-end"};function Rt(s,n){return v(),C("div",Mt,[A("div",Pt,[K(s.$slots,"showName",{},()=>[j(" end ")])])])}const Ot=z(Et,[["render",Rt]]),Ft={},Ut={class:"node-wrapper"},jt={class:"c-circle c-other"};function zt(s,n){return v(),C("div",Ut,[K(s.$slots,"default"),A("div",jt,[K(s.$slots,"showName",{},()=>[j(" error ")])])])}const xe=z(Ft,[["render",zt]]),ge=s=>{var n;return s?(n=s==null?void 0:s.branchList)!=null&&n.length?s.branchList.reduce((t,e)=>t+Math.max(...e.map(c=>ge(c)),1),0):1:0},De=s=>Array.isArray(s)?Math.max(...s.map(n=>ge(n)),1):1,Kt=A("div",{class:"line"},null,-1),Te={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(s,{emit:n}){const t=s,e=k({get:()=>t.modelValue||[],set:u=>n("update:modelValue",u)}),c=k(()=>{var u,l,h,p,V,E;return((u=t.curNode)==null?void 0:u.type)==="switch"?(((h=(l=t.curNode)==null?void 0:l.nodeInfo)==null?void 0:h.branchInfoList)||[]).map(I=>I==null?void 0:I.branchName):((p=t.curNode)==null?void 0:p.type)==="if"?(((E=(V=t.curNode)==null?void 0:V.nodeInfo)==null?void 0:E.branchInfoList)||[]).map(I=>I.branchName):[]}),i=k(()=>ge(t.curNode)),r=k(()=>{var u;return De((u=e.value)==null?void 0:u[0])}),o=k(()=>{var u;return De((u=e.value)==null?void 0:u[e.value.length-1])}),g=U("activateNode"),_=U("hoverStack"),y=k(()=>_.value[0]),m=u=>_.value.unshift(e.value[u]),N=u=>_.value.shift(),d=B(null),D=u=>{d.value=u,e.value[u]},w=()=>{d.value=null},f=u=>{d.value!==null&&u.preventDefault()},b=(u,l,h)=>{let p=Math.min(l,h),V=Math.max(l,h);const E=u[l];for(;p<V;)l<h?u[p]=u[++p]:u[V]=u[--V],p===V&&(u[p]=E)},L=u=>{var l,h;d.value===u||d.value===null||(b(e.value||[],d.value,u),b(((h=(l=t.curNode)==null?void 0:l.nodeInfo)==null?void 0:h.branchInfoList)||[],d.value,u),d.value=null)},$=u=>{g.value=e.value[u]};return(u,l)=>(v(),C(P,null,[Kt,["switch"].includes(s.curNode.type)?(v(),S(_e,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:l[0]||(l[0]=h=>n("addBranch"))})):T("",!0),A("div",{class:"branch-wrapper branch-wrapper-width",style:te({"--var-col-count":a(i),"--var-first-branch-col-count":a(r),"--var-last-branch-col-count":a(o)})},[(v(!0),C(P,null,W(a(e),(h,p)=>(v(),S(Me,{key:p,modelValue:a(e)[p],"onUpdate:modelValue":V=>a(e)[p]=V,class:M({"hover-branch":a(y)===a(e)[p]||a(g)===a(e)[p],"can-drop-branch":d.value!==null&&d.value!==p}),"branch-count":a(e).length,"branch-name":a(c)[p],draggable:!0,onMouseenter:()=>m(p),onMouseleave:()=>N(),onRemoveBranch:()=>n("removeBranch",p),onDragstart:J(()=>D(p),["stop"]),onDragover:l[1]||(l[1]=V=>f(V)),onDropCapture:()=>L(p),onDragend:w,onClick:J(()=>$(p),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},Gt={class:"c-circle c-if"},Ht={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:n}){const t=s,e=k({get:()=>t.modelValue.branchList,set:r=>n("update:modelValue",{...t.modelValue,branchList:r})}),c=ce(),i=r=>{var o;return r?(o=r==null?void 0:r.branchList)!=null&&o.length?r.branchList.reduce((g,_)=>g+Math.max(..._.map(y=>i(y)),1),0):1:0};return k(()=>i(t.modelValue)),(r,o)=>(v(),C(P,null,[A("div",Y({class:"node-wrapper"},a(c)),[K(r.$slots,"default"),A("div",Gt,[K(r.$slots,"showName",{},()=>[j(" if ")])])],16),s.isPreview?T("",!0):(v(),S(Te,{key:0,modelValue:a(e),"onUpdate:modelValue":o[0]||(o[0]=g=>ue(e)?e.value=g:null),"cur-node":s.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Xt={class:"c-circle c-switch"},Yt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:n}){const t=s,e=k({get:()=>t.modelValue.branchList||[],set:o=>n("update:modelValue",{...t.modelValue,branchList:o})}),c=ce(),i=()=>{const o=e.value.push([]);t.modelValue.nodeInfo.branchInfoList[o]={}},r=o=>{e.value.splice(o,1),t.modelValue.nodeInfo.branchInfoList.splice(o,1)};return(o,g)=>(v(),C(P,null,[A("div",Y({class:"node-wrapper"},a(c)),[K(o.$slots,"default",{},void 0,!0),A("div",Xt,[K(o.$slots,"showName",{},()=>[j(" switch ")],!0)])],16),s.isPreview?T("",!0):(v(),S(Te,{key:0,modelValue:a(e),"onUpdate:modelValue":g[0]||(g[0]=_=>ue(e)?e.value=_:null),"cur-node":s.modelValue,onAddBranch:i,onRemoveBranch:r},null,8,["modelValue","cur-node"]))],64))}},qt=z(Yt,[["__scopeId","data-v-c8b2d440"]]),Wt={class:"node-wrapper"},Jt={class:"c-circle c-feat"},Qt={__name:"Feat",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(s){return(n,t)=>(v(),C("div",Wt,[K(n.$slots,"default"),A("div",Jt,[K(n.$slots,"showName",{},()=>[j(" Feat ")])])]))}},be=[{type:"start",component:q(Tt),generateNode:()=>new x("start")},{type:"end",component:q(Ot),generateNode:()=>new x("end")},{type:"if",component:q(Ht),generateNode:()=>new x("if")},{type:"switch",component:q(qt),generateNode:(s=[[],[]])=>new x("switch",{branchList:s})},{type:"feat",component:q(Qt),generateNode:()=>new x("feat")}],ee=2,Ve=(s,n=ee)=>{const t=s==null?void 0:s.filter(Array.isArray);return t!=null&&t.length?n?t.length>=n?t.slice(0,n):t.slice().concat(new Array(n-t.length).fill(0).map(e=>[])):t.slice():new Array(n).fill(0).map(e=>[])},Ce=()=>({code:""}),Zt=({type:s,branchList:n})=>{const e={if:{condition:"",branchInfoList:[{branchName:"分支1",type:!0},{branchName:"分支2",type:!1}]},switch:{branchInfoList:(n||[]).map((c,i)=>({branchName:`分支${i}`,condition:""}))}}[s]||{};return e.type=s,e.nodeName=s,e},X=class{constructor(n,t){const{branchList:e=[],nodeInfo:c={}}=t||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++X.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:be.some(o=>o.type===n)?n:"error"}),n==="if"){const o=Ve(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(o,{get(g,_,y){return Reflect.get(g,_,y)},set(g,_,y,m){return["0","1"].includes(_)?Reflect.set(g,_,y,m):(console.error(`分支数量必须为${ee}`),!1)}})}})}if(n==="switch"){let o=Ve(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>o,set(g){if(g.length<ee)throw new xe(`分支数量至少为${ee}`);o=g}})}const i=Zt(this);Object.assign(i,c);const r=new Proxy(i,{get(o,g,_){return Reflect.get(o,g,_)},set(o,g,_,y){return console.log("修改了",o,"的",g,"为",_),Reflect.set(o,g,_,y)}});this.nodeInfo=r}static copyBranchList(n){return(n==null?void 0:n.map(t=>(t==null?void 0:t.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new X(this.type,{branchList:X.copyBranchList(this.branchList),nodeInfo:JSON.parse(JSON.stringify(this.nodeInfo))})}static executeNode(n,t=[],e){e||(e=Ce());const{type:c,branchList:i}=n;let r;c==="if"&&(r=X.executeList(i[0],t)),c==="switch"&&(r=X.executeList(i[0],t));const o={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${r.context.code}
        }
      `,switch:()=>`switch(){
        ${r.context.code}
      }
      `};return e.code+=o[c](),{result:t,context:e}}static executeList(n,t=[]){const e=Ce();return{result:n.reduce((i,r)=>X.executeNode(r,i,e).result,t),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((n,t)=>{let e=`${n},${t}:`;return Array.isArray(this[t])?e+=`[${this[t].toString()}]`:typeof this[t]=="number"?e+=`${this[t].toString()}`:typeof this[t]=="string"?e+=`"${this[t].toString()}"`:e+=`{${this[t].toString()}}`,e},"").slice(1)}}`}};let x=X;ye(x,"id",0);const en={type:"error",component:q(xe),generateNode:()=>new x("error")},Ee=(s,n,t=null)=>{for(let e in s){e=e-0;const c=s[e];if(c===n)return{nodeList:s,parentNode:t,nodeIdx:e,branchIdx:null};for(let i in c.branchList||[]){i=i-0;const r=c.branchList[i];if(r===n)return{nodeList:r,parentNode:c,branchIdx:i,nodeIdx:null};const o=Ee(r,n,c);if(o)return o}}return null},ae=s=>{var e,c;const n=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],t=((c=window==null?void 0:window.__activateNode)==null?void 0:c.value)||null;return Ee(n||[],s||t)},tn=["draggable","onDragstart","onClick"],nn=A("div",{class:"line"},null,-1),an={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(s,{emit:n}){const t=s,e=k({get:()=>t.modelValue,set:u=>n("update:modelValue",u)}),c=k({get:()=>t.nodeList,set:u=>n("update:nodeList",u)}),i=k(()=>(be.find(u=>u.type===e.value.type)||en).component),r=U("hoverStack"),o=U("dragConf"),g=U("activateNode"),_=k(()=>r.value[0]),y=()=>r.value.unshift(e.value),m=()=>r.value.shift(),N=()=>{console.log("dragstart"),o.value.customDragData={node:e.value,curBranch:c.value,target:null};const u=[],l=(h,p)=>{var V;!p&&u.push(h),(V=h==null?void 0:h.branchList)!=null&&V.length&&h.branchList.forEach(E=>{u.push(E),E.forEach(I=>l(I))})};l(e.value,!0),o.value.dragFlag=!0,o.value.banDropNodeList=u},d=()=>{o.value.dragFlag=!1,o.value.banDropNodeList=[]},D=re(),w=()=>{o.value.customDragData&&(o.value.banDropNodeList.includes(e)||ke(o.value.customDragData.target)===D&&(n("moveTo",o.value.customDragData.node,o.value.customDragData.curBranch),o.value.customDragData=null,r.value=[]))},f=()=>{o.value.customDragData&&(o.value.customDragData.target=D)},b=()=>{o.value.customDragData&&(o.value.customDragData.target=null)},L=u=>{o.value.dragFlag&&!o.value.banDropNodeList.includes(e.value)&&u.preventDefault()},$=()=>{g.value=e.value};return(u,l)=>(v(),C(P,null,[A("div",{draggable:!["start","end"].includes(a(e).type),class:M(["node-box",{"hover-node":a(_)===a(e)||a(g)===a(e),"no-branch-box":!["if","switch"].includes(a(e).type)}]),onMouseenter:y,onMouseleave:m,onDragstart:J(N,["stop"]),onDragend:d,onClick:J($,["stop"])},[(v(),S(Z(a(i)),{modelValue:a(e),"onUpdate:modelValue":l[1]||(l[1]=h=>ue(e)?e.value=h:null)},{showName:O(()=>[j(H(a(e).nodeInfo.nodeName||a(e).type),1)]),default:O(()=>[F(Ae,{onToSub:l[0]||(l[0]=h=>n("subNode"))})]),_:1},8,["modelValue"]))],42,tn),a(e).type!=="end"?(v(),C(P,{key:0},[nn,F(_e,{class:M({canDropFlag:a(o).dragFlag&&!a(o).banDropNodeList.includes(a(e))}),onToAdd:l[2]||(l[2]=h=>n("addNode",h)),onDragover:L,onDrop:w,onDragenter:f,onDragleave:b},null,8,["class"])],64)):T("",!0)],64))}};const on=s=>(Qe("data-v-435c42c5"),s=s(),Ze(),s),sn=on(()=>A("div",{class:"line"},null,-1)),ln={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(s,{emit:n}){const t=s,e=ce(),c=k({get:()=>t.modelValue,set:f=>n("update:modelValue",f)}),i=U("branchNameFlag"),r=U("dragConf"),o=U("hoverStack"),g=(f,b)=>{const L=b.generateNode();c.value.splice(f+1,0,L)},_=(f,b,L)=>{const $=b.findIndex(u=>u===f);if(b===c.value){if($===L+1||$===L)return;$>L?(b.splice($,1),b.splice(L+1,0,f)):(b.splice(L+1,0,f),b.splice($,1))}else b.splice($,1),c.value.splice(L+1,0,f)},y=f=>{c.value.splice(f,1)},m=re(),N=()=>{r.value.customDragData&&(r.value.banDropNodeList.includes(c)||ke(r.value.customDragData.target)===m&&(_(r.value.customDragData.node,r.value.customDragData.curBranch,-1),o.value=[],r.value.customDragData=null))},d=()=>{r.value.customDragData&&(r.value.customDragData.target=m)},D=()=>{r.value.customDragData&&(r.value.customDragData.target=null)},w=f=>{r.value.dragFlag&&!r.value.banDropNodeList.includes(c.value)&&f.preventDefault()};return(f,b)=>(v(),C("div",Y({class:"render-list-wrapper"},a(e)),[s.startLine?(v(),C(P,{key:0},[s.branchCount>2?(v(),S(Ae,{key:0,onClick:b[0]||(b[0]=L=>n("removeBranch"))})):T("",!0),a(i)?(v(),C("div",{key:1,class:M(["branch-name",{placeholder:!s.branchName}])},H(s.branchName||"未命名"),3)):T("",!0),sn,F(_e,{class:M({canDropFlag:a(r).dragFlag&&!a(r).banDropNodeList.includes(a(c))}),droppable:a(r).dragFlag&&!a(r).banDropNodeList.includes(a(c)),onToAdd:b[1]||(b[1]=L=>g(-1,L)),onDragover:w,onDrop:N,onDragenter:d,onDragleave:D},null,8,["class","droppable"])],64)):T("",!0),(v(!0),C(P,null,W(a(c),(L,$)=>(v(),S(an,{key:L.id,modelValue:a(c)[$],"onUpdate:modelValue":u=>a(c)[$]=u,"node-list":a(c),"onUpdate:nodeList":b[2]||(b[2]=u=>ue(c)?c.value=u:null),onAddNode:u=>g($,u),onSubNode:()=>y($),onMoveTo:(u,l)=>_(u,l,$)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},Me=z(ln,[["__scopeId","data-v-435c42c5"]]);const rn={class:"select-node-wrapper"},cn={__name:"AddNodeDialog",setup(s,{expose:n}){const t=B({x:1,y:1}),e=B(!1);let c,i;const r=()=>{e.value=!1,c=null,i=null},o=(y,m,N)=>{if(i===N)return r();i=N,c=m,t.value=y,e.value=!0},g=y=>{c==null||c(y),r()},_=B(be.filter(y=>!["start","end"].includes(y.type)));return n({show:o,close:r}),(y,m)=>he((v(),C("div",{class:"add-node-dialog",style:te({"--var-dialog-left":`${t.value.x+15}px`,"--var-dialog-top":`${t.value.y+15}px`,"--var-dialog-size":e.value?"300px":"0"})},[A("div",rn,[(v(!0),C(P,null,W(_.value,N=>(v(),S(Z(N.component),{key:N.type,"is-preview":!0,onClick:()=>g(N)},null,8,["onClick"]))),128))])],4)),[[a(Be),r]])}},un=z(cn,[["__scopeId","data-v-281649fe"]]);const dn={__name:"Condition",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},attr:{type:Object,default:()=>({})}},emits:["change"],setup(s,{emit:n}){const t=s,e=B(t.modelValue.findIndex(o=>o.type)),c=t.attr.curActivateBranchIdx,i=(t.attr.curActivateBranchIdx+1)%2,r=o=>{t.modelValue[c].type=o===c,t.modelValue[i].type=o!==c,n("change",t.modelValue)};return(o,g)=>{const _=Se;return v(),C("div",null,[F(_,{modelValue:e.value,"onUpdate:modelValue":g[0]||(g[0]=y=>e.value=y),disabled:s.disabled,"active-value":a(c),"inactive-value":i,onChange:r},null,8,["modelValue","disabled","active-value"])])}}};const vn={class:"tab-pane-content"},pn={class:"module-name"},fn={__name:"NodeInfo",setup(s){const n=U("activateNode"),t=k(()=>Array.isArray(n.value)),e=B(null),c=B(null);oe(()=>n.value,d=>{if(t.value){const{parentNode:D,branchIdx:w}=ae(n.value);c.value=w,e.value=D}else c.value=null,e.value=n.value},{deep:!0,immediate:!0});const i=k({get:()=>{var d;return((d=e.value)==null?void 0:d.nodeInfo)||{}},set:d=>{e.value.nodeInfo=d}}),r=d=>{if(!d)return{};const{type:D}=d,w=(f,b,L,$,u={})=>f&&f!==D?!1:{label:b,field:L,type:$,...u};return{base:[{moduleName:"基本信息",attrs:[w(null,"节点类型","type","input",{disabled:!0}),w(null,"节点名称","nodeName","input"),w("if","判断条件","condition","input",{required:!0})].filter(Boolean)},{moduleName:"分支信息",attrs:[w("if","分支名称",`branchInfoList.${c.value}.branchName`,"input",{disabled:!1}),w("if","设为true分支","branchInfoList","custom",{component:q(dn),nodeInfo:i,curActivateBranchIdx:c.value}),w("switch","分支名称",`branchInfoList.${c.value}.branchName`,"input"),w("switch","判断条件",`branchInfoList.${c.value}.condition`,"input",{required:!0})].filter(Boolean).filter(f=>t.value)},{moduleName:"输入参数",attrs:[].filter(Boolean)},{moduleName:"输出参数",attrs:[].filter(Boolean)}].filter(f=>{var b;return(b=f==null?void 0:f.attrs)==null?void 0:b.length}),other:[].filter(f=>{var b;return(b=f==null?void 0:f.attrs)==null?void 0:b.length})}},o=k(()=>{const{base:d,other:D}=r(e.value);return[{label:"基础属性",modules:d},{label:"其他属性",modules:D}]}),g=B("基础属性"),_=k({get(){return d=>{const D=(d==null?void 0:d.split("."))||[];return D.reduce((w,f)=>(w==null?void 0:w[f])||void 0,D.length?i.value:void 0)}}}),y=d=>typeof d=="object"&&d!==null,m=(d,D)=>{const w=(D==null?void 0:D.split("."))||[];if(w.length)if(w.length===1)i.value[w[0]]=d;else{const f=w.pop();try{let b="nodeInfo";const L=w.reduce(($,u)=>(b+=`.${u}`,y($[u])||(console.warn(`${b}不是一个对象，已强制转化为对象`),$[u]={}),$[u]),w.length?i.value:void 0);L[f]=d}catch(b){console.error(`nodeInfo数据异常，无法读取${D}字段`),console.error(b)}}},N=d=>({disabled:d==null?void 0:d.disabled,modelValue:d.field&&_.value(d.field)||d.defaultValue,onInput:D=>m(D,d.field),onChange:D=>m(D,d.field)});return(d,D)=>{const w=ct,f=Se,b=lt,L=rt,$=ot,u=st,l=nt,h=at;return v(),S(h,{modelValue:g.value,"onUpdate:modelValue":D[0]||(D[0]=p=>g.value=p),stretch:!0},{default:O(()=>[(v(!0),C(P,null,W(a(o),p=>(v(),S(l,{key:p.label,label:p.label,name:p.label},{default:O(()=>[F(u,{model:a(i),"label-width":"100px"},{default:O(()=>[j(H(a(i))+" ",1),A("div",vn,[(v(!0),C(P,null,W(p.modules,(V,E)=>(v(),C("div",{key:E,class:"module-content"},[A("div",pn,H(V.moduleName),1),(v(!0),C(P,null,W(V.attrs,(I,Q)=>(v(),C("div",{key:Q},[F($,{label:I.label,rules:I.required&&[{required:!0,message:""}]},{default:O(()=>[I.type==="input"?(v(),S(w,Ie(Y({key:0},N(I))),null,16)):I.type==="switch"?(v(),S(f,Y({key:I},N(I),{"active-value":I.activeValue,"inactive-value":I.inactiveValue}),null,16,["active-value","inactive-value"])):I.type==="radio"?(v(),S(L,Ie(Y({key:2},N(I))),{default:O(()=>[(v(!0),C(P,null,W(I.options,R=>(v(),S(b,{key:R.value,label:R.label,value:R.value},null,8,["label","value"]))),128))]),_:2},1040)):I.type==="custom"?(v(),S(Z(I.component),Y({key:3},N(I),{attr:I}),null,16,["attr"])):T("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},mn=z(fn,[["__scopeId","data-v-270d0857"]]);const hn={__name:"index",setup(s){const n="350px",t=U("activateNode"),e=B(null),c=B(!1);oe(()=>t.value,r=>{r&&(e.value=r,c.value=!0)});const i=()=>{c.value=!1,e.value=null};return(r,o)=>he((v(),C("div",{style:te({"--var-width":n,"--var-right":c.value?0:`-${n}`,"--var-opacity":Number(c.value)}),class:"custom-drawer"},[e.value?(v(),S(mn,{key:0})):T("",!0)],4)),[[a(Be),i]])}},_n=z(hn,[["__scopeId","data-v-04587e00"]]);function gn(){let n=[0,0];const t=B([0,0]),e=B([0,0]),c=m=>{var N;![...m.target.classList].includes("canvas-main")&&!([...m.target.classList].includes("render-list-wrapper")&&((N=m.target.attributes.draggable)==null?void 0:N.value)!=="true")||(m.target.style.cursor="grab",console.log("e.target.style.cursor",m.target.style.cursor),n=[m.screenX,m.screenY],document.onmousemove=function(d){d.target.style.cursor="grabbing",console.log("onmousemove"),e.value=[(d.screenX-n[0])*1,(d.screenY-n[1])*1]})},i=m=>{var f;(f=m==null?void 0:m.target)!=null&&f.style&&(m.target.style.cursor="default");const[N,d]=t.value,[D,w]=e.value;t.value=[N+D,d+w],e.value=[0,0],document.onmousemove=document.onmouseup=null},r=B(100),o=k(()=>r.value/100);let g=null;const _=m=>{if(m===0)return;const N=r.value+m;return m>0&&N>=300||m<0&&N<=10?!1:(r.value+=m,!0)},y=m=>{var p;(p=m.preventDefault)==null||p.call(m);const[N,d]=t.value,D=m.wheelDelta?m.wheelDelta<0:m.detail>0;if(!m.ctrlKey){D?t.value=[N,d-30]:t.value=[N,d+30];return}const{width:w=0,height:f=0}=(g==null?void 0:g.getBoundingClientRect())||{},{pageX:b,pageY:L}=m,[$,u]=[w/2,f/2],[l,h]=[(b-$)/$*20,(L-u)/u*20];if(D){if(!_(-10))return;t.value=[N+l,d+h]}else{if(!_(10))return;t.value=[N-l,d-h]}};return Le(()=>{g=document.querySelector("#canvas-main"),document.addEventListener("mouseleave",m=>{i(m)})}),{handleMouseDown:c,handleMouseUp:i,positionDist:t,calcDist:e,onMouseWheel:y,scale:o}}const bn={class:"left-top-wrapper"},yn={class:"canvas-node-container"},Nn={__name:"Main",setup(s){const n=B([new x("start"),new x("feat"),new x("if",{branchList:[[new x("feat")]]}),new x("switch",{branchList:[[new x("feat")],[new x("feat")],[new x("feat")]]}),new x("end")]);window.__nodeList=n;const t=B(null);ne("addNodeDialogRef",t);const e=B([]);ne("hoverStack",e);const c=B({banDropNodeList:[],dragFlag:!1,customDragData:null});ne("dragConf",c);const i=B(null);ne("activateNode",i),window.__activateNode=i,et(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const r=B(null),o=()=>{var R;const h=i.value;if(!h||["start","end"].includes(h.type))return;const{parentNode:p,branchIdx:V,nodeList:E,nodeIdx:I}=ae(h);let Q=null;if(Array.isArray(h)){if(((R=p.branchList)==null?void 0:R.length)<=ee)throw new Error(`分支数量至少为${ee},剪切失败！`);(p.branchList||[]).splice(V,1),Q=p.nodeInfo.branchInfoList.splice(V,1)[0]}else E.splice(I,1);r.value={type:"shear",data:h,branchInfo:Q}},g=()=>{const h=i.value;if(!h||["start","end"].includes(h.type))return;const{branchIdx:p,parentNode:V}=ae();r.value={type:"copy",data:h,branchInfo:p===null?null:JSON.parse(JSON.stringify(V.nodeInfo.branchInfoList[p]||{}))}},_=h=>{if(!r.value)return;const{type:p,data:V,branchInfo:E}=r.value;if(!V||["end"].includes(i.value.type))return;const I={copyNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:R,nodeIdx:G}=ae();R.splice(G+1,0,V.copySelf())},shearNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:R,nodeIdx:G}=ae();R.splice(G+1,0,V),r.value=null},copyBranch:()=>{var G;if(((G=i.value)==null?void 0:G.type)!=="switch")return;const R=i.value.branchList.push(V.map(Pe=>Pe.copySelf()));i.value.nodeInfo.branchInfoList[R-1]=E},shearBranch:()=>{var G;if(((G=i.value)==null?void 0:G.type)!=="switch")return;const R=i.value.branchList.push(V);i.value.nodeInfo.branchInfoList[R-1]=E,r.value=null}},Q=p+(Array.isArray(V)?"Branch":"Node");I[Q]()},y=B(!0),m=()=>{y.value=!y.value},N=B(!0),d=()=>{N.value=!N.value};ne("branchNameFlag",N);const D=B(""),w=()=>{console.log("BaseNode.executeList(nodeList.value, [])",x.executeList(n.value,[]));const h=x.executeList(n.value,[]);D.value=h.context.code},{handleMouseDown:f,handleMouseUp:b,positionDist:L,calcDist:$,onMouseWheel:u,scale:l}=gn();return(h,p)=>{const V=qe,E=tt("mousetrap");return v(),C(P,null,[A("div",{id:"canvas-main",class:"canvas-main",style:te({"--var-position-x":`${a(L)[0]+a($)[0]}px`,"--var-position-y":`${a(L)[1]+a($)[1]}px`,"--var-position-scale":a(l)}),onClickCapture:p[1]||(p[1]=I=>i.value=null),onMousedown:p[2]||(p[2]=(...I)=>a(f)&&a(f)(...I)),onMouseup:p[3]||(p[3]=(...I)=>a(b)&&a(b)(...I)),onMousewheel:p[4]||(p[4]=(...I)=>a(u)&&a(u)(...I))},[A("div",bn,[F(V,{onClick:m},{default:O(()=>[j(" 快捷建："+H(y.value?"开启":"关闭"),1)]),_:1}),F(V,{onClick:d},{default:O(()=>[j(" 显示分支名："+H(N.value?"开启":"关闭"),1)]),_:1}),F(V,{onClick:w},{default:O(()=>[j(" 执行 ")]),_:1})]),A("div",yn,[F(Me,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=I=>n.value=I),"start-line":!1},null,8,["modelValue"])])],36),F(un,{ref_key:"addNodeDialogRef",ref:t},null,512),F(a(_n)),y.value?he((v(),C("div",{key:0,"onMod+c":p[5]||(p[5]=()=>g()),"onMod+x":p[6]||(p[6]=()=>o()),"onMod+v":_},null,544)),[[E,["mod+c","mod+v","mod+x"]]]):T("",!0)],64)}}},wn=z(Nn,[["__scopeId","data-v-ad0bc132"]]),Kn={__name:"index",setup(s){return(n,t)=>(v(),S(wn))}};export{Kn as default};
