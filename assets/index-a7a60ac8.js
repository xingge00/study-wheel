var H=Object.defineProperty;var X=(t,e,o)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var j=(t,e,o)=>(X(t,typeof e!="symbol"?e+"":e,o),o);import{_ as w,a2 as k,e as U,o as l,c as p,E as f,G as C,S as T,j as u,y as g,F as v,f as h,s as b,Y as A,z as E,R as L,am as G,an as q,ar as V,v as z,x as J,b as N,r as $,P as K,A as O}from"./index-a207c1c5.js";import{C as Q}from"./index-7df475be.js";import"./types-45d79a48.js";const W=["onClick"],Z={key:0,class:"line"},ee={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(t,{emit:e}){const o=t,n=k(),d=U("addNodeDialogRef"),c=s=>{if(s.id==="canvas-main"||!s)return{x:0,y:0};const i=c(s.offsetParent);return{x:i.x+s.offsetLeft,y:i.y+s.offsetTop}},r=s=>{e("toAdd",s)},a=s=>{if(o.addType==="branch")return e("toAdd");const{x:i,y:m}=c(s.target);d.value.show({x:s.offsetX+i,y:s.offsetY+m},r)};return(s,i)=>(l(),p(v,null,[f("div",C({class:"add-node"},u(n),{onClick:T(a,["stop"])})," + ",16,W),t.endLine?(l(),p("div",Z)):g("",!0)],64))}},S=w(ee,[["__scopeId","data-v-4349605a"]]),te={},ne={class:"node-wrapper"},oe=f("div",{class:"c-circle c-start"}," start ",-1),ae=[oe];function se(t,e){return l(),p("div",ne,ae)}const ce=w(te,[["render",se]]),re={},le={class:"node-wrapper"},de=f("div",{class:"c-circle c-end"}," end ",-1),ie=[de];function ue(t,e){return l(),p("div",le,ie)}const _e=w(re,[["render",ue]]),pe={},me={class:"node-wrapper"},fe=f("div",{class:"c-circle c-other"}," Error ",-1),he=[fe];function ve(t,e){return l(),p("div",me,he)}const x=w(pe,[["render",ve]]),R=t=>{var e;return t?(e=t==null?void 0:t.branchList)!=null&&e.length?t.branchList.reduce((o,n)=>o+Math.max(...n.map(d=>R(d)),1),0):1:0},D=t=>Array.isArray(t)?Math.max(...t.map(e=>R(e)),1):1,ye=f("div",{class:"line"},null,-1),F={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(t,{emit:e}){const o=t,n=h({get:()=>o.modelValue||[],set:a=>e("update:modelValue",a)}),d=h(()=>R(o.curNode)),c=h(()=>{var a;return D((a=n.value)==null?void 0:a[0])}),r=h(()=>{var a;return D((a=n.value)==null?void 0:a[n.value.length-1])});return(a,s)=>(l(),p(v,null,[ye,t.curNode.type==="switch"?(l(),b(S,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:s[0]||(s[0]=i=>e("addBranch"))})):g("",!0),f("div",{class:"branch-wrapper branch-wrapper-width",style:E({"--var-col-count":u(d),"--var-first-branch-col-count":u(c),"--var-last-branch-col-count":u(r)})},[(l(!0),p(v,null,A(u(n),(i,m)=>(l(),b(Y,{key:m,modelValue:u(n)[m],"onUpdate:modelValue":y=>u(n)[m]=y,"branch-count":u(n).length,onRemoveBranch:()=>e("removeBranch",m)},null,8,["modelValue","onUpdate:modelValue","branch-count","onRemoveBranch"]))),128))],4)],64))}},be=f("div",{class:"c-circle c-if"}," if ",-1),we=[be],ge={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const o=t,n=h({get:()=>o.modelValue.branchList,set:r=>e("update:modelValue",{...o.modelValue,branchList:r})}),d=k(),c=r=>{var a;return r?(a=r==null?void 0:r.branchList)!=null&&a.length?r.branchList.reduce((s,i)=>s+Math.max(...i.map(m=>c(m)),1),0):1:0};return h(()=>c(o.modelValue)),(r,a)=>(l(),p(v,null,[f("div",C({class:"node-wrapper"},u(d)),we,16),t.isPreview?g("",!0):(l(),b(F,{key:0,modelValue:u(n),"onUpdate:modelValue":a[0]||(a[0]=s=>L(n)?n.value=s:null),"cur-node":t.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Ve=t=>(G("data-v-33b11b19"),t=t(),q(),t),$e=Ve(()=>f("div",{class:"c-circle c-switch"}," switch ",-1)),Be=[$e],Ne={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const o=t,n=h({get:()=>o.modelValue.branchList||[],set:a=>e("update:modelValue",{...o.modelValue,branchList:a})}),d=k(),c=()=>{n.value.push([])},r=a=>{n.value.splice(a,1)};return(a,s)=>(l(),p(v,null,[f("div",C({class:"node-wrapper"},u(d)),Be,16),t.isPreview?g("",!0):(l(),b(F,{key:0,modelValue:u(n),"onUpdate:modelValue":s[0]||(s[0]=i=>L(n)?n.value=i:null),"cur-node":t.modelValue,onAddBranch:c,onRemoveBranch:r},null,8,["modelValue","cur-node"]))],64))}},xe=w(Ne,[["__scopeId","data-v-33b11b19"]]),ke={},Ce={class:"node-wrapper"},Ae=f("div",{class:"c-circle c-feat"}," Feat ",-1),Le=[Ae];function Se(t,e){return l(),p("div",Ce,Le)}const Re=w(ke,[["render",Se]]),P=[{type:"start",component:V(ce),generateNode:()=>new _("start")},{type:"end",component:V(_e),generateNode:()=>new _("end")},{type:"if",component:V(ge),generateNode:()=>new _("if")},{type:"switch",component:V(xe),generateNode:(t=[[],[]])=>new _("switch",{branchList:t})},{type:"feat",component:V(Re),generateNode:()=>new _("feat")}],B=2,M=(t,e=B)=>{const o=t==null?void 0:t.filter(Array.isArray);return o!=null&&o.length?e?o.length>=e?o.slice(0,e):o.slice().concat(new Array(e-o.length).fill(0).map(n=>[])):o.slice():new Array(e).fill(0).map(n=>[])},I=class{constructor(e,o={branchList:[]}){const{branchList:n}=o;if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++I.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:P.some(d=>d.type===e)?e:"error"}),e==="if"){let d=M(n);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>d,set(c){if(c.length!==B)throw new x(`分支数量必须为${B}`);d=c}})}if(e==="switch"){let d=M(n,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>d,set(c){if(c.length<B)throw new x(`分支数量至少为${B}`);d=c}})}}};let _=I;j(_,"id",0);const Pe={type:"error",component:V(x),generateNode:()=>new _("error")},Ie=f("div",{class:"line"},null,-1),je={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","addNode"],setup(t,{emit:e}){const o=t,n=h({get:()=>o.modelValue,set:i=>e("update:modelValue",i)}),d=h(()=>(P.find(i=>i.type===n.value.type)||Pe).component),c=U("hoverStack"),r=h(()=>c.value[0]),a=()=>c.value.unshift(n.value),s=()=>c.value.shift();return(i,m)=>(l(),p(v,null,[f("div",{class:J(["node-box",{"hover-node":u(r)===u(n)}]),onMouseenter:a,onMouseleave:s},[(l(),b(z(u(d)),{modelValue:u(n),"onUpdate:modelValue":m[0]||(m[0]=y=>L(n)?n.value=y:null)},null,8,["modelValue"]))],34),u(n).type!=="end"?(l(),p(v,{key:0},[Ie,N(S,{onToAdd:m[1]||(m[1]=y=>e("addNode",y))})],64)):g("",!0)],64))}};const Oe=["onClick"],De={__name:"SubBtn",emits:["toSub"],setup(t,{emit:e}){const o=n=>e("toSub");return(n,d)=>(l(),p("div",{class:"sub-node",onClick:T(o,["stop"])}," - ",8,Oe))}},Me=w(De,[["__scopeId","data-v-a0ec305d"]]),Ue={class:"render-list-wrapper"},Te=f("div",{class:"line"},null,-1),Y={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1}},emits:["update:modelValue","removeBranch"],setup(t,{emit:e}){const o=t,n=h({get:()=>o.modelValue,set:c=>e("update:modelValue",c)}),d=(c,r)=>{const a=r.generateNode();n.value.splice(c+1,0,a)};return(c,r)=>(l(),p("div",Ue,[t.startLine?(l(),p(v,{key:0},[t.branchCount>2?(l(),b(Me,{key:0,onClick:r[0]||(r[0]=a=>e("removeBranch"))})):g("",!0),Te,N(S,{onToAdd:r[1]||(r[1]=a=>d(-1,a))})],64)):g("",!0),(l(!0),p(v,null,A(u(n),(a,s)=>(l(),b(je,{key:a.id,modelValue:u(n)[s],"onUpdate:modelValue":i=>u(n)[s]=i,onAddNode:i=>d(s,i)},null,8,["modelValue","onUpdate:modelValue","onAddNode"]))),128))]))}};const Ee={class:"select-node-wrapper"},ze={__name:"AddNodeDialog",setup(t,{expose:e}){const o=$({x:1,y:1}),n=$(!1);let d;const c=(i,m)=>{d=m,o.value=i,n.value=!0},r=()=>{n.value=!1},a=i=>{r(),d(i)},s=$(P.filter(i=>!["start","end"].includes(i.type)));return e({show:c,close:r}),(i,m)=>K((l(),p("div",{class:"add-node-dialog",style:E({"--var-dialog-left":`${o.value.x}px`,"--var-dialog-top":`${o.value.y}px`,"--var-dialog-size":n.value?"300px":"0"})},[f("div",Ee,[(l(!0),p(v,null,A(s.value,y=>(l(),b(z(y.component),{key:y.type,"is-preview":!0,onClick:()=>a(y)},null,8,["onClick"]))),128))])],4)),[[u(Q),r]])}},Fe=w(ze,[["__scopeId","data-v-97bc81a4"]]);const Ye={id:"canvas-main",class:"canvas-main"},He={__name:"Main",setup(t){const e=$([new _("start"),new _("feat"),new _("if",{branchList:[]}),new _("switch",{branchList:[[new _("feat")],[new _("feat")],[new _("feat")],[new _("feat")],[new _("feat")],[new _("feat")]]}),new _("end")]);console.log(e.value);const o=$(null);O("addNodeDialogRef",o);const n=$([]);return O("hoverStack",n),(d,c)=>(l(),p("div",Ye,[N(Y,{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=r=>e.value=r),"start-line":!1},null,8,["modelValue"]),N(Fe,{ref_key:"addNodeDialogRef",ref:o},null,512)]))}},Xe=w(He,[["__scopeId","data-v-e765cfe8"]]),Qe={__name:"index",setup(t){return(e,o)=>(l(),b(Xe))}};export{Qe as default};
