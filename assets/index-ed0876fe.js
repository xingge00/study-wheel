var Ue=Object.defineProperty;var je=(s,a,t)=>a in s?Ue(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var De=(s,a,t)=>(je(s,typeof a!="symbol"?a+"":a,t),t);import{a as ze,d as He,l as ce,i as fe,c as Ke,_ as qe,w as Ge}from"./base-80479b14.js";import{i as $e,a as We,b as Xe,d as Ye,c as Je,E as Qe}from"./el-button-67003521.js";import{l as me,A as Se,v as S,r as B,d as se,k as Ae,o as v,c as $,L as x,i as o,E as R,R as Ze,C as A,w as M,D as te,G as T,V as q,b as O,H as Z,S as ee,j as ie,n as et,ar as Ve,_ as z,$ as de,t as j,M as Y,F,B as H,a as U,U as Q,a0 as ve,as as J,a4 as xe,am as tt,an as nt,Q as pe,at as Ce,a2 as at,a8 as ot,I as ae}from"./index-e28733d7.js";import{C as ye}from"./index-0f87b0e1.js";import{E as st,a as lt}from"./el-tab-pane-65a980a5.js";import{E as rt,a as ct}from"./el-form-item-b14e0b6f.js";import{E as ut,a as it}from"./el-radio-button-e9c77caf.js";import{E as dt}from"./el-input-83913e2b.js";import{u as vt,f as pt,E as re,l as ft}from"./index-9b5292f3.js";import{i as mt}from"./validator-6f9546e4.js";import{U as he,C as _e,I as ge,d as ht,t as _t}from"./event-e06a23af.js";import"./index-d7deb1c9.js";import"./get-e7313515.js";import"./index-2140aa0c.js";import"./typescript-defaf979.js";import"./strings-d8987ae7.js";import"./aria-60e0cdc6.js";import"./vnode-e6af0d48.js";import"./objects-2d1d279d.js";import"./isNil-c75b1b34.js";const gt=ze({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:$e},inactiveIcon:{type:$e},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:He(Function)},size:{type:String,validator:mt},tabindex:{type:[String,Number]}}),bt={[he]:s=>ce(s)||me(s)||fe(s),[_e]:s=>ce(s)||me(s)||fe(s),[ge]:s=>ce(s)||me(s)||fe(s)},yt=["onClick"],Nt=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],wt=["aria-hidden"],It=["aria-hidden"],Dt=["aria-hidden"],be="ElSwitch",$t=Se({name:be}),Vt=Se({...$t,props:gt,emits:bt,setup(s,{expose:a,emit:t}){const e=s,c=ie(),{formItem:u}=We(),l=Xe(),n=Ke("switch");vt({from:'"value"',replacement:'"model-value" or "v-model"',scope:be,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},S(()=>{var r;return!!((r=c.vnode.props)!=null&&r.value)}));const{inputId:h}=Ye(e,{formItemContext:u}),m=Je(S(()=>e.loading)),_=B(e.modelValue!==!1),p=B(),b=B(),d=S(()=>[n.b(),n.m(l.value),n.is("disabled",m.value),n.is("checked",f.value)]),I=S(()=>({width:pt(e.width)}));se(()=>e.modelValue,()=>{_.value=!0}),se(()=>e.value,()=>{_.value=!1});const w=S(()=>_.value?e.modelValue:e.value),f=S(()=>w.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(w.value)||(t(he,e.inactiveValue),t(_e,e.inactiveValue),t(ge,e.inactiveValue)),se(f,r=>{var y;p.value.checked=r,e.validateEvent&&((y=u==null?void 0:u.validate)==null||y.call(u,"change").catch(D=>ht()))});const g=()=>{const r=f.value?e.inactiveValue:e.activeValue;t(he,r),t(_e,r),t(ge,r),et(()=>{p.value.checked=f.value})},k=()=>{if(m.value)return;const{beforeChange:r}=e;if(!r){g();return}const y=r();[Ve(y),ce(y)].includes(!0)||_t(be,"beforeChange must return type `Promise<boolean>` or `boolean`"),Ve(y)?y.then(V=>{V&&g()}).catch(V=>{}):y&&g()},L=S(()=>n.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),i=()=>{var r,y;(y=(r=p.value)==null?void 0:r.focus)==null||y.call(r)};return Ae(()=>{p.value.checked=f.value}),a({focus:i,checked:f}),(r,y)=>(v(),$("div",{class:R(o(d)),style:Z(o(L)),onClick:ee(k,["prevent"])},[x("input",{id:o(h),ref_key:"input",ref:p,class:R(o(n).e("input")),type:"checkbox",role:"switch","aria-checked":o(f),"aria-disabled":o(m),name:r.name,"true-value":r.activeValue,"false-value":r.inactiveValue,disabled:o(m),tabindex:r.tabindex,onChange:g,onKeydown:Ze(k,["enter"])},null,42,Nt),!r.inlinePrompt&&(r.inactiveIcon||r.inactiveText)?(v(),$("span",{key:0,class:R([o(n).e("label"),o(n).em("label","left"),o(n).is("active",!o(f))])},[r.inactiveIcon?(v(),A(o(re),{key:0},{default:M(()=>[(v(),A(te(r.inactiveIcon)))]),_:1})):T("v-if",!0),!r.inactiveIcon&&r.inactiveText?(v(),$("span",{key:1,"aria-hidden":o(f)},q(r.inactiveText),9,wt)):T("v-if",!0)],2)):T("v-if",!0),x("span",{ref_key:"core",ref:b,class:R(o(n).e("core")),style:Z(o(I))},[r.inlinePrompt?(v(),$("div",{key:0,class:R(o(n).e("inner"))},[r.activeIcon||r.inactiveIcon?(v(),A(o(re),{key:0,class:R(o(n).is("icon"))},{default:M(()=>[(v(),A(te(o(f)?r.activeIcon:r.inactiveIcon)))]),_:1},8,["class"])):r.activeText||r.inactiveText?(v(),$("span",{key:1,class:R(o(n).is("text")),"aria-hidden":!o(f)},q(o(f)?r.activeText:r.inactiveText),11,It)):T("v-if",!0)],2)):T("v-if",!0),x("div",{class:R(o(n).e("action"))},[r.loading?(v(),A(o(re),{key:0,class:R(o(n).is("loading"))},{default:M(()=>[O(o(ft))]),_:1},8,["class"])):T("v-if",!0)],2)],6),!r.inlinePrompt&&(r.activeIcon||r.activeText)?(v(),$("span",{key:1,class:R([o(n).e("label"),o(n).em("label","right"),o(n).is("active",o(f))])},[r.activeIcon?(v(),A(o(re),{key:0},{default:M(()=>[(v(),A(te(r.activeIcon)))]),_:1})):T("v-if",!0),!r.activeIcon&&r.activeText?(v(),$("span",{key:1,"aria-hidden":!o(f)},q(r.activeText),9,Dt)):T("v-if",!0)],2)):T("v-if",!0)],14,yt))}});var Ct=qe(Vt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Te=Ge(Ct);const Lt=["onClick"],kt={key:0,class:"line"},Bt={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(s,{emit:a}){const t=s,e=de(),c=j("addNodeDialogRef"),u=m=>{if(m.id==="canvas-main"||!m)return{x:0,y:0};const _=u(m.offsetParent);return{x:_.x+m.offsetLeft,y:_.y+m.offsetTop}},l=m=>{a("toAdd",m)},n=ie(),h=m=>{if(t.addType==="branch")return a("toAdd");const{target:_,offsetY:p}=m,{x:b,y:d}=u(_);c.value.show({x:_.clientWidth+b,y:p+d},l,n)};return(m,_)=>(v(),$(F,null,[x("div",Y({class:"add-node"},o(e),{onClick:ee(h,["stop"])})," + ",16,Lt),s.endLine?(v(),$("div",kt)):T("",!0)],64))}},Ne=z(Bt,[["__scopeId","data-v-77b265a2"]]);const St=["onClick"],At={__name:"SubBtn",emits:["toSub"],setup(s,{emit:a}){const t=j("hoverStack"),e=c=>{t.value=[],a("toSub")};return(c,u)=>(v(),$("div",{class:"sub-node",onClick:ee(e,["stop"])}," - ",8,St))}},Ee=z(At,[["__scopeId","data-v-554bf87e"]]),xt={},Tt={class:"node-wrapper"},Et={class:"c-circle c-start"};function Pt(s,a){return v(),$("div",Tt,[x("div",Et,[H(s.$slots,"showName",{},()=>[U(" start ")])])])}const Mt=z(xt,[["render",Pt]]),Rt={},Ot={class:"node-wrapper"},Ft={class:"c-circle c-end"};function Ut(s,a){return v(),$("div",Ot,[x("div",Ft,[H(s.$slots,"showName",{},()=>[U(" end ")])])])}const jt=z(Rt,[["render",Ut]]),zt={},Ht={class:"node-wrapper"},Kt={class:"c-circle c-other"};function qt(s,a){return v(),$("div",Ht,[H(s.$slots,"default"),x("div",Kt,[H(s.$slots,"showName",{},()=>[U(" error ")])])])}const Pe=z(zt,[["render",qt]]),we=s=>{var a;return s?(a=s==null?void 0:s.branchList)!=null&&a.length?s.branchList.reduce((t,e)=>t+Math.max(...e.map(c=>we(c)),1),0):1:0},Le=s=>Array.isArray(s)?Math.max(...s.map(a=>we(a)),1):1,Gt=x("div",{class:"line"},null,-1),Me={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(s,{emit:a}){const t=s,e=S({get:()=>t.modelValue||[],set:i=>a("update:modelValue",i)}),c=S(()=>{var i,r,y,D,V,C;return((i=t.curNode)==null?void 0:i.type)==="switch"?(((y=(r=t.curNode)==null?void 0:r.nodeInfo)==null?void 0:y.branchInfoList)||[]).map(N=>N==null?void 0:N.branchName):((D=t.curNode)==null?void 0:D.type)==="if"?(((C=(V=t.curNode)==null?void 0:V.nodeInfo)==null?void 0:C.branchInfoList)||[]).map(N=>N.branchName):[]}),u=S(()=>we(t.curNode)),l=S(()=>{var i;return Le((i=e.value)==null?void 0:i[0])}),n=S(()=>{var i;return Le((i=e.value)==null?void 0:i[e.value.length-1])}),h=j("activateNode"),m=j("hoverStack"),_=S(()=>m.value[0]),p=i=>m.value.unshift(e.value[i]),b=i=>m.value.shift(),d=B(null),I=i=>{d.value=i,e.value[i]},w=()=>{d.value=null},f=i=>{d.value!==null&&i.preventDefault()},g=(i,r,y)=>{let D=Math.min(r,y),V=Math.max(r,y);const C=i[r];for(;D<V;)r<y?i[D]=i[++D]:i[V]=i[--V],D===V&&(i[D]=C)},k=i=>{var r,y;d.value===i||d.value===null||(g(e.value||[],d.value,i),g(((y=(r=t.curNode)==null?void 0:r.nodeInfo)==null?void 0:y.branchInfoList)||[],d.value,i),d.value=null)},L=i=>{h.value=e.value[i]};return(i,r)=>(v(),$(F,null,[Gt,["switch"].includes(s.curNode.type)?(v(),A(Ne,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:r[0]||(r[0]=y=>a("addBranch"))})):T("",!0),x("div",{class:"branch-wrapper branch-wrapper-width",style:Z({"--var-col-count":o(u),"--var-first-branch-col-count":o(l),"--var-last-branch-col-count":o(n)})},[(v(!0),$(F,null,Q(o(e),(y,D)=>(v(),A(Oe,{key:D,modelValue:o(e)[D],"onUpdate:modelValue":V=>o(e)[D]=V,class:R({"hover-branch":o(_)===o(e)[D]||o(h)===o(e)[D],"can-drop-branch":d.value!==null&&d.value!==D}),"branch-count":o(e).length,"branch-name":o(c)[D],draggable:!0,onMouseenter:()=>p(D),onMouseleave:()=>b(),onRemoveBranch:()=>a("removeBranch",D),onDragstart:ee(()=>I(D),["stop"]),onDragover:r[1]||(r[1]=V=>f(V)),onDropCapture:()=>k(D),onDragend:w,onClick:ee(()=>L(D),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},Wt={class:"c-circle c-if"},Xt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:a}){const t=s,e=S({get:()=>t.modelValue.branchList,set:l=>a("update:modelValue",{...t.modelValue,branchList:l})}),c=de(),u=l=>{var n;return l?(n=l==null?void 0:l.branchList)!=null&&n.length?l.branchList.reduce((h,m)=>h+Math.max(...m.map(_=>u(_)),1),0):1:0};return S(()=>u(t.modelValue)),(l,n)=>(v(),$(F,null,[x("div",Y({class:"node-wrapper"},o(c)),[H(l.$slots,"default"),x("div",Wt,[H(l.$slots,"showName",{},()=>[U(" if ")])])],16),s.isPreview?T("",!0):(v(),A(Me,{key:0,modelValue:o(e),"onUpdate:modelValue":n[0]||(n[0]=h=>ve(e)?e.value=h:null),"cur-node":s.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Yt={class:"c-circle c-switch"},Jt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:a}){const t=s,e=S({get:()=>t.modelValue.branchList||[],set:n=>a("update:modelValue",{...t.modelValue,branchList:n})}),c=de(),u=()=>{const n=e.value.push([]);t.modelValue.nodeInfo.branchInfoList[n]={}},l=n=>{e.value.splice(n,1),t.modelValue.nodeInfo.branchInfoList.splice(n,1)};return(n,h)=>(v(),$(F,null,[x("div",Y({class:"node-wrapper"},o(c)),[H(n.$slots,"default",{},void 0,!0),x("div",Yt,[H(n.$slots,"showName",{},()=>[U(" switch ")],!0)])],16),s.isPreview?T("",!0):(v(),A(Me,{key:0,modelValue:o(e),"onUpdate:modelValue":h[0]||(h[0]=m=>ve(e)?e.value=m:null),"cur-node":s.modelValue,onAddBranch:u,onRemoveBranch:l},null,8,["modelValue","cur-node"]))],64))}},Qt=z(Jt,[["__scopeId","data-v-c8b2d440"]]),Zt={class:"node-wrapper"},en={class:"c-circle c-feat"},tn={__name:"Feat",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(s){return(a,t)=>(v(),$("div",Zt,[H(a.$slots,"default"),x("div",en,[H(a.$slots,"showName",{},()=>[U(" Feat ")])])]))}},Ie=[{type:"start",component:J(Mt),generateNode:()=>new E("start")},{type:"end",component:J(jt),generateNode:()=>new E("end")},{type:"if",component:J(Xt),generateNode:()=>new E("if")},{type:"switch",component:J(Qt),generateNode:(s=[[],[]])=>new E("switch",{branchList:s})},{type:"feat",component:J(tn),generateNode:()=>new E("feat")}],ne=2,ke=(s,a=ne)=>{const t=s==null?void 0:s.filter(Array.isArray);return t!=null&&t.length?a?t.length>=a?t.slice(0,a):t.slice().concat(new Array(a-t.length).fill(0).map(e=>[])):t.slice():new Array(a).fill(0).map(e=>[])},Be=()=>({code:""}),nn=({type:s,branchList:a})=>{const e={if:{condition:"",branchInfoList:[{branchName:"分支1",type:!0},{branchName:"分支2",type:!1}]},switch:{condition:"",branchInfoList:(a||[]).map((c,u)=>({branchName:`分支${u}`,condition:""}))}}[s]||{};return e.type=s,e.nodeName=s,e},X=class{constructor(a,t){const{branchList:e=[],nodeInfo:c={}}=t||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++X.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:Ie.some(n=>n.type===a)?a:"error"}),a==="if"){const n=ke(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(n,{get(h,m,_){return Reflect.get(h,m,_)},set(h,m,_,p){return["0","1"].includes(m)?Reflect.set(h,m,_,p):(console.error(`分支数量必须为${ne}`),!1)}})}})}if(a==="switch"){let n=ke(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>n,set(h){if(h.length<ne)throw new Pe(`分支数量至少为${ne}`);n=h}})}const u=nn(this);Object.assign(u,c);const l=new Proxy(u,{get(n,h,m){return Reflect.get(n,h,m)},set(n,h,m,_){return console.log("修改了",n,"的",h,"为",m),Reflect.set(n,h,m,_)}});this.nodeInfo=l}static copyBranchList(a){return(a==null?void 0:a.map(t=>(t==null?void 0:t.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new X(this.type,{branchList:X.copyBranchList(this.branchList),nodeInfo:JSON.parse(JSON.stringify(this.nodeInfo))})}static executeNode(a,t=[],e){e||(e=Be());const{type:c,branchList:u}=a;let l;c==="if"&&(l=X.executeList(u[0],t)),c==="switch"&&(l=X.executeList(u[0],t));const n={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${l.context.code}
        }
      `,switch:()=>`switch(){
        ${l.context.code}
      }
      `};return e.code+=n[c](),{result:t,context:e}}static executeList(a,t=[]){const e=Be();return{result:a.reduce((u,l)=>X.executeNode(l,u,e).result,t),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((a,t)=>{let e=`${a},${t}:`;return Array.isArray(this[t])?e+=`[${this[t].toString()}]`:typeof this[t]=="number"?e+=`${this[t].toString()}`:typeof this[t]=="string"?e+=`"${this[t].toString()}"`:e+=`{${this[t].toString()}}`,e},"").slice(1)}}`}};let E=X;De(E,"id",0);const an={type:"error",component:J(Pe),generateNode:()=>new E("error")},Re=(s,a,t=null)=>{for(let e in s){e=e-0;const c=s[e];if(c===a)return{nodeList:s,parentNode:t,nodeIdx:e,branchIdx:null};for(let u in c.branchList||[]){u=u-0;const l=c.branchList[u];if(l===a)return{nodeList:l,parentNode:c,branchIdx:u,nodeIdx:null};const n=Re(l,a,c);if(n)return n}}return null},oe=s=>{var e,c;const a=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],t=((c=window==null?void 0:window.__activateNode)==null?void 0:c.value)||null;return Re(a||[],s||t)},on=["draggable","onDragstart","onClick"],sn=x("div",{class:"line"},null,-1),ln={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(s,{emit:a}){const t=s,e=S({get:()=>t.modelValue,set:i=>a("update:modelValue",i)}),c=S({get:()=>t.nodeList,set:i=>a("update:nodeList",i)}),u=S(()=>(Ie.find(i=>i.type===e.value.type)||an).component),l=j("hoverStack"),n=j("dragConf"),h=j("activateNode"),m=S(()=>l.value[0]),_=()=>l.value.unshift(e.value),p=()=>l.value.shift(),b=()=>{console.log("dragstart"),n.value.customDragData={node:e.value,curBranch:c.value,target:null};const i=[],r=(y,D)=>{var V;!D&&i.push(y),(V=y==null?void 0:y.branchList)!=null&&V.length&&y.branchList.forEach(C=>{i.push(C),C.forEach(N=>r(N))})};r(e.value,!0),n.value.dragFlag=!0,n.value.banDropNodeList=i},d=()=>{n.value.dragFlag=!1,n.value.banDropNodeList=[]},I=ie(),w=()=>{n.value.customDragData&&(n.value.banDropNodeList.includes(e)||xe(n.value.customDragData.target)===I&&(a("moveTo",n.value.customDragData.node,n.value.customDragData.curBranch),n.value.customDragData=null,l.value=[]))},f=()=>{n.value.customDragData&&(n.value.customDragData.target=I)},g=()=>{n.value.customDragData&&(n.value.customDragData.target=null)},k=i=>{n.value.dragFlag&&!n.value.banDropNodeList.includes(e.value)&&i.preventDefault()},L=()=>{h.value=e.value};return(i,r)=>(v(),$(F,null,[x("div",{draggable:!["start","end"].includes(o(e).type),class:R(["node-box",{"hover-node":o(m)===o(e)||o(h)===o(e),"no-branch-box":!["if","switch"].includes(o(e).type)}]),onMouseenter:_,onMouseleave:p,onDragstart:ee(b,["stop"]),onDragend:d,onClick:ee(L,["stop"])},[(v(),A(te(o(u)),{modelValue:o(e),"onUpdate:modelValue":r[1]||(r[1]=y=>ve(e)?e.value=y:null)},{showName:M(()=>[U(q(o(e).nodeInfo.nodeName||o(e).type),1)]),default:M(()=>[O(Ee,{onToSub:r[0]||(r[0]=y=>a("subNode"))})]),_:1},8,["modelValue"]))],42,on),o(e).type!=="end"?(v(),$(F,{key:0},[sn,O(Ne,{class:R({canDropFlag:o(n).dragFlag&&!o(n).banDropNodeList.includes(o(e))}),onToAdd:r[2]||(r[2]=y=>a("addNode",y)),onDragover:k,onDrop:w,onDragenter:f,onDragleave:g},null,8,["class"])],64)):T("",!0)],64))}};const rn=s=>(tt("data-v-435c42c5"),s=s(),nt(),s),cn=rn(()=>x("div",{class:"line"},null,-1)),un={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(s,{emit:a}){const t=s,e=de(),c=S({get:()=>t.modelValue,set:f=>a("update:modelValue",f)}),u=j("branchNameFlag"),l=j("dragConf"),n=j("hoverStack"),h=(f,g)=>{const k=g.generateNode();c.value.splice(f+1,0,k)},m=(f,g,k)=>{const L=g.findIndex(i=>i===f);if(g===c.value){if(L===k+1||L===k)return;L>k?(g.splice(L,1),g.splice(k+1,0,f)):(g.splice(k+1,0,f),g.splice(L,1))}else g.splice(L,1),c.value.splice(k+1,0,f)},_=f=>{c.value.splice(f,1)},p=ie(),b=()=>{l.value.customDragData&&(l.value.banDropNodeList.includes(c)||xe(l.value.customDragData.target)===p&&(m(l.value.customDragData.node,l.value.customDragData.curBranch,-1),n.value=[],l.value.customDragData=null))},d=()=>{l.value.customDragData&&(l.value.customDragData.target=p)},I=()=>{l.value.customDragData&&(l.value.customDragData.target=null)},w=f=>{l.value.dragFlag&&!l.value.banDropNodeList.includes(c.value)&&f.preventDefault()};return(f,g)=>(v(),$("div",Y({class:"render-list-wrapper"},o(e)),[s.startLine?(v(),$(F,{key:0},[s.branchCount>2?(v(),A(Ee,{key:0,onClick:g[0]||(g[0]=k=>a("removeBranch"))})):T("",!0),o(u)?(v(),$("div",{key:1,class:R(["branch-name",{placeholder:!s.branchName}])},q(s.branchName||"未命名"),3)):T("",!0),cn,O(Ne,{class:R({canDropFlag:o(l).dragFlag&&!o(l).banDropNodeList.includes(o(c))}),droppable:o(l).dragFlag&&!o(l).banDropNodeList.includes(o(c)),onToAdd:g[1]||(g[1]=k=>h(-1,k)),onDragover:w,onDrop:b,onDragenter:d,onDragleave:I},null,8,["class","droppable"])],64)):T("",!0),(v(!0),$(F,null,Q(o(c),(k,L)=>(v(),A(ln,{key:k.id,modelValue:o(c)[L],"onUpdate:modelValue":i=>o(c)[L]=i,"node-list":o(c),"onUpdate:nodeList":g[2]||(g[2]=i=>ve(c)?c.value=i:null),onAddNode:i=>h(L,i),onSubNode:()=>_(L),onMoveTo:(i,r)=>m(i,r,L)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},Oe=z(un,[["__scopeId","data-v-435c42c5"]]);const dn={class:"select-node-wrapper"},vn={__name:"AddNodeDialog",setup(s,{expose:a}){const t=B({x:1,y:1}),e=B(!1);let c,u;const l=()=>{e.value=!1,c=null,u=null},n=(_,p,b)=>{if(u===b)return l();u=b,c=p,t.value=_,e.value=!0},h=_=>{c==null||c(_),l()},m=B(Ie.filter(_=>!["start","end"].includes(_.type)));return a({show:n,close:l}),(_,p)=>pe((v(),$("div",{class:"add-node-dialog",style:Z({"--var-dialog-left":`${t.value.x+15}px`,"--var-dialog-top":`${t.value.y+15}px`,"--var-dialog-size":e.value?"300px":"0"})},[x("div",dn,[(v(!0),$(F,null,Q(m.value,b=>(v(),A(te(b.component),{key:b.type,"is-preview":!0,onClick:()=>h(b)},null,8,["onClick"]))),128))])],4)),[[o(ye),l]])}},pn=z(vn,[["__scopeId","data-v-281649fe"]]);const fn={__name:"Condition",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},attr:{type:Object,default:()=>({})}},emits:["change"],setup(s,{emit:a}){const t=s,e=B(t.modelValue.findIndex(n=>n.type)),c=t.attr.curActivateBranchIdx,u=(t.attr.curActivateBranchIdx+1)%2,l=n=>{t.modelValue[c].type=n===c,t.modelValue[u].type=n!==c,a("change",t.modelValue)};return(n,h)=>{const m=Te;return v(),$("div",null,[O(m,{modelValue:e.value,"onUpdate:modelValue":h[0]||(h[0]=_=>e.value=_),disabled:s.disabled,"active-value":o(c),"inactive-value":u,onChange:l},null,8,["modelValue","disabled","active-value"])])}}};const mn={class:"tab-pane-content"},hn={class:"module-name"},_n={__name:"NodeInfo",setup(s){const a=j("activateNode"),t=S(()=>Array.isArray(a.value)),e=B(null),c=B(null);se(()=>a.value,d=>{if(t.value){const{parentNode:I,branchIdx:w}=oe(a.value);c.value=w,e.value=I}else c.value=null,e.value=a.value},{deep:!0,immediate:!0});const u=S({get:()=>{var d;return((d=e.value)==null?void 0:d.nodeInfo)||{}},set:d=>{e.value.nodeInfo=d}}),l=d=>{if(!d)return{};const{type:I}=d,w=(f,g,k,L,i={})=>f&&f!==I?!1:{label:g,field:k,type:L,...i};return{base:[{moduleName:"基本信息",attrs:[w(null,"节点类型","type","input",{disabled:!0}),w(null,"节点名称","nodeName","input"),w("if","判断条件","condition","input",{required:!0}),w("switch","判断变量","condition","input",{required:!0})].filter(Boolean)},{moduleName:"分支信息",attrs:[w("if","分支名称",`branchInfoList.${c.value}.branchName`,"input",{disabled:!1}),w("if","设为true分支","branchInfoList","custom",{component:J(fn),nodeInfo:u,curActivateBranchIdx:c.value}),w("switch","分支名称",`branchInfoList.${c.value}.branchName`,"input"),w("switch","判断条件",`branchInfoList.${c.value}.condition`,"input",{required:!0})].filter(Boolean).filter(f=>t.value)},{moduleName:"输入参数",attrs:[].filter(Boolean)},{moduleName:"输出参数",attrs:[].filter(Boolean)}].filter(f=>{var g;return(g=f==null?void 0:f.attrs)==null?void 0:g.length}),other:[].filter(f=>{var g;return(g=f==null?void 0:f.attrs)==null?void 0:g.length})}},n=S(()=>{const{base:d,other:I}=l(e.value);return[{label:"基础属性",modules:d},{label:"其他属性",modules:I}]}),h=B("基础属性"),m=S({get(){return d=>{const I=(d==null?void 0:d.split("."))||[];return I.reduce((w,f)=>(w==null?void 0:w[f])||void 0,I.length?u.value:void 0)}}}),_=d=>typeof d=="object"&&d!==null,p=(d,I)=>{const w=(I==null?void 0:I.split("."))||[];if(w.length)if(w.length===1)u.value[w[0]]=d;else{const f=w.pop();try{let g="nodeInfo";const k=w.reduce((L,i)=>(g+=`.${i}`,_(L[i])||(console.warn(`${g}不是一个对象，已强制转化为对象`),L[i]={}),L[i]),w.length?u.value:void 0);k[f]=d}catch(g){console.error(`nodeInfo数据异常，无法读取${I}字段`),console.error(g)}}},b=d=>({disabled:d==null?void 0:d.disabled,modelValue:d.field&&m.value(d.field)||d.defaultValue,onInput:I=>p(I,d.field),onChange:I=>p(I,d.field)});return(d,I)=>{const w=dt,f=Te,g=ut,k=it,L=rt,i=ct,r=st,y=lt;return v(),A(y,{modelValue:h.value,"onUpdate:modelValue":I[0]||(I[0]=D=>h.value=D),stretch:!0},{default:M(()=>[(v(!0),$(F,null,Q(o(n),D=>(v(),A(r,{key:D.label,label:D.label,name:D.label},{default:M(()=>[O(i,{model:o(u),"label-width":"100px"},{default:M(()=>[U(q(o(u))+" ",1),x("div",mn,[(v(!0),$(F,null,Q(D.modules,(V,C)=>(v(),$("div",{key:C,class:"module-content"},[x("div",hn,q(V.moduleName),1),(v(!0),$(F,null,Q(V.attrs,(N,W)=>(v(),$("div",{key:W},[O(L,{label:N.label,rules:N.required&&[{required:!0,message:""}]},{default:M(()=>[N.type==="input"?(v(),A(w,Ce(Y({key:0},b(N))),null,16)):N.type==="switch"?(v(),A(f,Y({key:N},b(N),{"active-value":N.activeValue,"inactive-value":N.inactiveValue}),null,16,["active-value","inactive-value"])):N.type==="radio"?(v(),A(k,Ce(Y({key:2},b(N))),{default:M(()=>[(v(!0),$(F,null,Q(N.options,P=>(v(),A(g,{key:P.value,label:P.label,value:P.value},null,8,["label","value"]))),128))]),_:2},1040)):N.type==="custom"?(v(),A(te(N.component),Y({key:3},b(N),{attr:N}),null,16,["attr"])):T("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},gn=z(_n,[["__scopeId","data-v-c36cb234"]]);const bn={__name:"index",setup(s){const a="350px",t=j("activateNode"),e=B(null),c=B(!1);se(()=>t.value,l=>{l&&(e.value=l,c.value=!0)});const u=()=>{c.value=!1,e.value=null};return(l,n)=>pe((v(),$("div",{style:Z({"--var-width":a,"--var-right":c.value?0:`-${a}`,"--var-opacity":Number(c.value)}),class:"custom-drawer"},[e.value?(v(),A(gn,{key:0})):T("",!0)],4)),[[o(ye),u]])}},yn=z(bn,[["__scopeId","data-v-04587e00"]]);const Nn={__name:"index",setup(s,{expose:a}){const t="500px",e=B(!1),c=()=>{e.value=!0},u=()=>{e.value=!1};return a({show:c}),(l,n)=>pe((v(),$("div",{style:Z({"--var-width":t,"--var-right":e.value?0:`-${t}`,"--var-opacity":Number(e.value)}),class:"custom-drawer"},[H(l.$slots,"default",{},void 0,!0)],4)),[[o(ye),u]])}},wn=z(Nn,[["__scopeId","data-v-a3ce72d9"]]);function In(){let a=[0,0];const t=B([0,0]),e=B([0,0]),c=p=>{var b;![...p.target.classList].includes("canvas-main")&&!([...p.target.classList].includes("render-list-wrapper")&&((b=p.target.attributes.draggable)==null?void 0:b.value)!=="true")||(p.target.style.cursor="grab",console.log("e.target.style.cursor",p.target.style.cursor),a=[p.screenX,p.screenY],document.onmousemove=function(d){d.target.style.cursor="grabbing",console.log("onmousemove"),e.value=[(d.screenX-a[0])*1,(d.screenY-a[1])*1]})},u=p=>{var f;(f=p==null?void 0:p.target)!=null&&f.style&&(p.target.style.cursor="default");const[b,d]=t.value,[I,w]=e.value;t.value=[b+I,d+w],e.value=[0,0],document.onmousemove=document.onmouseup=null},l=B(100),n=S(()=>l.value/100);let h=null;const m=p=>{if(p===0)return;const b=l.value+p;return p>0&&b>=300||p<0&&b<=10?!1:(l.value+=p,!0)},_=p=>{var D;(D=p.preventDefault)==null||D.call(p);const[b,d]=t.value,I=p.wheelDelta?p.wheelDelta<0:p.detail>0;if(!p.ctrlKey){I?t.value=[b,d-30]:t.value=[b,d+30];return}const{width:w=0,height:f=0}=(h==null?void 0:h.getBoundingClientRect())||{},{pageX:g,pageY:k}=p,[L,i]=[w/2,f/2],[r,y]=[(g-L)/L*20,(k-i)/i*20];if(I){if(!m(-10))return;t.value=[b+r,d+y]}else{if(!m(10))return;t.value=[b-r,d-y]}};return Ae(()=>{h=document.querySelector("#canvas-main"),document.addEventListener("mouseleave",p=>{u(p)})}),{handleMouseDown:c,handleMouseUp:u,positionDist:t,calcDist:e,onMouseWheel:_,scale:n}}const ue=(s,a=0)=>{console.log("nodeList",s);const t="".padStart(a*2,"\0"),e=`\0\0${t}`,c={start:()=>`${t}
`,end:()=>`${t}
`,if:l=>{const{branchList:n}=l,{condition:h,branchInfoList:m}=l.nodeInfo,_=m.findIndex(b=>b.type),p=m.findIndex(b=>!b.type);return`${t}if(${h}){
${ue(n[_],a+1)}${t}}else{
${ue(n[p],a+1)}${t}}
`},switch:l=>{const{branchList:n}=l,{condition:h,branchInfoList:m}=l.nodeInfo;return`${t}switch(${h}){
${m.map((_,p)=>`${e}case ${_.condition}:
${ue(n[p],a+1)||`
`}${e}break;
`).join(`
`)}${t}}
`},feat:()=>`${t}feat
`};return s.reduce((l,n)=>{var h;return l+(((h=c[n.type])==null?void 0:h.call(c,n))||"")},"")};const Dn={class:"left-top-wrapper"},$n={class:"canvas-node-container"},Vn={__name:"Main",setup(s){const a=B([new E("start"),new E("feat"),new E("if",{branchList:[[new E("feat")]]}),new E("switch",{branchList:[[new E("feat")],[new E("feat")],[new E("feat")]]}),new E("end")]);window.__nodeList=a;const t=B(null);ae("addNodeDialogRef",t);const e=B([]);ae("hoverStack",e);const c=B({banDropNodeList:[],dragFlag:!1,customDragData:null});ae("dragConf",c);const u=B(null);ae("activateNode",u),window.__activateNode=u,at(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const l=B(null),n=()=>{var K;const V=u.value;if(!V||["start","end"].includes(V.type))return;const{parentNode:C,branchIdx:N,nodeList:W,nodeIdx:P}=oe(V);let le=null;if(Array.isArray(V)){if(((K=C.branchList)==null?void 0:K.length)<=ne)throw new Error(`分支数量至少为${ne},剪切失败！`);(C.branchList||[]).splice(N,1),le=C.nodeInfo.branchInfoList.splice(N,1)[0]}else W.splice(P,1);l.value={type:"shear",data:V,branchInfo:le}},h=()=>{const V=u.value;if(!V||["start","end"].includes(V.type))return;const{branchIdx:C,parentNode:N}=oe();l.value={type:"copy",data:V,branchInfo:C===null?null:JSON.parse(JSON.stringify(N.nodeInfo.branchInfoList[C]||{}))}},m=V=>{if(!l.value)return;const{type:C,data:N,branchInfo:W}=l.value;if(!N||["end"].includes(u.value.type))return;const P={copyNode:()=>{if(!u.value||Array.isArray(u.value))return;const{nodeList:K,nodeIdx:G}=oe();K.splice(G+1,0,N.copySelf())},shearNode:()=>{if(!u.value||Array.isArray(u.value))return;const{nodeList:K,nodeIdx:G}=oe();K.splice(G+1,0,N),l.value=null},copyBranch:()=>{var G;if(((G=u.value)==null?void 0:G.type)!=="switch")return;const K=u.value.branchList.push(N.map(Fe=>Fe.copySelf()));u.value.nodeInfo.branchInfoList[K-1]=W},shearBranch:()=>{var G;if(((G=u.value)==null?void 0:G.type)!=="switch")return;const K=u.value.branchList.push(N);u.value.nodeInfo.branchInfoList[K-1]=W,l.value=null}},le=C+(Array.isArray(N)?"Branch":"Node");P[le]()},_=B(!0),p=()=>{_.value=!_.value},b=B(!0),d=()=>{b.value=!b.value};ae("branchNameFlag",b);const I=B(""),w=()=>{},f=B(null),g=()=>{const V=ue(a.value);console.log("generateCode",V),I.value=V,f.value.show()},{handleMouseDown:k,handleMouseUp:L,positionDist:i,calcDist:r,onMouseWheel:y,scale:D}=In();return(V,C)=>{const N=Qe,W=ot("mousetrap");return v(),$(F,null,[x("div",{id:"canvas-main",class:"canvas-main",style:Z({"--var-position-x":`${o(i)[0]+o(r)[0]}px`,"--var-position-y":`${o(i)[1]+o(r)[1]}px`,"--var-position-scale":o(D)}),onClickCapture:C[1]||(C[1]=P=>u.value=null),onMousedown:C[2]||(C[2]=(...P)=>o(k)&&o(k)(...P)),onMouseup:C[3]||(C[3]=(...P)=>o(L)&&o(L)(...P)),onMousewheel:C[4]||(C[4]=(...P)=>o(y)&&o(y)(...P))},[x("div",Dn,[O(N,{onClick:p},{default:M(()=>[U(" 快捷建："+q(_.value?"开启":"关闭"),1)]),_:1}),O(N,{onClick:d},{default:M(()=>[U(" 显示分支名："+q(b.value?"开启":"关闭"),1)]),_:1}),O(N,{onClick:w},{default:M(()=>[U(" 执行 ")]),_:1}),O(N,{onClick:g},{default:M(()=>[U(" 生成代码 ")]),_:1})]),x("div",$n,[O(Oe,{modelValue:a.value,"onUpdate:modelValue":C[0]||(C[0]=P=>a.value=P),"start-line":!1},null,8,["modelValue"])])],36),O(pn,{ref_key:"addNodeDialogRef",ref:t},null,512),O(o(yn)),O(o(wn),{ref_key:"codePanelRef",ref:f},{default:M(()=>[x("pre",null,q(I.value),1)]),_:1},512),_.value?pe((v(),$("div",{key:0,"onMod+c":C[5]||(C[5]=()=>h()),"onMod+x":C[6]||(C[6]=()=>n()),"onMod+v":m},null,544)),[[W,["mod+c","mod+v","mod+x"]]]):T("",!0)],64)}}},Cn=z(Vn,[["__scopeId","data-v-d3a7e75f"]]),Xn={__name:"index",setup(s){return(a,t)=>(v(),A(Cn))}};export{Xn as default};
