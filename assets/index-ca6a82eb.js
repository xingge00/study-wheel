var Me=Object.defineProperty;var Pe=(l,o,t)=>o in l?Me(l,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[o]=t;var be=(l,o,t)=>(Pe(l,typeof o!="symbol"?o+"":o,t),t);import{a as Re,d as Oe,l as se,i as ue,c as Fe,_ as Ue,w as je}from"./base-2b38656a.js";import{i as ye,a as ze,b as Ge,d as He,c as Ke,E as We}from"./el-button-a5d9148a.js";import{l as ie,A as Ce,v as L,r as B,d as ae,k as $e,o as d,c as y,L as A,i as s,E,R as qe,C as S,w as R,D as Y,G as T,V as H,b as O,H as Z,S as X,j as le,n as Je,ar as Ne,_ as z,$ as re,t as F,M as W,F as M,B as G,a as j,U as J,a0 as ce,as as q,a4 as Le,am as Xe,an as Ye,Q as me,at as we,a2 as Qe,a8 as Ze,I as te}from"./index-606384bb.js";import{C as ke}from"./index-845c08b0.js";import{E as et,a as tt}from"./el-tab-pane-da3f2c8e.js";import{E as nt,a as at}from"./el-form-item-e5907ac9.js";import{E as ot,a as st}from"./el-radio-button-be36fa87.js";import{E as lt}from"./el-input-96546363.js";import{u as rt,f as ct,E as oe,l as ut}from"./index-cb4d6e4d.js";import{i as it}from"./validator-c0f62c62.js";import{U as de,C as ve,I as pe,d as dt,t as vt}from"./event-e06a23af.js";import"./index-9b266e88.js";import"./get-e7313515.js";import"./index-c13ad24b.js";import"./typescript-defaf979.js";import"./strings-bde8f1e5.js";import"./aria-60e0cdc6.js";import"./vnode-4d15ed5d.js";import"./objects-5832cd91.js";import"./isNil-c75b1b34.js";const pt=Re({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:ye},inactiveIcon:{type:ye},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:Oe(Function)},size:{type:String,validator:it},tabindex:{type:[String,Number]}}),ft={[de]:l=>se(l)||ie(l)||ue(l),[ve]:l=>se(l)||ie(l)||ue(l),[pe]:l=>se(l)||ie(l)||ue(l)},mt=["onClick"],ht=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],_t=["aria-hidden"],gt=["aria-hidden"],bt=["aria-hidden"],fe="ElSwitch",yt=Ce({name:fe}),Nt=Ce({...yt,props:pt,emits:ft,setup(l,{expose:o,emit:t}){const e=l,u=le(),{formItem:i}=ze(),c=Ge(),a=Fe("switch");rt({from:'"value"',replacement:'"model-value" or "v-model"',scope:fe,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},L(()=>{var n;return!!((n=u.vnode.props)!=null&&n.value)}));const{inputId:h}=He(e,{formItemContext:i}),m=Ke(L(()=>e.loading)),g=B(e.modelValue!==!1),k=B(),$=B(),f=L(()=>[a.b(),a.m(c.value),a.is("disabled",m.value),a.is("checked",v.value)]),D=L(()=>({width:ct(e.width)}));ae(()=>e.modelValue,()=>{g.value=!0}),ae(()=>e.value,()=>{g.value=!1});const w=L(()=>g.value?e.modelValue:e.value),v=L(()=>w.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(w.value)||(t(de,e.inactiveValue),t(ve,e.inactiveValue),t(pe,e.inactiveValue)),ae(v,n=>{var p;k.value.checked=n,e.validateEvent&&((p=i==null?void 0:i.validate)==null||p.call(i,"change").catch(b=>dt()))});const _=()=>{const n=v.value?e.inactiveValue:e.activeValue;t(de,n),t(ve,n),t(pe,n),Je(()=>{k.value.checked=v.value})},V=()=>{if(m.value)return;const{beforeChange:n}=e;if(!n){_();return}const p=n();[Ne(p),se(p)].includes(!0)||vt(fe,"beforeChange must return type `Promise<boolean>` or `boolean`"),Ne(p)?p.then(I=>{I&&_()}).catch(I=>{}):p&&_()},C=L(()=>a.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),r=()=>{var n,p;(p=(n=k.value)==null?void 0:n.focus)==null||p.call(n)};return $e(()=>{k.value.checked=v.value}),o({focus:r,checked:v}),(n,p)=>(d(),y("div",{class:E(s(f)),style:Z(s(C)),onClick:X(V,["prevent"])},[A("input",{id:s(h),ref_key:"input",ref:k,class:E(s(a).e("input")),type:"checkbox",role:"switch","aria-checked":s(v),"aria-disabled":s(m),name:n.name,"true-value":n.activeValue,"false-value":n.inactiveValue,disabled:s(m),tabindex:n.tabindex,onChange:_,onKeydown:qe(V,["enter"])},null,42,ht),!n.inlinePrompt&&(n.inactiveIcon||n.inactiveText)?(d(),y("span",{key:0,class:E([s(a).e("label"),s(a).em("label","left"),s(a).is("active",!s(v))])},[n.inactiveIcon?(d(),S(s(oe),{key:0},{default:R(()=>[(d(),S(Y(n.inactiveIcon)))]),_:1})):T("v-if",!0),!n.inactiveIcon&&n.inactiveText?(d(),y("span",{key:1,"aria-hidden":s(v)},H(n.inactiveText),9,_t)):T("v-if",!0)],2)):T("v-if",!0),A("span",{ref_key:"core",ref:$,class:E(s(a).e("core")),style:Z(s(D))},[n.inlinePrompt?(d(),y("div",{key:0,class:E(s(a).e("inner"))},[n.activeIcon||n.inactiveIcon?(d(),S(s(oe),{key:0,class:E(s(a).is("icon"))},{default:R(()=>[(d(),S(Y(s(v)?n.activeIcon:n.inactiveIcon)))]),_:1},8,["class"])):n.activeText||n.inactiveText?(d(),y("span",{key:1,class:E(s(a).is("text")),"aria-hidden":!s(v)},H(s(v)?n.activeText:n.inactiveText),11,gt)):T("v-if",!0)],2)):T("v-if",!0),A("div",{class:E(s(a).e("action"))},[n.loading?(d(),S(s(oe),{key:0,class:E(s(a).is("loading"))},{default:R(()=>[O(s(ut))]),_:1},8,["class"])):T("v-if",!0)],2)],6),!n.inlinePrompt&&(n.activeIcon||n.activeText)?(d(),y("span",{key:1,class:E([s(a).e("label"),s(a).em("label","right"),s(a).is("active",s(v))])},[n.activeIcon?(d(),S(s(oe),{key:0},{default:R(()=>[(d(),S(Y(n.activeIcon)))]),_:1})):T("v-if",!0),!n.activeIcon&&n.activeText?(d(),y("span",{key:1,"aria-hidden":!s(v)},H(n.activeText),9,bt)):T("v-if",!0)],2)):T("v-if",!0)],14,mt))}});var wt=Ue(Nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Be=je(wt);const It=["onClick"],Dt={key:0,class:"line"},Vt={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(l,{emit:o}){const t=l,e=re(),u=F("addNodeDialogRef"),i=m=>{if(m.id==="canvas-main"||!m)return{x:0,y:0};const g=i(m.offsetParent);return{x:g.x+m.offsetLeft,y:g.y+m.offsetTop}},c=m=>{o("toAdd",m)},a=le(),h=m=>{if(t.addType==="branch")return o("toAdd");const{target:g,offsetY:k}=m,{x:$,y:f}=i(g);u.value.show({x:g.clientWidth+$,y:k+f},c,a)};return(m,g)=>(d(),y(M,null,[A("div",W({class:"add-node"},s(e),{onClick:X(h,["stop"])})," + ",16,It),l.endLine?(d(),y("div",Dt)):T("",!0)],64))}},he=z(Vt,[["__scopeId","data-v-77b265a2"]]);const Ct=["onClick"],$t={__name:"SubBtn",emits:["toSub"],setup(l,{emit:o}){const t=F("hoverStack"),e=u=>{t.value=[],o("toSub")};return(u,i)=>(d(),y("div",{class:"sub-node",onClick:X(e,["stop"])}," - ",8,Ct))}},Se=z($t,[["__scopeId","data-v-554bf87e"]]),Lt={},kt={class:"node-wrapper"},Bt={class:"c-circle c-start"};function St(l,o){return d(),y("div",kt,[A("div",Bt,[G(l.$slots,"showName",{},()=>[j(" start ")])])])}const At=z(Lt,[["render",St]]),xt={},Tt={class:"node-wrapper"},Et={class:"c-circle c-end"};function Mt(l,o){return d(),y("div",Tt,[A("div",Et,[G(l.$slots,"showName",{},()=>[j(" end ")])])])}const Pt=z(xt,[["render",Mt]]),Rt={},Ot={class:"node-wrapper"},Ft={class:"c-circle c-other"};function Ut(l,o){return d(),y("div",Ot,[G(l.$slots,"default"),A("div",Ft,[G(l.$slots,"showName",{},()=>[j(" error ")])])])}const Ae=z(Rt,[["render",Ut]]),_e=l=>{var o;return l?(o=l==null?void 0:l.branchList)!=null&&o.length?l.branchList.reduce((t,e)=>t+Math.max(...e.map(u=>_e(u)),1),0):1:0},Ie=l=>Array.isArray(l)?Math.max(...l.map(o=>_e(o)),1):1,jt=A("div",{class:"line"},null,-1),xe={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(l,{emit:o}){const t=l,e=L({get:()=>t.modelValue||[],set:r=>o("update:modelValue",r)}),u=L(()=>{var r,n,p,b,I,P;return((r=t.curNode)==null?void 0:r.type)==="switch"?(((p=(n=t.curNode)==null?void 0:n.nodeInfo)==null?void 0:p.branchInfoList)||[]).map(N=>N==null?void 0:N.branchName):((b=t.curNode)==null?void 0:b.type)==="if"?(((P=(I=t.curNode)==null?void 0:I.nodeInfo)==null?void 0:P.branchInfoList)||[]).map(N=>N.branchName):[]}),i=L(()=>_e(t.curNode)),c=L(()=>{var r;return Ie((r=e.value)==null?void 0:r[0])}),a=L(()=>{var r;return Ie((r=e.value)==null?void 0:r[e.value.length-1])}),h=F("activateNode"),m=F("hoverStack"),g=L(()=>m.value[0]),k=r=>m.value.unshift(e.value[r]),$=r=>m.value.shift(),f=B(null),D=r=>{f.value=r,e.value[r]},w=()=>{f.value=null},v=r=>{f.value!==null&&r.preventDefault()},_=(r,n,p)=>{let b=Math.min(n,p),I=Math.max(n,p);const P=r[n];for(;b<I;)n<p?r[b]=r[++b]:r[I]=r[--I],b===I&&(r[b]=P)},V=r=>{var n,p;f.value===r||f.value===null||(_(e.value||[],f.value,r),_(((p=(n=t.curNode)==null?void 0:n.nodeInfo)==null?void 0:p.branchInfoList)||[],f.value,r),f.value=null)},C=r=>{h.value=e.value[r]};return(r,n)=>(d(),y(M,null,[jt,["switch"].includes(l.curNode.type)?(d(),S(he,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:n[0]||(n[0]=p=>o("addBranch"))})):T("",!0),A("div",{class:"branch-wrapper branch-wrapper-width",style:Z({"--var-col-count":s(i),"--var-first-branch-col-count":s(c),"--var-last-branch-col-count":s(a)})},[(d(!0),y(M,null,J(s(e),(p,b)=>(d(),S(Ee,{key:b,modelValue:s(e)[b],"onUpdate:modelValue":I=>s(e)[b]=I,class:E({"hover-branch":s(g)===s(e)[b]||s(h)===s(e)[b],"can-drop-branch":f.value!==null&&f.value!==b}),"branch-count":s(e).length,"branch-name":s(u)[b],draggable:!0,onMouseenter:()=>k(b),onMouseleave:()=>$(),onRemoveBranch:()=>o("removeBranch",b),onDragstart:X(()=>D(b),["stop"]),onDragover:n[1]||(n[1]=I=>v(I)),onDropCapture:()=>V(b),onDragend:w,onClick:X(()=>C(b),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},zt={class:"c-circle c-if"},Gt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:o}){const t=l,e=L({get:()=>t.modelValue.branchList,set:c=>o("update:modelValue",{...t.modelValue,branchList:c})}),u=re(),i=c=>{var a;return c?(a=c==null?void 0:c.branchList)!=null&&a.length?c.branchList.reduce((h,m)=>h+Math.max(...m.map(g=>i(g)),1),0):1:0};return L(()=>i(t.modelValue)),(c,a)=>(d(),y(M,null,[A("div",W({class:"node-wrapper"},s(u)),[G(c.$slots,"default"),A("div",zt,[G(c.$slots,"showName",{},()=>[j(" if ")])])],16),l.isPreview?T("",!0):(d(),S(xe,{key:0,modelValue:s(e),"onUpdate:modelValue":a[0]||(a[0]=h=>ce(e)?e.value=h:null),"cur-node":l.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Ht={class:"c-circle c-switch"},Kt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:o}){const t=l,e=L({get:()=>t.modelValue.branchList||[],set:a=>o("update:modelValue",{...t.modelValue,branchList:a})}),u=re(),i=()=>{const a=e.value.push([]);t.modelValue.nodeInfo.branchInfoList[a]={}},c=a=>{e.value.splice(a,1),t.modelValue.nodeInfo.branchInfoList.splice(a,1)};return(a,h)=>(d(),y(M,null,[A("div",W({class:"node-wrapper"},s(u)),[G(a.$slots,"default",{},void 0,!0),A("div",Ht,[G(a.$slots,"showName",{},()=>[j(" switch ")],!0)])],16),l.isPreview?T("",!0):(d(),S(xe,{key:0,modelValue:s(e),"onUpdate:modelValue":h[0]||(h[0]=m=>ce(e)?e.value=m:null),"cur-node":l.modelValue,onAddBranch:i,onRemoveBranch:c},null,8,["modelValue","cur-node"]))],64))}},Wt=z(Kt,[["__scopeId","data-v-c8b2d440"]]),qt={class:"node-wrapper"},Jt={class:"c-circle c-feat"},Xt={__name:"Feat",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(l){return(o,t)=>(d(),y("div",qt,[G(o.$slots,"default"),A("div",Jt,[G(o.$slots,"showName",{},()=>[j(" Feat ")])])]))}},ge=[{type:"start",component:q(At),generateNode:()=>new x("start")},{type:"end",component:q(Pt),generateNode:()=>new x("end")},{type:"if",component:q(Gt),generateNode:()=>new x("if")},{type:"switch",component:q(Wt),generateNode:(l=[[],[]])=>new x("switch",{branchList:l})},{type:"feat",component:q(Xt),generateNode:()=>new x("feat")}],Q=2,De=(l,o=Q)=>{const t=l==null?void 0:l.filter(Array.isArray);return t!=null&&t.length?o?t.length>=o?t.slice(0,o):t.slice().concat(new Array(o-t.length).fill(0).map(e=>[])):t.slice():new Array(o).fill(0).map(e=>[])},Ve=()=>({code:""}),Yt=({type:l,branchList:o})=>{const e={if:{condition:"",branchInfoList:[{branchName:"分支1",type:!0},{branchName:"分支2",type:!1}]},switch:{branchInfoList:(o||[]).map((u,i)=>({branchName:`分支${i}`,condition:""}))}}[l]||{};return e.type=l,e.nodeName=l,e},K=class{constructor(o,t){const{branchList:e=[],nodeInfo:u={}}=t||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++K.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:ge.some(a=>a.type===o)?o:"error"}),o==="if"){const a=De(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(a,{get(h,m,g){return Reflect.get(h,m,g)},set(h,m,g,k){return["0","1"].includes(m)?Reflect.set(h,m,g,k):(console.error(`分支数量必须为${Q}`),!1)}})}})}if(o==="switch"){let a=De(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>a,set(h){if(h.length<Q)throw new Ae(`分支数量至少为${Q}`);a=h}})}const i=Yt(this);Object.assign(i,u);const c=new Proxy(i,{get(a,h,m){return Reflect.get(a,h,m)},set(a,h,m,g){return console.log("修改了",a,"的",h,"为",m),Reflect.set(a,h,m,g)}});this.nodeInfo=c}static copyBranchList(o){return(o==null?void 0:o.map(t=>(t==null?void 0:t.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new K(this.type,{branchList:K.copyBranchList(this.branchList),nodeInfo:JSON.parse(JSON.stringify(this.nodeInfo))})}static executeNode(o,t=[],e){e||(e=Ve());const{type:u,branchList:i}=o;let c;u==="if"&&(c=K.executeList(i[0],t)),u==="switch"&&(c=K.executeList(i[0],t));const a={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${c.context.code}
        }
      `,switch:()=>`switch(){
        ${c.context.code}
      }
      `};return e.code+=a[u](),{result:t,context:e}}static executeList(o,t=[]){const e=Ve();return{result:o.reduce((i,c)=>K.executeNode(c,i,e).result,t),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((o,t)=>{let e=`${o},${t}:`;return Array.isArray(this[t])?e+=`[${this[t].toString()}]`:typeof this[t]=="number"?e+=`${this[t].toString()}`:typeof this[t]=="string"?e+=`"${this[t].toString()}"`:e+=`{${this[t].toString()}}`,e},"").slice(1)}}`}};let x=K;be(x,"id",0);const Qt={type:"error",component:q(Ae),generateNode:()=>new x("error")},Te=(l,o,t=null)=>{for(let e in l){e=e-0;const u=l[e];if(u===o)return{nodeList:l,parentNode:t,nodeIdx:e,branchIdx:null};for(let i in u.branchList||[]){i=i-0;const c=u.branchList[i];if(c===o)return{nodeList:c,parentNode:u,branchIdx:i,nodeIdx:null};const a=Te(c,o,u);if(a)return a}}return null},ne=l=>{var e,u;const o=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],t=((u=window==null?void 0:window.__activateNode)==null?void 0:u.value)||null;return Te(o||[],l||t)},Zt=["draggable","onDragstart","onClick"],en=A("div",{class:"line"},null,-1),tn={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(l,{emit:o}){const t=l,e=L({get:()=>t.modelValue,set:r=>o("update:modelValue",r)}),u=L({get:()=>t.nodeList,set:r=>o("update:nodeList",r)}),i=L(()=>(ge.find(r=>r.type===e.value.type)||Qt).component),c=F("hoverStack"),a=F("dragConf"),h=F("activateNode"),m=L(()=>c.value[0]),g=()=>c.value.unshift(e.value),k=()=>c.value.shift(),$=()=>{console.log("dragstart"),a.value.customDragData={node:e.value,curBranch:u.value,target:null};const r=[],n=(p,b)=>{var I;!b&&r.push(p),(I=p==null?void 0:p.branchList)!=null&&I.length&&p.branchList.forEach(P=>{r.push(P),P.forEach(N=>n(N))})};n(e.value,!0),a.value.dragFlag=!0,a.value.banDropNodeList=r},f=()=>{a.value.dragFlag=!1,a.value.banDropNodeList=[]},D=le(),w=()=>{a.value.customDragData&&(a.value.banDropNodeList.includes(e)||Le(a.value.customDragData.target)===D&&(o("moveTo",a.value.customDragData.node,a.value.customDragData.curBranch),a.value.customDragData=null,c.value=[]))},v=()=>{a.value.customDragData&&(a.value.customDragData.target=D)},_=()=>{a.value.customDragData&&(a.value.customDragData.target=null)},V=r=>{a.value.dragFlag&&!a.value.banDropNodeList.includes(e.value)&&r.preventDefault()},C=()=>{h.value=e.value};return(r,n)=>(d(),y(M,null,[A("div",{draggable:!["start","end"].includes(s(e).type),class:E(["node-box",{"hover-node":s(m)===s(e)||s(h)===s(e),"no-branch-box":!["if","switch"].includes(s(e).type)}]),onMouseenter:g,onMouseleave:k,onDragstart:X($,["stop"]),onDragend:f,onClick:X(C,["stop"])},[(d(),S(Y(s(i)),{modelValue:s(e),"onUpdate:modelValue":n[1]||(n[1]=p=>ce(e)?e.value=p:null)},{showName:R(()=>[j(H(s(e).nodeInfo.nodeName||s(e).type),1)]),default:R(()=>[O(Se,{onToSub:n[0]||(n[0]=p=>o("subNode"))})]),_:1},8,["modelValue"]))],42,Zt),s(e).type!=="end"?(d(),y(M,{key:0},[en,O(he,{class:E({canDropFlag:s(a).dragFlag&&!s(a).banDropNodeList.includes(s(e))}),onToAdd:n[2]||(n[2]=p=>o("addNode",p)),onDragover:V,onDrop:w,onDragenter:v,onDragleave:_},null,8,["class"])],64)):T("",!0)],64))}};const nn=l=>(Xe("data-v-435c42c5"),l=l(),Ye(),l),an=nn(()=>A("div",{class:"line"},null,-1)),on={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(l,{emit:o}){const t=l,e=re(),u=L({get:()=>t.modelValue,set:v=>o("update:modelValue",v)}),i=F("branchNameFlag"),c=F("dragConf"),a=F("hoverStack"),h=(v,_)=>{const V=_.generateNode();u.value.splice(v+1,0,V)},m=(v,_,V)=>{const C=_.findIndex(r=>r===v);if(_===u.value){if(C===V+1||C===V)return;C>V?(_.splice(C,1),_.splice(V+1,0,v)):(_.splice(V+1,0,v),_.splice(C,1))}else _.splice(C,1),u.value.splice(V+1,0,v)},g=v=>{u.value.splice(v,1)},k=le(),$=()=>{c.value.customDragData&&(c.value.banDropNodeList.includes(u)||Le(c.value.customDragData.target)===k&&(m(c.value.customDragData.node,c.value.customDragData.curBranch,-1),a.value=[],c.value.customDragData=null))},f=()=>{c.value.customDragData&&(c.value.customDragData.target=k)},D=()=>{c.value.customDragData&&(c.value.customDragData.target=null)},w=v=>{c.value.dragFlag&&!c.value.banDropNodeList.includes(u.value)&&v.preventDefault()};return(v,_)=>(d(),y("div",W({class:"render-list-wrapper"},s(e)),[l.startLine?(d(),y(M,{key:0},[l.branchCount>2?(d(),S(Se,{key:0,onClick:_[0]||(_[0]=V=>o("removeBranch"))})):T("",!0),s(i)?(d(),y("div",{key:1,class:E(["branch-name",{placeholder:!l.branchName}])},H(l.branchName||"未命名"),3)):T("",!0),an,O(he,{class:E({canDropFlag:s(c).dragFlag&&!s(c).banDropNodeList.includes(s(u))}),droppable:s(c).dragFlag&&!s(c).banDropNodeList.includes(s(u)),onToAdd:_[1]||(_[1]=V=>h(-1,V)),onDragover:w,onDrop:$,onDragenter:f,onDragleave:D},null,8,["class","droppable"])],64)):T("",!0),(d(!0),y(M,null,J(s(u),(V,C)=>(d(),S(tn,{key:V.id,modelValue:s(u)[C],"onUpdate:modelValue":r=>s(u)[C]=r,"node-list":s(u),"onUpdate:nodeList":_[2]||(_[2]=r=>ce(u)?u.value=r:null),onAddNode:r=>h(C,r),onSubNode:()=>g(C),onMoveTo:(r,n)=>m(r,n,C)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},Ee=z(on,[["__scopeId","data-v-435c42c5"]]);const sn={class:"select-node-wrapper"},ln={__name:"AddNodeDialog",setup(l,{expose:o}){const t=B({x:1,y:1}),e=B(!1);let u,i;const c=()=>{e.value=!1,u=null,i=null},a=(g,k,$)=>{if(i===$)return c();i=$,u=k,t.value=g,e.value=!0},h=g=>{u==null||u(g),c()},m=B(ge.filter(g=>!["start","end"].includes(g.type)));return o({show:a,close:c}),(g,k)=>me((d(),y("div",{class:"add-node-dialog",style:Z({"--var-dialog-left":`${t.value.x+15}px`,"--var-dialog-top":`${t.value.y+15}px`,"--var-dialog-size":e.value?"300px":"0"})},[A("div",sn,[(d(!0),y(M,null,J(m.value,$=>(d(),S(Y($.component),{key:$.type,"is-preview":!0,onClick:()=>h($)},null,8,["onClick"]))),128))])],4)),[[s(ke),c]])}},rn=z(ln,[["__scopeId","data-v-281649fe"]]);const cn={__name:"Condition",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},attr:{type:Object,default:()=>({})}},emits:["change"],setup(l,{emit:o}){const t=l,e=B(t.modelValue.findIndex(a=>a.type)),u=t.attr.curActivateBranchIdx,i=(t.attr.curActivateBranchIdx+1)%2,c=a=>{t.modelValue[u].type=a===u,t.modelValue[i].type=a!==u,o("change",t.modelValue)};return(a,h)=>{const m=Be;return d(),y("div",null,[O(m,{modelValue:e.value,"onUpdate:modelValue":h[0]||(h[0]=g=>e.value=g),disabled:l.disabled,"active-value":s(u),"inactive-value":i,onChange:c},null,8,["modelValue","disabled","active-value"])])}}};const un={class:"tab-pane-content"},dn={class:"module-name"},vn={__name:"NodeInfo",setup(l){const o=F("activateNode"),t=L(()=>Array.isArray(o.value)),e=B(null),u=B(null);ae(()=>o.value,f=>{if(t.value){const{parentNode:D,branchIdx:w}=ne(o.value);u.value=w,e.value=D}else u.value=null,e.value=o.value},{deep:!0,immediate:!0});const i=L({get:()=>{var f;return((f=e.value)==null?void 0:f.nodeInfo)||{}},set:f=>{e.value.nodeInfo=f}}),c=f=>{if(!f)return{};const{type:D}=f,w=(v,_,V,C,r={})=>v&&v!==D?!1:{label:_,field:V,type:C,...r};return{base:[{moduleName:"基本信息",attrs:[w(null,"节点类型","type","input",{disabled:!0}),w(null,"节点名称","nodeName","input"),w("if","判断条件","condition","input",{required:!0})].filter(Boolean)},{moduleName:"分支信息",attrs:[w("if","分支名称",`branchInfoList.${u.value}.branchName`,"input",{disabled:!1}),w("if","设为true分支","branchInfoList","custom",{component:q(cn),nodeInfo:i,curActivateBranchIdx:u.value}),w("switch","分支名称",`branchInfoList.${u.value}.branchName`,"input"),w("switch","判断条件",`branchInfoList.${u.value}.condition`,"input",{required:!0})].filter(Boolean).filter(v=>t.value)},{moduleName:"输入参数",attrs:[].filter(Boolean)},{moduleName:"输出参数",attrs:[].filter(Boolean)}].filter(v=>{var _;return(_=v==null?void 0:v.attrs)==null?void 0:_.length}),other:[].filter(v=>{var _;return(_=v==null?void 0:v.attrs)==null?void 0:_.length})}},a=L(()=>{const{base:f,other:D}=c(e.value);return[{label:"基础属性",modules:f},{label:"其他属性",modules:D}]}),h=B("基础属性"),m=L({get(){return f=>{const D=(f==null?void 0:f.split("."))||[];return D.reduce((w,v)=>(w==null?void 0:w[v])||void 0,D.length?i.value:void 0)}}}),g=f=>typeof f=="object"&&f!==null,k=(f,D)=>{const w=(D==null?void 0:D.split("."))||[];if(w.length)if(w.length===1)i.value[w[0]]=f;else{const v=w.pop();try{let _="nodeInfo";const V=w.reduce((C,r)=>(_+=`.${r}`,g(C[r])||(console.warn(`${_}不是一个对象，已强制转化为对象`),C[r]={}),C[r]),w.length?i.value:void 0);V[v]=f}catch(_){console.error(`nodeInfo数据异常，无法读取${D}字段`),console.error(_)}}},$=f=>({disabled:f==null?void 0:f.disabled,modelValue:f.field&&m.value(f.field)||f.defaultValue,onInput:D=>k(D,f.field),onChange:D=>k(D,f.field)});return(f,D)=>{const w=lt,v=Be,_=ot,V=st,C=nt,r=at,n=et,p=tt;return d(),S(p,{modelValue:h.value,"onUpdate:modelValue":D[0]||(D[0]=b=>h.value=b),stretch:!0},{default:R(()=>[(d(!0),y(M,null,J(s(a),b=>(d(),S(n,{key:b.label,label:b.label,name:b.label},{default:R(()=>[O(r,{model:s(i),"label-width":"100px"},{default:R(()=>[j(H(s(i))+" ",1),A("div",un,[(d(!0),y(M,null,J(b.modules,(I,P)=>(d(),y("div",{key:P,class:"module-content"},[A("div",dn,H(I.moduleName),1),(d(!0),y(M,null,J(I.attrs,(N,U)=>(d(),y("div",{key:U},[O(C,{label:N.label,rules:N.required&&[{required:!0,message:""}]},{default:R(()=>[N.type==="input"?(d(),S(w,we(W({key:0},$(N))),null,16)):N.type==="switch"?(d(),S(v,W({key:N},$(N),{"active-value":N.activeValue,"inactive-value":N.inactiveValue}),null,16,["active-value","inactive-value"])):N.type==="radio"?(d(),S(V,we(W({key:2},$(N))),{default:R(()=>[(d(!0),y(M,null,J(N.options,ee=>(d(),S(_,{key:ee.value,label:ee.label,value:ee.value},null,8,["label","value"]))),128))]),_:2},1040)):N.type==="custom"?(d(),S(Y(N.component),W({key:3},$(N),{attr:N}),null,16,["attr"])):T("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},pn=z(vn,[["__scopeId","data-v-270d0857"]]);const fn={__name:"index",setup(l){const o="350px",t=F("activateNode"),e=B(null),u=B(!1);ae(()=>t.value,c=>{c&&(e.value=c,u.value=!0)});const i=()=>{u.value=!1,e.value=null};return(c,a)=>me((d(),y("div",{style:Z({"--var-width":o,"--var-right":u.value?0:`-${o}`,"--var-opacity":Number(u.value)}),class:"custom-drawer"},[e.value?(d(),S(pn,{key:0})):T("",!0)],4)),[[s(ke),i]])}},mn=z(fn,[["__scopeId","data-v-04587e00"]]);function hn(){let o=[0,0];const t=B([0,0]),e=B([0,0]),u=c=>{var h;if(![...c.target.classList].includes("canvas-main")&&!([...c.target.classList].includes("render-list-wrapper")&&((h=c.target.attributes.draggable)==null?void 0:h.value)!=="true"))return;o=[c.screenX,c.screenY];let a=null;document.onmousemove=function(m){console.log("onmousemove"),!a&&(e.value=[(m.screenX-o[0])*.8,(m.screenY-o[1])*.8],a=null)}},i=()=>{const[c,a]=t.value,[h,m]=e.value;t.value=[c+h,a+m],e.value=[0,0],document.onmousemove=document.onmouseup=null};return $e(()=>{document.addEventListener("mouseleave",()=>{i()})}),{handleMouseDown:u,handleMouseUp:i,positionDist:t,calcDist:e}}const _n={class:"left-top-wrapper"},gn={class:"canvas-node-container"},bn={__name:"Main",setup(l){const o=B([new x("start"),new x("feat"),new x("if",{branchList:[[new x("feat")]]}),new x("switch",{branchList:[[new x("feat")],[new x("feat")],[new x("feat")]]}),new x("end")]);window.__nodeList=o;const t=B(null);te("addNodeDialogRef",t);const e=B([]);te("hoverStack",e);const u=B({banDropNodeList:[],dragFlag:!1,customDragData:null});te("dragConf",u);const i=B(null);te("activateNode",i),window.__activateNode=i,Qe(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const c=B(null),a=()=>{var N;const r=i.value;if(!r||["start","end"].includes(r.type))return;const{parentNode:n,branchIdx:p,nodeList:b,nodeIdx:I}=ne(r);let P=null;if(Array.isArray(r)){if(((N=n.branchList)==null?void 0:N.length)<=Q)throw new Error(`分支数量至少为${Q},剪切失败！`);(n.branchList||[]).splice(p,1),P=n.nodeInfo.branchInfoList.splice(p,1)[0]}else b.splice(I,1);c.value={type:"shear",data:r,branchInfo:P}},h=()=>{const r=i.value;if(!r||["start","end"].includes(r.type))return;const{branchIdx:n,parentNode:p}=ne();c.value={type:"copy",data:r,branchInfo:n===null?null:JSON.parse(JSON.stringify(p.nodeInfo.branchInfoList[n]||{}))}},m=r=>{if(!c.value)return;const{type:n,data:p,branchInfo:b}=c.value;if(!p||["end"].includes(i.value.type))return;const I={copyNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:N,nodeIdx:U}=ne();N.splice(U+1,0,p.copySelf())},shearNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:N,nodeIdx:U}=ne();N.splice(U+1,0,p),c.value=null},copyBranch:()=>{var U;if(((U=i.value)==null?void 0:U.type)!=="switch")return;const N=i.value.branchList.push(p.map(ee=>ee.copySelf()));i.value.nodeInfo.branchInfoList[N-1]=b},shearBranch:()=>{var U;if(((U=i.value)==null?void 0:U.type)!=="switch")return;const N=i.value.branchList.push(p);i.value.nodeInfo.branchInfoList[N-1]=b,c.value=null}},P=n+(Array.isArray(p)?"Branch":"Node");I[P]()},g=B(!0),k=()=>{g.value=!g.value},$=B(!0),f=()=>{$.value=!$.value};te("branchNameFlag",$);const D=B(""),w=()=>{console.log("BaseNode.executeList(nodeList.value, [])",x.executeList(o.value,[]));const r=x.executeList(o.value,[]);D.value=r.context.code},{handleMouseDown:v,handleMouseUp:_,positionDist:V,calcDist:C}=hn();return(r,n)=>{const p=We,b=Ze("mousetrap");return d(),y(M,null,[A("div",{id:"canvas-main",class:"canvas-main",style:Z({"--var-position-x":`${s(V)[0]+s(C)[0]}px`,"--var-position-y":`${s(V)[1]+s(C)[1]}px`}),onClickCapture:n[1]||(n[1]=I=>i.value=null),onMousedown:n[2]||(n[2]=(...I)=>s(v)&&s(v)(...I)),onMouseup:n[3]||(n[3]=(...I)=>s(_)&&s(_)(...I)),onMousewheel:n[4]||(n[4]=(...I)=>r.onMouseWheel&&r.onMouseWheel(...I))},[A("div",_n,[O(p,{onClick:k},{default:R(()=>[j(" 快捷建："+H(g.value?"开启":"关闭"),1)]),_:1}),O(p,{onClick:f},{default:R(()=>[j(" 显示分支名："+H($.value?"开启":"关闭"),1)]),_:1}),O(p,{onClick:w},{default:R(()=>[j(" 执行 ")]),_:1})]),A("div",gn,[O(Ee,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=I=>o.value=I),"start-line":!1},null,8,["modelValue"])])],36),O(rn,{ref_key:"addNodeDialogRef",ref:t},null,512),O(s(mn)),g.value?me((d(),y("div",{key:0,"onMod+c":n[5]||(n[5]=()=>h()),"onMod+x":n[6]||(n[6]=()=>a()),"onMod+v":m},null,544)),[[b,["mod+c","mod+v","mod+x"]]]):T("",!0)],64)}}},yn=z(bn,[["__scopeId","data-v-450042e8"]]),jn={__name:"index",setup(l){return(o,t)=>(d(),S(yn))}};export{jn as default};
