var we=Object.defineProperty;var De=(o,t,n)=>t in o?we(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var re=(o,t,n)=>(De(o,typeof t!="symbol"?t+"":t,n),n);import"./base-aa9563f4.js";import{E as $e}from"./el-button-7af24728.js";import{_ as E,$ as Y,t as S,o as p,c as w,L,M as Q,S as q,i as d,G as M,F as k,j as te,B as J,v as V,r as I,C as B,U,E as X,H as ne,a0 as Z,am as ie,an as pe,ar as H,w as T,b as R,D as ve,a4 as fe,Q as oe,a as F,V as j,d as Le,a2 as Ce,a8 as Ve,I as W}from"./index-8ae97b1d.js";import{C as me}from"./index-72266f70.js";import{E as xe,a as Ie}from"./el-tab-pane-199f41f3.js";import{E as Be,a as ke}from"./el-form-item-aa2da51c.js";import{E as Ae,a as Se}from"./el-radio-button-409b5537.js";import{E as Me}from"./el-input-cb8555fc.js";import"./index-7c41fb03.js";import"./index-5e036139.js";import"./get-e7313515.js";import"./index-4dfb43ce.js";import"./typescript-defaf979.js";import"./event-e06a23af.js";import"./strings-4444b336.js";import"./aria-60e0cdc6.js";import"./vnode-339c4845.js";import"./objects-853fe3fc.js";import"./isNil-c75b1b34.js";const Ee=["onClick"],Pe={key:0,class:"line"},Re={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(o,{emit:t}){const n=o,e=Y(),r=S("addNodeDialogRef"),a=b=>{if(b.id==="canvas-main"||!b)return{x:0,y:0};const y=a(b.offsetParent);return{x:y.x+b.offsetLeft,y:y.y+b.offsetTop}},s=b=>{t("toAdd",b)},l=te(),h=b=>{if(n.addType==="branch")return t("toAdd");const{target:y,offsetY:m}=b,{x:c,y:$}=a(y);r.value.show({x:y.clientWidth+c,y:m+$},s,l)};return(b,y)=>(p(),w(k,null,[L("div",Q({class:"add-node"},d(e),{onClick:q(h,["stop"])})," + ",16,Ee),o.endLine?(p(),w("div",Pe)):M("",!0)],64))}},ae=E(Re,[["__scopeId","data-v-77b265a2"]]);const Fe=["onClick"],Te={__name:"SubBtn",emits:["toSub"],setup(o,{emit:t}){const n=S("hoverStack"),e=r=>{n.value=[],t("toSub")};return(r,a)=>(p(),w("div",{class:"sub-node",onClick:q(e,["stop"])}," - ",8,Fe))}},_e=E(Te,[["__scopeId","data-v-554bf87e"]]),je={},Oe={class:"node-wrapper"},Ue=L("div",{class:"c-circle c-start"}," start ",-1),He=[Ue];function ze(o,t){return p(),w("div",Oe,He)}const qe=E(je,[["render",ze]]),Ge={},Ke={class:"node-wrapper"},We=L("div",{class:"c-circle c-end"}," end ",-1),Xe=[We];function Ye(o,t){return p(),w("div",Ke,Xe)}const Qe=E(Ge,[["render",Ye]]),Je={},Ze={class:"node-wrapper"},et=L("div",{class:"c-circle c-other"}," Error ",-1);function tt(o,t){return p(),w("div",Ze,[J(o.$slots,"default"),et])}const he=E(Je,[["render",tt]]),le=o=>{var t;return o?(t=o==null?void 0:o.branchList)!=null&&t.length?o.branchList.reduce((n,e)=>n+Math.max(...e.map(r=>le(r)),1),0):1:0},ue=o=>Array.isArray(o)?Math.max(...o.map(t=>le(t)),1):1,nt=L("div",{class:"line"},null,-1),ge={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(o,{emit:t}){const n=o,e=V({get:()=>n.modelValue||[],set:u=>t("update:modelValue",u)}),r=V(()=>le(n.curNode)),a=V(()=>{var u;return ue((u=e.value)==null?void 0:u[0])}),s=V(()=>{var u;return ue((u=e.value)==null?void 0:u[e.value.length-1])}),l=S("activateNode"),h=S("hoverStack"),b=V(()=>h.value[0]),y=u=>h.value.unshift(e.value[u]),m=u=>h.value.shift(),c=I(null),$=u=>{c.value=u,e.value[u]},_=()=>{c.value=null},i=u=>{c.value!==null&&u.preventDefault()},f=u=>{if(c.value===u||c.value===null)return;let v=Math.min(c.value,u),g=Math.max(c.value,u);const D=e.value[c.value];for(;v<g;)c.value<u?e.value[v]=e.value[++v]:e.value[g]=e.value[--g],v===g&&(e.value[v]=D);c.value=null},N=u=>{l.value=e.value[u]};return(u,v)=>(p(),w(k,null,[nt,["switch"].includes(o.curNode.type)?(p(),B(ae,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:v[0]||(v[0]=g=>t("addBranch"))})):M("",!0),L("div",{class:"branch-wrapper branch-wrapper-width",style:ne({"--var-col-count":d(r),"--var-first-branch-col-count":d(a),"--var-last-branch-col-count":d(s)})},[(p(!0),w(k,null,U(d(e),(g,D)=>(p(),B(ye,{key:D,modelValue:d(e)[D],"onUpdate:modelValue":x=>d(e)[D]=x,class:X({"hover-branch":d(b)===d(e)[D]||d(l)===d(e)[D],"can-drop-branch":c.value!==null&&c.value!==D}),"branch-count":d(e).length,draggable:!0,onMouseenter:()=>y(D),onMouseleave:()=>m(),onRemoveBranch:()=>t("removeBranch",D),onDragstart:q(()=>$(D),["stop"]),onDragover:v[1]||(v[1]=x=>i(x)),onDropCapture:()=>f(D),onDragend:_,onClick:q(()=>N(D),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},ot=L("div",{class:"c-circle c-if"}," if ",-1),at={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=V({get:()=>n.modelValue.branchList,set:s=>t("update:modelValue",{...n.modelValue,branchList:s})}),r=Y(),a=s=>{var l;return s?(l=s==null?void 0:s.branchList)!=null&&l.length?s.branchList.reduce((h,b)=>h+Math.max(...b.map(y=>a(y)),1),0):1:0};return V(()=>a(n.modelValue)),(s,l)=>(p(),w(k,null,[L("div",Q({class:"node-wrapper"},d(r)),[J(s.$slots,"default"),ot],16),o.isPreview?M("",!0):(p(),B(ge,{key:0,modelValue:d(e),"onUpdate:modelValue":l[0]||(l[0]=h=>Z(e)?e.value=h:null),"cur-node":o.modelValue},null,8,["modelValue","cur-node"]))],64))}};const lt=o=>(ie("data-v-653f9187"),o=o(),pe(),o),st=lt(()=>L("div",{class:"c-circle c-switch"}," switch ",-1)),rt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=V({get:()=>n.modelValue.branchList||[],set:l=>t("update:modelValue",{...n.modelValue,branchList:l})}),r=Y(),a=()=>{e.value.push([])},s=l=>{e.value.splice(l,1)};return(l,h)=>(p(),w(k,null,[L("div",Q({class:"node-wrapper"},d(r)),[J(l.$slots,"default",{},void 0,!0),st],16),o.isPreview?M("",!0):(p(),B(ge,{key:0,modelValue:d(e),"onUpdate:modelValue":h[0]||(h[0]=b=>Z(e)?e.value=b:null),"cur-node":o.modelValue,onAddBranch:a,onRemoveBranch:s},null,8,["modelValue","cur-node"]))],64))}},ut=E(rt,[["__scopeId","data-v-653f9187"]]),ct={},dt={class:"node-wrapper"},it=L("div",{class:"c-circle c-feat"}," Feat ",-1);function pt(o,t){return p(),w("div",dt,[J(o.$slots,"default"),it])}const vt=E(ct,[["render",pt]]),se=[{type:"start",component:H(qe),generateNode:()=>new C("start")},{type:"end",component:H(Qe),generateNode:()=>new C("end")},{type:"if",component:H(at),generateNode:()=>new C("if")},{type:"switch",component:H(ut),generateNode:(o=[[],[]])=>new C("switch",{branchList:o})},{type:"feat",component:H(vt),generateNode:()=>new C("feat")}],z=2,ce=(o,t=z)=>{const n=o==null?void 0:o.filter(Array.isArray);return n!=null&&n.length?t?n.length>=t?n.slice(0,t):n.slice().concat(new Array(t-n.length).fill(0).map(e=>[])):n.slice():new Array(t).fill(0).map(e=>[])},de=()=>({code:""}),ft=o=>{const n={if:{nodeName:"if",condition:"a>b",trueBranchIdx:1}}[o]||{};return n.nodeName=o,n},O=class{constructor(t,n){const{branchList:e=[],nodeInfo:r={}}=n||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++O.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:se.some(s=>s.type===t)?t:"error"}),t==="if"){const s=ce(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(s,{get(l,h,b){return Reflect.get(l,h,b)},set(l,h,b,y){return["0","1"].includes(h)?Reflect.set(l,h,b,y):(console.error(`分支数量必须为${z}`),!1)}})}})}if(t==="switch"){let s=ce(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>s,set(l){if(l.length<z)throw new he(`分支数量至少为${z}`);s=l}})}const a=ft(this.type);Object.assign(a,r),Object.defineProperty(this,"nodeInfo",{configurable:!1,get(){return new Proxy(a,{get(s,l,h){return Reflect.get(s,l,h)},set(s,l,h,b){return console.log("修改了",s,"的",l,"为",h),Reflect.set(s,l,h,b)}})}})}static copyBranchList(t){return(t==null?void 0:t.map(n=>(n==null?void 0:n.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new O(this.type,{branchList:O.copyBranchList(this.branchList)})}static executeNode(t,n=[],e){e||(e=de());const{type:r,branchList:a}=t;let s;["if","switch"].includes(r)&&(s=O.executeList(a[0],n));const l={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${s.context.code}
        }
      `,switch:()=>`switch(){
        ${s.context.code}
      }
      `};return e.code+=l[r](),{result:n,context:e}}static executeList(t,n=[]){const e=de();return{result:t.reduce((a,s)=>O.executeNode(s,a,e).result,n),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((t,n)=>{let e=`${t},${n}:`;return Array.isArray(this[n])?e+=`[${this[n].toString()}]`:typeof this[n]=="number"?e+=`${this[n].toString()}`:typeof this[n]=="string"?e+=`"${this[n].toString()}"`:e+=`{${this[n].toString()}}`,e},"").slice(1)}}`}};let C=O;re(C,"id",0);const mt={type:"error",component:H(he),generateNode:()=>new C("error")},be=(o,t,n=null)=>{for(let e in o){e=e-0;const r=o[e];if(r===t)return{nodeList:o,parentNode:n,nodeIdx:e,branchIdx:null};for(let a in r.branchList||[]){a=a-0;const s=r.branchList[a];if(s===t)return{nodeList:s,parentNode:r,branchIdx:a,nodeIdx:null};const l=be(s,t,r);if(l)return l}}return null},G=o=>{var e,r;const t=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],n=((r=window==null?void 0:window.__activateNode)==null?void 0:r.value)||null;return be(t||[],o||n)},_t=["draggable","onDragstart","onClick"],ht=L("div",{class:"line"},null,-1),gt={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(o,{emit:t}){const n=o,e=V({get:()=>n.modelValue,set:g=>t("update:modelValue",g)}),r=V({get:()=>n.nodeList,set:g=>t("update:nodeList",g)}),a=V(()=>(se.find(g=>g.type===e.value.type)||mt).component),s=S("hoverStack"),l=S("dragConf"),h=S("activateNode"),b=V(()=>s.value[0]),y=()=>s.value.unshift(e.value),m=()=>s.value.shift(),c=()=>{l.value.customDragData={node:e.value,curBranch:r.value,target:null};const g=[],D=(x,A)=>{var K;!A&&g.push(x),(K=x==null?void 0:x.branchList)!=null&&K.length&&x.branchList.forEach(P=>{g.push(P),P.forEach(Ne=>D(Ne))})};D(e.value,!0),l.value.dragFlag=!0,l.value.banDropNodeList=g},$=()=>{l.value.dragFlag=!1,l.value.banDropNodeList=[]},_=te(),i=()=>{l.value.customDragData&&(l.value.banDropNodeList.includes(e)||fe(l.value.customDragData.target)===_&&(t("moveTo",l.value.customDragData.node,l.value.customDragData.curBranch),l.value.customDragData=null,s.value=[]))},f=()=>{l.value.customDragData&&(l.value.customDragData.target=_)},N=()=>{l.value.customDragData&&(l.value.customDragData.target=null)},u=g=>{l.value.dragFlag&&!l.value.banDropNodeList.includes(e.value)&&g.preventDefault()},v=()=>{h.value=e.value};return(g,D)=>(p(),w(k,null,[L("div",{draggable:!["start","end"].includes(d(e).type),class:X(["node-box",{"hover-node":d(b)===d(e)||d(h)===d(e),"no-branch-box":!["if","switch"].includes(d(e).type)}]),onMouseenter:y,onMouseleave:m,onDragstart:q(c,["stop"]),onDragend:$,onClick:q(v,["stop"])},[(p(),B(ve(d(a)),{modelValue:d(e),"onUpdate:modelValue":D[1]||(D[1]=x=>Z(e)?e.value=x:null)},{default:T(()=>[R(_e,{onToSub:D[0]||(D[0]=x=>t("subNode"))})]),_:1},8,["modelValue"]))],42,_t),d(e).type!=="end"?(p(),w(k,{key:0},[ht,R(ae,{class:X({canDropFlag:d(l).dragFlag&&!d(l).banDropNodeList.includes(d(e))}),onToAdd:D[2]||(D[2]=x=>t("addNode",x)),onDragover:u,onDrop:i,onDragenter:f,onDragleave:N},null,8,["class"])],64)):M("",!0)],64))}},bt=L("div",{class:"line"},null,-1),ye={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1}},emits:["update:modelValue","removeBranch"],setup(o,{emit:t}){const n=o,e=Y(),r=V({get:()=>n.modelValue,set:i=>t("update:modelValue",i)}),a=S("dragConf"),s=S("hoverStack"),l=(i,f)=>{const N=f.generateNode();r.value.splice(i+1,0,N)},h=(i,f,N)=>{const u=f.findIndex(v=>v===i);if(f===r.value){if(u===N+1||u===N)return;u>N?(f.splice(u,1),f.splice(N+1,0,i)):(f.splice(N+1,0,i),f.splice(u,1))}else f.splice(u,1),r.value.splice(N+1,0,i)},b=i=>{r.value.splice(i,1)},y=te(),m=()=>{a.value.customDragData&&(a.value.banDropNodeList.includes(r)||fe(a.value.customDragData.target)===y&&(h(a.value.customDragData.node,a.value.customDragData.curBranch,-1),s.value=[],a.value.customDragData=null))},c=()=>{a.value.customDragData&&(a.value.customDragData.target=y)},$=()=>{a.value.customDragData&&(a.value.customDragData.target=null)},_=i=>{a.value.dragFlag&&!a.value.banDropNodeList.includes(r.value)&&i.preventDefault()};return(i,f)=>(p(),w("div",Q({class:"render-list-wrapper"},d(e)),[o.startLine?(p(),w(k,{key:0},[o.branchCount>2?(p(),B(_e,{key:0,onClick:f[0]||(f[0]=N=>t("removeBranch"))})):M("",!0),bt,R(ae,{class:X({canDropFlag:d(a).dragFlag&&!d(a).banDropNodeList.includes(d(r))}),droppable:d(a).dragFlag&&!d(a).banDropNodeList.includes(d(r)),onToAdd:f[1]||(f[1]=N=>l(-1,N)),onDragover:_,onDrop:m,onDragenter:c,onDragleave:$},null,8,["class","droppable"])],64)):M("",!0),(p(!0),w(k,null,U(d(r),(N,u)=>(p(),B(gt,{key:N.id,modelValue:d(r)[u],"onUpdate:modelValue":v=>d(r)[u]=v,"node-list":d(r),"onUpdate:nodeList":f[2]||(f[2]=v=>Z(r)?r.value=v:null),onAddNode:v=>l(u,v),onSubNode:()=>b(u),onMoveTo:(v,g)=>h(v,g,u)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}};const yt={class:"select-node-wrapper"},Nt={__name:"AddNodeDialog",setup(o,{expose:t}){const n=I({x:1,y:1}),e=I(!1);let r,a;const s=()=>{e.value=!1,r=null,a=null},l=(y,m,c)=>{if(a===c)return s();a=c,r=m,n.value=y,e.value=!0},h=y=>{r==null||r(y),s()},b=I(se.filter(y=>!["start","end"].includes(y.type)));return t({show:l,close:s}),(y,m)=>oe((p(),w("div",{class:"add-node-dialog",style:ne({"--var-dialog-left":`${n.value.x}px`,"--var-dialog-top":`${n.value.y}px`,"--var-dialog-size":e.value?"300px":"0"})},[L("div",yt,[(p(!0),w(k,null,U(b.value,c=>(p(),B(ve(c.component),{key:c.type,"is-preview":!0,onClick:()=>h(c)},null,8,["onClick"]))),128))])],4)),[[d(me),s]])}},wt=E(Nt,[["__scopeId","data-v-7f77c4dd"]]);const Dt={class:"tab-pane-content"},$t={class:"module-name"},Lt={__name:"NodeInfo",setup(o){const t=S("activateNode"),n=V(()=>Array.isArray(t.value)),e=V(()=>{if(n.value){const{parentNode:m,branchIdx:c}=G(t.value[0]);return console.log("parentNode",m),m}else return t.value}),r=V({get:()=>{var m;return((m=e.value)==null?void 0:m.nodeInfo)||{}},set:m=>{e.value.nodeInfo=m}}),a=m=>{const c=(_,i,f,N={options:[{label:"是",value:!0},{label:"否",value:!1}]})=>({label:_,field:i,type:f,conf:N}),{type:$}=m;switch($){case"if":return{base:[{moduleName:"基本信息",attrs:[c("节点名称","nodeName","input"),c("判断条件","condition","input"),c("true分支索引","trueBranchIdx","radio",{options:[{label:1,value:1},{label:2,value:2}]})]},{moduleName:"分支信息",attrs:[c("分支名称","","input",{disabled:!0})].filter(_=>n.value)},{moduleName:"输入参数",attrs:[]},{moduleName:"输出参数",attrs:[]}].filter(_=>{var i;return(i=_==null?void 0:_.attrs)==null?void 0:i.length}),other:[{moduleName:"",attrs:[{label:"",type:"input"}]}].filter(_=>{var i;return(i=_==null?void 0:_.attrs)==null?void 0:i.length})};default:return{base:[],other:[]}}},s=V(()=>{const{base:m,other:c}=a(e.value);return console.log(m,c),[{label:"基础属性",modules:m},{label:"其他属性",modules:c}]}),l=I("基础属性"),h=V({get(){return m=>{const c=(m==null?void 0:m.split("."))||[];return c.reduce(($,_)=>($==null?void 0:$[_])||void 0,c.length?r.value:void 0)}}}),b=m=>typeof m=="object"&&m!==null,y=(m,c)=>{const $=(c==null?void 0:c.split("."))||[];if($.length)if($.length===1)r.value[$[0]]=m;else{const _=$.pop();try{let i="nodeInfo";const f=$.reduce((N,u)=>(i+=`.${u}`,b(N[u])||(console.warn(`${i}不是一个对象，已强制转化为对象`),N[u]={}),N[u]),$.length?r.value:void 0);f[_]=m}catch(i){console.error(`nodeInfo数据异常，无法读取${c}字段`),console.error(i)}}};return(m,c)=>{const $=Me,_=Ae,i=Se,f=Be,N=ke,u=xe,v=Ie;return p(),B(v,{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=g=>l.value=g),stretch:!0},{default:T(()=>[(p(!0),w(k,null,U(d(s),g=>(p(),B(u,{key:g.label,label:g.label,name:g.label},{default:T(()=>[R(N,{model:d(r)},{default:T(()=>[F(j(d(r))+" ",1),L("div",Dt,[(p(!0),w(k,null,U(g.modules,(D,x)=>(p(),w("div",{key:x,class:"module-content"},[L("div",$t,j(D.moduleName),1),(p(!0),w(k,null,U(D.attrs,(A,K)=>(p(),w("div",{key:K},[R(f,{label:A.label,rules:A.required&&[{required:!0,message:""}]},{default:T(()=>[A.type==="input"?(p(),B($,{key:0,disabled:A.conf.disabled,"model-value":d(h)(A.field),onInput:P=>y(P,A.field)},null,8,["disabled","model-value","onInput"])):M("",!0),A.type==="radio"?(p(),B(i,{key:1,disabled:A.conf.disabled,"model-value":d(h)(A.field),onChange:P=>y(P,A.field)},{default:T(()=>[(p(!0),w(k,null,U(A.conf.options,P=>(p(),B(_,{key:P.value,label:P.label,value:P.value},null,8,["label","value"]))),128))]),_:2},1032,["disabled","model-value","onChange"])):M("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},Ct=E(Lt,[["__scopeId","data-v-cb31a508"]]);const Vt={__name:"index",setup(o){const t="350px",n=S("activateNode"),e=I(null),r=I(!1);Le(()=>n.value,s=>{s&&(e.value=s,r.value=!0)});const a=()=>{r.value=!1,e.value=null};return(s,l)=>oe((p(),w("div",{style:ne({"--var-width":t,"--var-right":r.value?0:`-${t}`,"--var-opacity":Number(r.value)}),class:"custom-drawer"},[e.value?(p(),B(Ct,{key:0})):M("",!0)],4)),[[d(me),a]])}},xt=E(Vt,[["__scopeId","data-v-3de69590"]]);const ee=o=>(ie("data-v-5ea59a69"),o=o(),pe(),o),It={style:{display:"inline-block","vertical-align":"top"}},Bt=ee(()=>L("br",null,null,-1)),kt=ee(()=>L("br",null,null,-1)),At=ee(()=>L("br",null,null,-1)),St=ee(()=>L("br",null,null,-1)),Mt={__name:"Main",setup(o){const t=I([new C("start"),new C("feat"),new C("if",{branchList:[[new C("feat")]]}),new C("switch",{branchList:[[new C("feat")],[new C("feat")],[new C("feat")]]}),new C("end")]);window.__nodeList=t;const n=I(null);W("addNodeDialogRef",n);const e=I([]);W("hoverStack",e);const r=I({banDropNodeList:[],dragFlag:!1,customDragData:null});W("dragConf",r);const a=I(null);W("activateNode",a),window.__activateNode=a,Ce(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const s=I(null),l=()=>{var v;const _=a.value;if(!_||["start","end"].includes(_.type))return;const{parentNode:i,branchIdx:f,nodeList:N,nodeIdx:u}=G();if(Array.isArray(_)){if(((v=i.branchList)==null?void 0:v.length)<=z)throw new Error(`分支数量至少为${z},剪切失败！`);(i.branchList||[]).splice(f,1)}else N.splice(u,1);s.value={type:"shear",data:_}},h=()=>{const _=a.value;_&&(["start","end"].includes(_.type)||(s.value={type:"copy",data:_}))},b=_=>{if(!s.value)return;const{type:i,data:f}=s.value;if(!f||["end"].includes(a.value.type))return;const N={copyNode:()=>{if(!a.value||Array.isArray(a.value))return;const{nodeList:v,nodeIdx:g}=G();console.log({branchNodeList:v,nodeIdx:g}),v.splice(g+1,0,f.copySelf())},shearNode:()=>{if(!a.value||Array.isArray(a.value))return;const{nodeList:v,nodeIdx:g}=G();v.splice(g+1,0,f),s.value=null},copyBranch:()=>{var v;((v=a.value)==null?void 0:v.type)==="switch"&&a.value.branchList.push(f.map(g=>g.copySelf()))},shearBranch:()=>{var v;((v=a.value)==null?void 0:v.type)==="switch"&&(a.value.branchList.push(f),s.value=null)}},u=i+(Array.isArray(f)?"Branch":"Node");N[u]()},y=I(!0),m=()=>{y.value=!y.value},c=I(""),$=()=>{console.log("BaseNode.executeList(nodeList.value, [])",C.executeList(t.value,[]));const _=C.executeList(t.value,[]);c.value=_.context.code};return(_,i)=>{var u;const f=$e,N=Ve("mousetrap");return p(),w(k,null,[L("div",{id:"canvas-main",class:"canvas-main",onClickCapture:i[1]||(i[1]=v=>a.value=null)},[R(f,{onClick:m},{default:T(()=>[F(" 快捷建："+j(y.value?"开启":"关闭"),1)]),_:1}),R(f,{onClick:$},{default:T(()=>[F(" 执行 ")]),_:1}),R(ye,{modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=v=>t.value=v),"start-line":!1},null,8,["modelValue"]),L("div",It,[F(" shearPlate: "+j(s.value)+" ",1),Bt,F(" ParentNode: "+j(((u=d(G)())==null?void 0:u.parentNode)||"null")+" ",1),kt,F(" activateNode: "+j(a.value)+" ",1),At,L("pre",null,[F("      code"),St,F(`
      `+j(c.value)+`
    `,1)])])],32),R(wt,{ref_key:"addNodeDialogRef",ref:n},null,512),R(d(xt)),y.value?oe((p(),w("div",{key:0,"onMod+c":i[2]||(i[2]=()=>h()),"onMod+x":i[3]||(i[3]=()=>l()),"onMod+v":b},null,544)),[[N,["mod+c","mod+v","mod+x"]]]):M("",!0)],64)}}},Et=E(Mt,[["__scopeId","data-v-5ea59a69"]]),nn={__name:"index",setup(o){return(t,n)=>(p(),B(Et))}};export{nn as default};
