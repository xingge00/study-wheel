var Me=Object.defineProperty;var Fe=(l,a,t)=>a in l?Me(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t;var be=(l,a,t)=>(Fe(l,typeof a!="symbol"?a+"":a,t),t);import{a as Oe,d as Re,l as le,i as ue,c as Ue,_ as je,w as ze}from"./base-306284f8.js";import{i as ye,a as He,b as Ke,d as qe,c as Je,E as Xe}from"./el-button-6cd06d56.js";import{l as ie,A as $e,v as L,r as B,d as ae,k as Ce,o as v,c as y,L as A,i as s,E as P,R as Ye,C as S,w as F,D as Q,G as E,V as q,b as R,H as ee,S as W,j as se,n as Ge,ar as Ne,_ as H,$ as re,t as j,M as X,F as M,B as K,a as z,U as G,a0 as ce,as as Y,a4 as Le,am as We,an as Qe,Q as me,at as we,a2 as Ze,a8 as et,I as te}from"./index-3501b031.js";import{C as ke}from"./index-8d7fd991.js";import{E as tt,a as nt}from"./el-tab-pane-70d5e134.js";import{E as at,a as ot}from"./el-form-item-508fe19d.js";import{E as lt,a as st}from"./el-radio-button-27fdd556.js";import{E as rt}from"./el-input-dadeb05a.js";import{u as ct,f as ut,E as oe,l as it}from"./index-1e8b2bf6.js";import{i as dt}from"./validator-51313159.js";import{U as de,C as ve,I as pe,d as vt,t as pt}from"./event-e06a23af.js";import"./index-70cb4665.js";import"./get-e7313515.js";import"./index-2c2ca24f.js";import"./typescript-defaf979.js";import"./strings-f9c68b33.js";import"./aria-60e0cdc6.js";import"./vnode-13ab5416.js";import"./objects-b5168532.js";import"./isNil-c75b1b34.js";const ft=Oe({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:ye},inactiveIcon:{type:ye},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:Re(Function)},size:{type:String,validator:dt},tabindex:{type:[String,Number]}}),mt={[de]:l=>le(l)||ie(l)||ue(l),[ve]:l=>le(l)||ie(l)||ue(l),[pe]:l=>le(l)||ie(l)||ue(l)},ht=["onClick"],_t=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],gt=["aria-hidden"],bt=["aria-hidden"],yt=["aria-hidden"],fe="ElSwitch",Nt=$e({name:fe}),wt=$e({...Nt,props:ft,emits:mt,setup(l,{expose:a,emit:t}){const e=l,c=se(),{formItem:i}=He(),r=Ke(),o=Ue("switch");ct({from:'"value"',replacement:'"model-value" or "v-model"',scope:fe,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},L(()=>{var n;return!!((n=c.vnode.props)!=null&&n.value)}));const{inputId:g}=qe(e,{formItemContext:i}),h=Je(L(()=>e.loading)),b=B(e.modelValue!==!1),k=B(),C=B(),m=L(()=>[o.b(),o.m(r.value),o.is("disabled",h.value),o.is("checked",p.value)]),I=L(()=>({width:ut(e.width)}));ae(()=>e.modelValue,()=>{b.value=!0}),ae(()=>e.value,()=>{b.value=!1});const N=L(()=>b.value?e.modelValue:e.value),p=L(()=>N.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(N.value)||(t(de,e.inactiveValue),t(ve,e.inactiveValue),t(pe,e.inactiveValue)),ae(p,n=>{var d;k.value.checked=n,e.validateEvent&&((d=i==null?void 0:i.validate)==null||d.call(i,"change").catch(f=>vt()))});const _=()=>{const n=p.value?e.inactiveValue:e.activeValue;t(de,n),t(ve,n),t(pe,n),Ge(()=>{k.value.checked=p.value})},w=()=>{if(h.value)return;const{beforeChange:n}=e;if(!n){_();return}const d=n();[Ne(d),le(d)].includes(!0)||pt(fe,"beforeChange must return type `Promise<boolean>` or `boolean`"),Ne(d)?d.then(D=>{D&&_()}).catch(D=>{}):d&&_()},$=L(()=>o.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),u=()=>{var n,d;(d=(n=k.value)==null?void 0:n.focus)==null||d.call(n)};return Ce(()=>{k.value.checked=p.value}),a({focus:u,checked:p}),(n,d)=>(v(),y("div",{class:P(s(m)),style:ee(s($)),onClick:W(w,["prevent"])},[A("input",{id:s(g),ref_key:"input",ref:k,class:P(s(o).e("input")),type:"checkbox",role:"switch","aria-checked":s(p),"aria-disabled":s(h),name:n.name,"true-value":n.activeValue,"false-value":n.inactiveValue,disabled:s(h),tabindex:n.tabindex,onChange:_,onKeydown:Ye(w,["enter"])},null,42,_t),!n.inlinePrompt&&(n.inactiveIcon||n.inactiveText)?(v(),y("span",{key:0,class:P([s(o).e("label"),s(o).em("label","left"),s(o).is("active",!s(p))])},[n.inactiveIcon?(v(),S(s(oe),{key:0},{default:F(()=>[(v(),S(Q(n.inactiveIcon)))]),_:1})):E("v-if",!0),!n.inactiveIcon&&n.inactiveText?(v(),y("span",{key:1,"aria-hidden":s(p)},q(n.inactiveText),9,gt)):E("v-if",!0)],2)):E("v-if",!0),A("span",{ref_key:"core",ref:C,class:P(s(o).e("core")),style:ee(s(I))},[n.inlinePrompt?(v(),y("div",{key:0,class:P(s(o).e("inner"))},[n.activeIcon||n.inactiveIcon?(v(),S(s(oe),{key:0,class:P(s(o).is("icon"))},{default:F(()=>[(v(),S(Q(s(p)?n.activeIcon:n.inactiveIcon)))]),_:1},8,["class"])):n.activeText||n.inactiveText?(v(),y("span",{key:1,class:P(s(o).is("text")),"aria-hidden":!s(p)},q(s(p)?n.activeText:n.inactiveText),11,bt)):E("v-if",!0)],2)):E("v-if",!0),A("div",{class:P(s(o).e("action"))},[n.loading?(v(),S(s(oe),{key:0,class:P(s(o).is("loading"))},{default:F(()=>[R(s(it))]),_:1},8,["class"])):E("v-if",!0)],2)],6),!n.inlinePrompt&&(n.activeIcon||n.activeText)?(v(),y("span",{key:1,class:P([s(o).e("label"),s(o).em("label","right"),s(o).is("active",s(p))])},[n.activeIcon?(v(),S(s(oe),{key:0},{default:F(()=>[(v(),S(Q(n.activeIcon)))]),_:1})):E("v-if",!0),!n.activeIcon&&n.activeText?(v(),y("span",{key:1,"aria-hidden":!s(p)},q(n.activeText),9,yt)):E("v-if",!0)],2)):E("v-if",!0)],14,ht))}});var It=je(wt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Be=ze(It);const Dt=["onClick"],Vt={key:0,class:"line"},$t={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(l,{emit:a}){const t=l,e=re(),c=j("addNodeDialogRef"),i=h=>{if(h.id==="canvas-main"||!h)return{x:0,y:0};const b=i(h.offsetParent);return{x:b.x+h.offsetLeft,y:b.y+h.offsetTop}},r=h=>{a("toAdd",h)},o=se(),g=h=>{if(t.addType==="branch")return a("toAdd");const{target:b,offsetY:k}=h,{x:C,y:m}=i(b);c.value.show({x:b.clientWidth+C,y:k+m},r,o)};return(h,b)=>(v(),y(M,null,[A("div",X({class:"add-node"},s(e),{onClick:W(g,["stop"])})," + ",16,Dt),l.endLine?(v(),y("div",Vt)):E("",!0)],64))}},he=H($t,[["__scopeId","data-v-77b265a2"]]);const Ct=["onClick"],Lt={__name:"SubBtn",emits:["toSub"],setup(l,{emit:a}){const t=j("hoverStack"),e=c=>{t.value=[],a("toSub")};return(c,i)=>(v(),y("div",{class:"sub-node",onClick:W(e,["stop"])}," - ",8,Ct))}},Se=H(Lt,[["__scopeId","data-v-554bf87e"]]),kt={},Bt={class:"node-wrapper"},St={class:"c-circle c-start"};function At(l,a){return v(),y("div",Bt,[A("div",St,[K(l.$slots,"showName",{},()=>[z(" start ")])])])}const xt=H(kt,[["render",At]]),Et={},Tt={class:"node-wrapper"},Pt={class:"c-circle c-end"};function Mt(l,a){return v(),y("div",Tt,[A("div",Pt,[K(l.$slots,"showName",{},()=>[z(" end ")])])])}const Ft=H(Et,[["render",Mt]]),Ot={},Rt={class:"node-wrapper"},Ut={class:"c-circle c-other"};function jt(l,a){return v(),y("div",Rt,[K(l.$slots,"default"),A("div",Ut,[K(l.$slots,"showName",{},()=>[z(" error ")])])])}const Ae=H(Ot,[["render",jt]]),_e=l=>{var a;return l?(a=l==null?void 0:l.branchList)!=null&&a.length?l.branchList.reduce((t,e)=>t+Math.max(...e.map(c=>_e(c)),1),0):1:0},Ie=l=>Array.isArray(l)?Math.max(...l.map(a=>_e(a)),1):1,zt=A("div",{class:"line"},null,-1),xe={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(l,{emit:a}){const t=l,e=L({get:()=>t.modelValue||[],set:u=>a("update:modelValue",u)}),c=L(()=>{var u,n,d,f,D,T;return((u=t.curNode)==null?void 0:u.type)==="switch"?(((d=(n=t.curNode)==null?void 0:n.nodeInfo)==null?void 0:d.branchInfoList)||[]).map(V=>V==null?void 0:V.branchName):((f=t.curNode)==null?void 0:f.type)==="if"?(((T=(D=t.curNode)==null?void 0:D.nodeInfo)==null?void 0:T.branchInfoList)||[]).map(V=>V.branchName):[]}),i=L(()=>_e(t.curNode)),r=L(()=>{var u;return Ie((u=e.value)==null?void 0:u[0])}),o=L(()=>{var u;return Ie((u=e.value)==null?void 0:u[e.value.length-1])}),g=j("activateNode"),h=j("hoverStack"),b=L(()=>h.value[0]),k=u=>h.value.unshift(e.value[u]),C=u=>h.value.shift(),m=B(null),I=u=>{m.value=u,e.value[u]},N=()=>{m.value=null},p=u=>{m.value!==null&&u.preventDefault()},_=(u,n,d)=>{let f=Math.min(n,d),D=Math.max(n,d);const T=u[n];for(;f<D;)n<d?u[f]=u[++f]:u[D]=u[--D],f===D&&(u[f]=T)},w=u=>{var n,d;m.value===u||m.value===null||(_(e.value||[],m.value,u),_(((d=(n=t.curNode)==null?void 0:n.nodeInfo)==null?void 0:d.branchInfoList)||[],m.value,u),m.value=null)},$=u=>{g.value=e.value[u]};return(u,n)=>(v(),y(M,null,[zt,["switch"].includes(l.curNode.type)?(v(),S(he,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:n[0]||(n[0]=d=>a("addBranch"))})):E("",!0),A("div",{class:"branch-wrapper branch-wrapper-width",style:ee({"--var-col-count":s(i),"--var-first-branch-col-count":s(r),"--var-last-branch-col-count":s(o)})},[(v(!0),y(M,null,G(s(e),(d,f)=>(v(),S(Te,{key:f,modelValue:s(e)[f],"onUpdate:modelValue":D=>s(e)[f]=D,class:P({"hover-branch":s(b)===s(e)[f]||s(g)===s(e)[f],"can-drop-branch":m.value!==null&&m.value!==f}),"branch-count":s(e).length,"branch-name":s(c)[f],draggable:!0,onMouseenter:()=>k(f),onMouseleave:()=>C(),onRemoveBranch:()=>a("removeBranch",f),onDragstart:W(()=>I(f),["stop"]),onDragover:n[1]||(n[1]=D=>p(D)),onDropCapture:()=>w(f),onDragend:N,onClick:W(()=>$(f),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},Ht={class:"c-circle c-if"},Kt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:a}){const t=l,e=L({get:()=>t.modelValue.branchList,set:r=>a("update:modelValue",{...t.modelValue,branchList:r})}),c=re(),i=r=>{var o;return r?(o=r==null?void 0:r.branchList)!=null&&o.length?r.branchList.reduce((g,h)=>g+Math.max(...h.map(b=>i(b)),1),0):1:0};return L(()=>i(t.modelValue)),(r,o)=>(v(),y(M,null,[A("div",X({class:"node-wrapper"},s(c)),[K(r.$slots,"default"),A("div",Ht,[K(r.$slots,"showName",{},()=>[z(" if ")])])],16),l.isPreview?E("",!0):(v(),S(xe,{key:0,modelValue:s(e),"onUpdate:modelValue":o[0]||(o[0]=g=>ce(e)?e.value=g:null),"cur-node":l.modelValue},null,8,["modelValue","cur-node"]))],64))}};const qt={class:"c-circle c-switch"},Jt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:a}){const t=l,e=L({get:()=>t.modelValue.branchList||[],set:o=>a("update:modelValue",{...t.modelValue,branchList:o})}),c=re(),i=()=>{const o=e.value.push([]);t.modelValue.nodeInfo.branchInfoList[o]={}},r=o=>{e.value.splice(o,1),t.modelValue.nodeInfo.branchInfoList.splice(o,1)};return(o,g)=>(v(),y(M,null,[A("div",X({class:"node-wrapper"},s(c)),[K(o.$slots,"default",{},void 0,!0),A("div",qt,[K(o.$slots,"showName",{},()=>[z(" switch ")],!0)])],16),l.isPreview?E("",!0):(v(),S(xe,{key:0,modelValue:s(e),"onUpdate:modelValue":g[0]||(g[0]=h=>ce(e)?e.value=h:null),"cur-node":l.modelValue,onAddBranch:i,onRemoveBranch:r},null,8,["modelValue","cur-node"]))],64))}},Xt=H(Jt,[["__scopeId","data-v-c8b2d440"]]),Yt={class:"node-wrapper"},Gt={class:"c-circle c-feat"},Wt={__name:"Feat",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(l){return(a,t)=>(v(),y("div",Yt,[K(a.$slots,"default"),A("div",Gt,[K(a.$slots,"showName",{},()=>[z(" Feat ")])])]))}},ge=[{type:"start",component:Y(xt),generateNode:()=>new x("start")},{type:"end",component:Y(Ft),generateNode:()=>new x("end")},{type:"if",component:Y(Kt),generateNode:()=>new x("if")},{type:"switch",component:Y(Xt),generateNode:(l=[[],[]])=>new x("switch",{branchList:l})},{type:"feat",component:Y(Wt),generateNode:()=>new x("feat")}],Z=2,De=(l,a=Z)=>{const t=l==null?void 0:l.filter(Array.isArray);return t!=null&&t.length?a?t.length>=a?t.slice(0,a):t.slice().concat(new Array(a-t.length).fill(0).map(e=>[])):t.slice():new Array(a).fill(0).map(e=>[])},Ve=()=>({code:""}),Qt=({type:l,branchList:a})=>{const e={if:{condition:"",branchInfoList:[{branchName:"分支1",type:!0},{branchName:"分支2",type:!1}]},switch:{branchInfoList:(a||[]).map((c,i)=>({branchName:`分支${i}`,condition:""}))}}[l]||{};return e.type=l,e.nodeName=l,e},J=class{constructor(a,t){const{branchList:e=[],nodeInfo:c={}}=t||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++J.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:ge.some(o=>o.type===a)?a:"error"}),a==="if"){const o=De(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(o,{get(g,h,b){return Reflect.get(g,h,b)},set(g,h,b,k){return["0","1"].includes(h)?Reflect.set(g,h,b,k):(console.error(`分支数量必须为${Z}`),!1)}})}})}if(a==="switch"){let o=De(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>o,set(g){if(g.length<Z)throw new Ae(`分支数量至少为${Z}`);o=g}})}const i=Qt(this);Object.assign(i,c);const r=new Proxy(i,{get(o,g,h){return Reflect.get(o,g,h)},set(o,g,h,b){return console.log("修改了",o,"的",g,"为",h),Reflect.set(o,g,h,b)}});this.nodeInfo=r}static copyBranchList(a){return(a==null?void 0:a.map(t=>(t==null?void 0:t.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new J(this.type,{branchList:J.copyBranchList(this.branchList),nodeInfo:JSON.parse(JSON.stringify(this.nodeInfo))})}static executeNode(a,t=[],e){e||(e=Ve());const{type:c,branchList:i}=a;let r;c==="if"&&(r=J.executeList(i[0],t)),c==="switch"&&(r=J.executeList(i[0],t));const o={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${r.context.code}
        }
      `,switch:()=>`switch(){
        ${r.context.code}
      }
      `};return e.code+=o[c](),{result:t,context:e}}static executeList(a,t=[]){const e=Ve();return{result:a.reduce((i,r)=>J.executeNode(r,i,e).result,t),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((a,t)=>{let e=`${a},${t}:`;return Array.isArray(this[t])?e+=`[${this[t].toString()}]`:typeof this[t]=="number"?e+=`${this[t].toString()}`:typeof this[t]=="string"?e+=`"${this[t].toString()}"`:e+=`{${this[t].toString()}}`,e},"").slice(1)}}`}};let x=J;be(x,"id",0);const Zt={type:"error",component:Y(Ae),generateNode:()=>new x("error")},Ee=(l,a,t=null)=>{for(let e in l){e=e-0;const c=l[e];if(c===a)return{nodeList:l,parentNode:t,nodeIdx:e,branchIdx:null};for(let i in c.branchList||[]){i=i-0;const r=c.branchList[i];if(r===a)return{nodeList:r,parentNode:c,branchIdx:i,nodeIdx:null};const o=Ee(r,a,c);if(o)return o}}return null},ne=l=>{var e,c;const a=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],t=((c=window==null?void 0:window.__activateNode)==null?void 0:c.value)||null;return Ee(a||[],l||t)},en=["draggable","onDragstart","onClick"],tn=A("div",{class:"line"},null,-1),nn={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(l,{emit:a}){const t=l,e=L({get:()=>t.modelValue,set:u=>a("update:modelValue",u)}),c=L({get:()=>t.nodeList,set:u=>a("update:nodeList",u)}),i=L(()=>(ge.find(u=>u.type===e.value.type)||Zt).component),r=j("hoverStack"),o=j("dragConf"),g=j("activateNode"),h=L(()=>r.value[0]),b=()=>r.value.unshift(e.value),k=()=>r.value.shift(),C=()=>{console.log("dragstart"),o.value.customDragData={node:e.value,curBranch:c.value,target:null};const u=[],n=(d,f)=>{var D;!f&&u.push(d),(D=d==null?void 0:d.branchList)!=null&&D.length&&d.branchList.forEach(T=>{u.push(T),T.forEach(V=>n(V))})};n(e.value,!0),o.value.dragFlag=!0,o.value.banDropNodeList=u},m=()=>{o.value.dragFlag=!1,o.value.banDropNodeList=[]},I=se(),N=()=>{o.value.customDragData&&(o.value.banDropNodeList.includes(e)||Le(o.value.customDragData.target)===I&&(a("moveTo",o.value.customDragData.node,o.value.customDragData.curBranch),o.value.customDragData=null,r.value=[]))},p=()=>{o.value.customDragData&&(o.value.customDragData.target=I)},_=()=>{o.value.customDragData&&(o.value.customDragData.target=null)},w=u=>{o.value.dragFlag&&!o.value.banDropNodeList.includes(e.value)&&u.preventDefault()},$=()=>{g.value=e.value};return(u,n)=>(v(),y(M,null,[A("div",{draggable:!["start","end"].includes(s(e).type),class:P(["node-box",{"hover-node":s(h)===s(e)||s(g)===s(e),"no-branch-box":!["if","switch"].includes(s(e).type)}]),onMouseenter:b,onMouseleave:k,onDragstart:W(C,["stop"]),onDragend:m,onClick:W($,["stop"])},[(v(),S(Q(s(i)),{modelValue:s(e),"onUpdate:modelValue":n[1]||(n[1]=d=>ce(e)?e.value=d:null)},{showName:F(()=>[z(q(s(e).nodeInfo.nodeName||s(e).type),1)]),default:F(()=>[R(Se,{onToSub:n[0]||(n[0]=d=>a("subNode"))})]),_:1},8,["modelValue"]))],42,en),s(e).type!=="end"?(v(),y(M,{key:0},[tn,R(he,{class:P({canDropFlag:s(o).dragFlag&&!s(o).banDropNodeList.includes(s(e))}),onToAdd:n[2]||(n[2]=d=>a("addNode",d)),onDragover:w,onDrop:N,onDragenter:p,onDragleave:_},null,8,["class"])],64)):E("",!0)],64))}};const an=l=>(We("data-v-435c42c5"),l=l(),Qe(),l),on=an(()=>A("div",{class:"line"},null,-1)),ln={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(l,{emit:a}){const t=l,e=re(),c=L({get:()=>t.modelValue,set:p=>a("update:modelValue",p)}),i=j("branchNameFlag"),r=j("dragConf"),o=j("hoverStack"),g=(p,_)=>{const w=_.generateNode();c.value.splice(p+1,0,w)},h=(p,_,w)=>{const $=_.findIndex(u=>u===p);if(_===c.value){if($===w+1||$===w)return;$>w?(_.splice($,1),_.splice(w+1,0,p)):(_.splice(w+1,0,p),_.splice($,1))}else _.splice($,1),c.value.splice(w+1,0,p)},b=p=>{c.value.splice(p,1)},k=se(),C=()=>{r.value.customDragData&&(r.value.banDropNodeList.includes(c)||Le(r.value.customDragData.target)===k&&(h(r.value.customDragData.node,r.value.customDragData.curBranch,-1),o.value=[],r.value.customDragData=null))},m=()=>{r.value.customDragData&&(r.value.customDragData.target=k)},I=()=>{r.value.customDragData&&(r.value.customDragData.target=null)},N=p=>{r.value.dragFlag&&!r.value.banDropNodeList.includes(c.value)&&p.preventDefault()};return(p,_)=>(v(),y("div",X({class:"render-list-wrapper"},s(e)),[l.startLine?(v(),y(M,{key:0},[l.branchCount>2?(v(),S(Se,{key:0,onClick:_[0]||(_[0]=w=>a("removeBranch"))})):E("",!0),s(i)?(v(),y("div",{key:1,class:P(["branch-name",{placeholder:!l.branchName}])},q(l.branchName||"未命名"),3)):E("",!0),on,R(he,{class:P({canDropFlag:s(r).dragFlag&&!s(r).banDropNodeList.includes(s(c))}),droppable:s(r).dragFlag&&!s(r).banDropNodeList.includes(s(c)),onToAdd:_[1]||(_[1]=w=>g(-1,w)),onDragover:N,onDrop:C,onDragenter:m,onDragleave:I},null,8,["class","droppable"])],64)):E("",!0),(v(!0),y(M,null,G(s(c),(w,$)=>(v(),S(nn,{key:w.id,modelValue:s(c)[$],"onUpdate:modelValue":u=>s(c)[$]=u,"node-list":s(c),"onUpdate:nodeList":_[2]||(_[2]=u=>ce(c)?c.value=u:null),onAddNode:u=>g($,u),onSubNode:()=>b($),onMoveTo:(u,n)=>h(u,n,$)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},Te=H(ln,[["__scopeId","data-v-435c42c5"]]);const sn={class:"select-node-wrapper"},rn={__name:"AddNodeDialog",setup(l,{expose:a}){const t=B({x:1,y:1}),e=B(!1);let c,i;const r=()=>{e.value=!1,c=null,i=null},o=(b,k,C)=>{if(i===C)return r();i=C,c=k,t.value=b,e.value=!0},g=b=>{c==null||c(b),r()},h=B(ge.filter(b=>!["start","end"].includes(b.type)));return a({show:o,close:r}),(b,k)=>me((v(),y("div",{class:"add-node-dialog",style:ee({"--var-dialog-left":`${t.value.x+15}px`,"--var-dialog-top":`${t.value.y+15}px`,"--var-dialog-size":e.value?"300px":"0"})},[A("div",sn,[(v(!0),y(M,null,G(h.value,C=>(v(),S(Q(C.component),{key:C.type,"is-preview":!0,onClick:()=>g(C)},null,8,["onClick"]))),128))])],4)),[[s(ke),r]])}},cn=H(rn,[["__scopeId","data-v-281649fe"]]);const un={__name:"Condition",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},attr:{type:Object,default:()=>({})}},emits:["change"],setup(l,{emit:a}){const t=l,e=B(t.modelValue.findIndex(o=>o.type)),c=t.attr.curActivateBranchIdx,i=(t.attr.curActivateBranchIdx+1)%2,r=o=>{t.modelValue[c].type=o===c,t.modelValue[i].type=o!==c,a("change",t.modelValue)};return(o,g)=>{const h=Be;return v(),y("div",null,[R(h,{modelValue:e.value,"onUpdate:modelValue":g[0]||(g[0]=b=>e.value=b),disabled:l.disabled,"active-value":s(c),"inactive-value":i,onChange:r},null,8,["modelValue","disabled","active-value"])])}}};const dn={class:"tab-pane-content"},vn={class:"module-name"},pn={__name:"NodeInfo",setup(l){const a=j("activateNode"),t=L(()=>Array.isArray(a.value)),e=B(null),c=B(null);ae(()=>a.value,m=>{if(t.value){const{parentNode:I,branchIdx:N}=ne(a.value);c.value=N,e.value=I}else c.value=null,e.value=a.value},{deep:!0,immediate:!0});const i=L({get:()=>{var m;return((m=e.value)==null?void 0:m.nodeInfo)||{}},set:m=>{e.value.nodeInfo=m}}),r=m=>{if(!m)return{};const{type:I}=m,N=(p,_,w,$,u={})=>p&&p!==I?!1:{label:_,field:w,type:$,...u};return{base:[{moduleName:"基本信息",attrs:[N(null,"节点类型","type","input",{disabled:!0}),N(null,"节点名称","nodeName","input"),N("if","判断条件","condition","input",{required:!0})].filter(Boolean)},{moduleName:"分支信息",attrs:[N("if","分支名称",`branchInfoList.${c.value}.branchName`,"input",{disabled:!1}),N("if","设为true分支","branchInfoList","custom",{component:Y(un),nodeInfo:i,curActivateBranchIdx:c.value}),N("switch","分支名称",`branchInfoList.${c.value}.branchName`,"input"),N("switch","判断条件",`branchInfoList.${c.value}.condition`,"input",{required:!0})].filter(Boolean).filter(p=>t.value)},{moduleName:"输入参数",attrs:[].filter(Boolean)},{moduleName:"输出参数",attrs:[].filter(Boolean)}].filter(p=>{var _;return(_=p==null?void 0:p.attrs)==null?void 0:_.length}),other:[].filter(p=>{var _;return(_=p==null?void 0:p.attrs)==null?void 0:_.length})}},o=L(()=>{const{base:m,other:I}=r(e.value);return[{label:"基础属性",modules:m},{label:"其他属性",modules:I}]}),g=B("基础属性"),h=L({get(){return m=>{const I=(m==null?void 0:m.split("."))||[];return I.reduce((N,p)=>(N==null?void 0:N[p])||void 0,I.length?i.value:void 0)}}}),b=m=>typeof m=="object"&&m!==null,k=(m,I)=>{const N=(I==null?void 0:I.split("."))||[];if(N.length)if(N.length===1)i.value[N[0]]=m;else{const p=N.pop();try{let _="nodeInfo";const w=N.reduce(($,u)=>(_+=`.${u}`,b($[u])||(console.warn(`${_}不是一个对象，已强制转化为对象`),$[u]={}),$[u]),N.length?i.value:void 0);w[p]=m}catch(_){console.error(`nodeInfo数据异常，无法读取${I}字段`),console.error(_)}}},C=m=>({disabled:m==null?void 0:m.disabled,modelValue:m.field&&h.value(m.field)||m.defaultValue,onInput:I=>k(I,m.field),onChange:I=>k(I,m.field)});return(m,I)=>{const N=rt,p=Be,_=lt,w=st,$=at,u=ot,n=tt,d=nt;return v(),S(d,{modelValue:g.value,"onUpdate:modelValue":I[0]||(I[0]=f=>g.value=f),stretch:!0},{default:F(()=>[(v(!0),y(M,null,G(s(o),f=>(v(),S(n,{key:f.label,label:f.label,name:f.label},{default:F(()=>[R(u,{model:s(i),"label-width":"100px"},{default:F(()=>[z(q(s(i))+" ",1),A("div",dn,[(v(!0),y(M,null,G(f.modules,(D,T)=>(v(),y("div",{key:T,class:"module-content"},[A("div",vn,q(D.moduleName),1),(v(!0),y(M,null,G(D.attrs,(V,U)=>(v(),y("div",{key:U},[R($,{label:V.label,rules:V.required&&[{required:!0,message:""}]},{default:F(()=>[V.type==="input"?(v(),S(N,we(X({key:0},C(V))),null,16)):V.type==="switch"?(v(),S(p,X({key:V},C(V),{"active-value":V.activeValue,"inactive-value":V.inactiveValue}),null,16,["active-value","inactive-value"])):V.type==="radio"?(v(),S(w,we(X({key:2},C(V))),{default:F(()=>[(v(!0),y(M,null,G(V.options,O=>(v(),S(_,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:2},1040)):V.type==="custom"?(v(),S(Q(V.component),X({key:3},C(V),{attr:V}),null,16,["attr"])):E("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},fn=H(pn,[["__scopeId","data-v-270d0857"]]);const mn={__name:"index",setup(l){const a="350px",t=j("activateNode"),e=B(null),c=B(!1);ae(()=>t.value,r=>{r&&(e.value=r,c.value=!0)});const i=()=>{c.value=!1,e.value=null};return(r,o)=>me((v(),y("div",{style:ee({"--var-width":a,"--var-right":c.value?0:`-${a}`,"--var-opacity":Number(c.value)}),class:"custom-drawer"},[e.value?(v(),S(fn,{key:0})):E("",!0)],4)),[[s(ke),i]])}},hn=H(mn,[["__scopeId","data-v-04587e00"]]);const _n={class:"left-top-wrapper"},gn={class:"canvas-node-container"},bn={__name:"Main",setup(l){const a=B([new x("start"),new x("feat"),new x("if",{branchList:[[new x("feat")]]}),new x("switch",{branchList:[[new x("feat")],[new x("feat")],[new x("feat")]]}),new x("end")]);window.__nodeList=a;const t=B(null);te("addNodeDialogRef",t);const e=B([]);te("hoverStack",e);const c=B({banDropNodeList:[],dragFlag:!1,customDragData:null});te("dragConf",c);const i=B(null);te("activateNode",i),window.__activateNode=i,Ze(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const r=B(null),o=()=>{var U;const n=i.value;if(!n||["start","end"].includes(n.type))return;const{parentNode:d,branchIdx:f,nodeList:D,nodeIdx:T}=ne(n);let V=null;if(Array.isArray(n)){if(((U=d.branchList)==null?void 0:U.length)<=Z)throw new Error(`分支数量至少为${Z},剪切失败！`);(d.branchList||[]).splice(f,1),V=d.nodeInfo.branchInfoList.splice(f,1)[0]}else D.splice(T,1);r.value={type:"shear",data:n,branchInfo:V}},g=()=>{const n=i.value;if(!n||["start","end"].includes(n.type))return;const{branchIdx:d,parentNode:f}=ne();r.value={type:"copy",data:n,branchInfo:d===null?null:JSON.parse(JSON.stringify(f.nodeInfo.branchInfoList[d]||{}))}},h=n=>{if(!r.value)return;const{type:d,data:f,branchInfo:D}=r.value;if(!f||["end"].includes(i.value.type))return;const T={copyNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:U,nodeIdx:O}=ne();U.splice(O+1,0,f.copySelf())},shearNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:U,nodeIdx:O}=ne();U.splice(O+1,0,f),r.value=null},copyBranch:()=>{var O;if(((O=i.value)==null?void 0:O.type)!=="switch")return;const U=i.value.branchList.push(f.map(Pe=>Pe.copySelf()));i.value.nodeInfo.branchInfoList[U-1]=D},shearBranch:()=>{var O;if(((O=i.value)==null?void 0:O.type)!=="switch")return;const U=i.value.branchList.push(f);i.value.nodeInfo.branchInfoList[U-1]=D,r.value=null}},V=d+(Array.isArray(f)?"Branch":"Node");T[V]()},b=B(!0),k=()=>{b.value=!b.value},C=B(!0),m=()=>{C.value=!C.value};te("branchNameFlag",C);const I=B(""),N=()=>{console.log("BaseNode.executeList(nodeList.value, [])",x.executeList(a.value,[]));const n=x.executeList(a.value,[]);I.value=n.context.code};let p=[0,0];const _=B([0,0]),w=B([0,0]),$=n=>{console.log("handleMouseDown"),p=[n.screenX,n.screenY];let d=null;document.onmousemove=function(f){console.log("onmousemove"),!d&&(d=setTimeout(()=>{w.value=[f.screenX-p[0],f.screenY-p[1]],d=null},1e3/80))}},u=()=>{const[n,d]=_.value,[f,D]=w.value;_.value=[n+f,d+D],w.value=[0,0],document.onmousemove=document.onmouseup=null};return Ce(()=>{document.addEventListener("mouseleave",n=>{u()})}),(n,d)=>{const f=Xe,D=et("mousetrap");return v(),y(M,null,[A("div",{id:"canvas-main",class:"canvas-main",style:ee({"--var-position-x":`${_.value[0]+w.value[0]}px`,"--var-position-y":`${_.value[1]+w.value[1]}px`}),onClickCapture:d[1]||(d[1]=T=>i.value=null),onMousedown:$,onMouseup:u},[A("div",_n,[R(f,{onClick:k},{default:F(()=>[z(" 快捷建："+q(b.value?"开启":"关闭"),1)]),_:1}),R(f,{onClick:m},{default:F(()=>[z(" 显示分支名："+q(C.value?"开启":"关闭"),1)]),_:1}),R(f,{onClick:N},{default:F(()=>[z(" 执行 ")]),_:1})]),A("div",gn,[R(Te,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=T=>a.value=T),"start-line":!1},null,8,["modelValue"])])],36),R(cn,{ref_key:"addNodeDialogRef",ref:t},null,512),R(s(hn)),b.value?me((v(),y("div",{key:0,"onMod+c":d[2]||(d[2]=()=>g()),"onMod+x":d[3]||(d[3]=()=>o()),"onMod+v":h},null,544)),[[D,["mod+c","mod+v","mod+x"]]]):E("",!0)],64)}}},yn=H(bn,[["__scopeId","data-v-4942f34a"]]),jn={__name:"index",setup(l){return(a,t)=>(v(),S(yn))}};export{jn as default};
