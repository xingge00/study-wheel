var ee=Object.defineProperty;var te=(o,t,n)=>t in o?ee(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var E=(o,t,n)=>(te(o,typeof t!="symbol"?t+"":t,n),n);import{_ as w,a2 as R,e as H,o as l,c as m,E as v,G as T,U as L,j as i,y as B,F as g,q as S,f as h,s as y,Y as P,z as X,R as D,am as oe,an as ne,ar as N,w as ae,b as x,v as q,x as se,g as re,a as le,r as k,P as de,A as z}from"./index-983981f3.js";import{C as ce}from"./index-9a728a22.js";import"./types-f79c9a47.js";const ue=["onClick"],ie={key:0,class:"line"},_e={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(o,{emit:t}){const n=o,e=R(),d=H("addNodeDialogRef"),u=a=>{if(a.id==="canvas-main"||!a)return{x:0,y:0};const r=u(a.offsetParent);return{x:r.x+a.offsetLeft,y:r.y+a.offsetTop}},c=a=>{t("toAdd",a)},s=a=>{if(n.addType==="branch")return t("toAdd");const{x:r,y:_}=u(a.target);d.value.show({x:a.offsetX+r,y:a.offsetY+_},c)};return(a,r)=>(l(),m(g,null,[v("div",T({class:"add-node"},i(e),{onClick:L(s,["stop"])})," + ",16,ue),o.endLine?(l(),m("div",ie)):B("",!0)],64))}},M=w(_e,[["__scopeId","data-v-4349605a"]]);const pe=["onClick"],me={__name:"SubBtn",emits:["toSub"],setup(o,{emit:t}){const n=e=>t("toSub");return(e,d)=>(l(),m("div",{class:"sub-node",onClick:L(n,["stop"])}," - ",8,pe))}},G=w(me,[["__scopeId","data-v-77d9fe80"]]),fe={},ve={class:"node-wrapper"},he=v("div",{class:"c-circle c-start"}," start ",-1),ge=[he];function ye(o,t){return l(),m("div",ve,ge)}const we=w(fe,[["render",ye]]),be={},Ve={class:"node-wrapper"},$e=v("div",{class:"c-circle c-end"}," end ",-1),Be=[$e];function Ne(o,t){return l(),m("div",Ve,Be)}const ke=w(be,[["render",Ne]]),Ce={},xe={class:"node-wrapper"},Ae=v("div",{class:"c-circle c-other"}," Error ",-1);function Le(o,t){return l(),m("div",xe,[S(o.$slots,"default"),Ae])}const I=w(Ce,[["render",Le]]),j=o=>{var t;return o?(t=o==null?void 0:o.branchList)!=null&&t.length?o.branchList.reduce((n,e)=>n+Math.max(...e.map(d=>j(d)),1),0):1:0},F=o=>Array.isArray(o)?Math.max(...o.map(t=>j(t)),1):1,Se=v("div",{class:"line"},null,-1),J={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(o,{emit:t}){const n=o,e=h({get:()=>n.modelValue||[],set:s=>t("update:modelValue",s)}),d=h(()=>j(n.curNode)),u=h(()=>{var s;return F((s=e.value)==null?void 0:s[0])}),c=h(()=>{var s;return F((s=e.value)==null?void 0:s[e.value.length-1])});return(s,a)=>(l(),m(g,null,[Se,o.curNode.type==="switch"?(l(),y(M,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:a[0]||(a[0]=r=>t("addBranch"))})):B("",!0),v("div",{class:"branch-wrapper branch-wrapper-width",style:X({"--var-col-count":i(d),"--var-first-branch-col-count":i(u),"--var-last-branch-col-count":i(c)})},[(l(!0),m(g,null,P(i(e),(r,_)=>(l(),y(K,{key:_,modelValue:i(e)[_],"onUpdate:modelValue":p=>i(e)[_]=p,"branch-count":i(e).length,onRemoveBranch:()=>t("removeBranch",_)},null,8,["modelValue","onUpdate:modelValue","branch-count","onRemoveBranch"]))),128))],4)],64))}},De=v("div",{class:"c-circle c-if"}," if ",-1),Ie={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=h({get:()=>n.modelValue.branchList,set:c=>t("update:modelValue",{...n.modelValue,branchList:c})}),d=R(),u=c=>{var s;return c?(s=c==null?void 0:c.branchList)!=null&&s.length?c.branchList.reduce((a,r)=>a+Math.max(...r.map(_=>u(_)),1),0):1:0};return h(()=>u(n.modelValue)),(c,s)=>(l(),m(g,null,[v("div",T({class:"node-wrapper"},i(d)),[S(c.$slots,"default"),De],16),o.isPreview?B("",!0):(l(),y(J,{key:0,modelValue:i(e),"onUpdate:modelValue":s[0]||(s[0]=a=>D(e)?e.value=a:null),"cur-node":o.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Re=o=>(oe("data-v-653f9187"),o=o(),ne(),o),Te=Re(()=>v("div",{class:"c-circle c-switch"}," switch ",-1)),Pe={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=h({get:()=>n.modelValue.branchList||[],set:s=>t("update:modelValue",{...n.modelValue,branchList:s})}),d=R(),u=()=>{e.value.push([])},c=s=>{e.value.splice(s,1)};return(s,a)=>(l(),m(g,null,[v("div",T({class:"node-wrapper"},i(d)),[S(s.$slots,"default",{},void 0,!0),Te],16),o.isPreview?B("",!0):(l(),y(J,{key:0,modelValue:i(e),"onUpdate:modelValue":a[0]||(a[0]=r=>D(e)?e.value=r:null),"cur-node":o.modelValue,onAddBranch:u,onRemoveBranch:c},null,8,["modelValue","cur-node"]))],64))}},Me=w(Pe,[["__scopeId","data-v-653f9187"]]),je={},Oe={class:"node-wrapper"},Ue=v("div",{class:"c-circle c-feat"}," Feat ",-1);function Ee(o,t){return l(),m("div",Oe,[S(o.$slots,"default"),Ue])}const ze=w(je,[["render",Ee]]),O=[{type:"start",component:N(we),generateNode:()=>new f("start")},{type:"end",component:N(ke),generateNode:()=>new f("end")},{type:"if",component:N(Ie),generateNode:()=>new f("if")},{type:"switch",component:N(Me),generateNode:(o=[[],[]])=>new f("switch",{branchList:o})},{type:"feat",component:N(ze),generateNode:()=>new f("feat")}],C=2,Y=(o,t=C)=>{const n=o==null?void 0:o.filter(Array.isArray);return n!=null&&n.length?t?n.length>=t?n.slice(0,t):n.slice().concat(new Array(t-n.length).fill(0).map(e=>[])):n.slice():new Array(t).fill(0).map(e=>[])},U=class{constructor(t,n={branchList:[]}){const{branchList:e}=n;if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++U.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:O.some(d=>d.type===t)?t:"error"}),t==="if"){let d=Y(e);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>d,set(u){if(u.length!==C)throw new I(`分支数量必须为${C}`);d=u}})}if(t==="switch"){let d=Y(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>d,set(u){if(u.length<C)throw new I(`分支数量至少为${C}`);d=u}})}}};let f=U;E(f,"id",0);const Fe={type:"error",component:N(I),generateNode:()=>new f("error")},Ye=["draggable","onDragstart"],He=v("div",{class:"line"},null,-1),Xe={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(o,{emit:t}){const n=o,e=h({get:()=>n.modelValue,set:V=>t("update:modelValue",V)}),d=h({get:()=>n.nodeList,set:V=>t("update:nodeList",V)}),u=h(()=>(O.find(V=>V.type===e.value.type)||Fe).component),c=H("hoverStack"),s=h(()=>c.value[0]),a=()=>c.value.unshift(e.value),r=()=>c.value.shift(),_=V=>{window.__custom_drop_data={node:e.value,curBranch:d.value,target:null},console.log(V),console.log("dragstart",window.__custom_drop_data)},p=()=>{console.log("ondragend")},b=re(),Q=()=>{window.__custom_drop_data.target===b&&(t("moveTo",window.__custom_drop_data.node,window.__custom_drop_data.curBranch),window.__custom_drop_data=null)},W=()=>{window.__custom_drop_data.target=b,console.log("dragenter",window.__custom_drop_data)},Z=()=>{window.__custom_drop_data.target=null,console.log("dragleave")};return(V,$)=>(l(),m(g,null,[v("div",{draggable:!["start","end"].includes(i(e).type),class:se(["node-box",{"hover-node":i(s)===i(e),"border-box":["if","switch"].includes(i(e).type)}]),onMouseenter:a,onMouseleave:r,onDragstart:L(_,["stop"]),onDragend:p},[(l(),y(q(i(u)),{modelValue:i(e),"onUpdate:modelValue":$[1]||($[1]=A=>D(e)?e.value=A:null)},{default:ae(()=>[x(G,{onToSub:$[0]||($[0]=A=>t("subNode"))})]),_:1},8,["modelValue"]))],42,Ye),i(e).type!=="end"?(l(),m(g,{key:0},[He,x(M,{droppable:!0,onToAdd:$[2]||($[2]=A=>t("addNode",A)),onDragover:$[3]||($[3]=L(()=>{},["prevent"])),onDrop:Q,onDragenter:W,onDragleave:Z})],64)):B("",!0)],64))}},qe={class:"render-list-wrapper"},Ge=v("div",{class:"line"},null,-1),K={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1}},emits:["update:modelValue","removeBranch"],setup(o,{emit:t}){const n=o,e=h({get:()=>n.modelValue,set:s=>t("update:modelValue",s)}),d=(s,a)=>{const r=a.generateNode();e.value.splice(s+1,0,r)},u=(s,a,r,_)=>{const p=a.findIndex(b=>b===s);if(s===e.value){const b=e.value[p];e.value[p]=e.value[r],e.value[r]=b}else a.splice(p,1),e.value.splice(r+1,0,s)},c=s=>{e.value.splice(s,1)};return(s,a)=>(l(),m("div",qe,[o.startLine?(l(),m(g,{key:0},[o.branchCount>2?(l(),y(G,{key:0,onClick:a[0]||(a[0]=r=>t("removeBranch"))})):B("",!0),Ge,le(" 未实现 "),x(M,{onToAdd:a[1]||(a[1]=r=>d(-1,r))})],64)):B("",!0),(l(!0),m(g,null,P(i(e),(r,_)=>(l(),y(Xe,{key:r.id,modelValue:i(e)[_],"onUpdate:modelValue":p=>i(e)[_]=p,"node-list":i(e),"onUpdate:nodeList":a[2]||(a[2]=p=>D(e)?e.value=p:null),onAddNode:p=>d(_,p),onSubNode:()=>c(_),onMoveTo:(p,b)=>u(p,b,_)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))]))}};const Je={class:"select-node-wrapper"},Ke={__name:"AddNodeDialog",setup(o,{expose:t}){const n=k({x:1,y:1}),e=k(!1);let d;const u=(r,_)=>{d=_,n.value=r,e.value=!0},c=()=>{e.value=!1},s=r=>{c(),d(r)},a=k(O.filter(r=>!["start","end"].includes(r.type)));return t({show:u,close:c}),(r,_)=>de((l(),m("div",{class:"add-node-dialog",style:X({"--var-dialog-left":`${n.value.x}px`,"--var-dialog-top":`${n.value.y}px`,"--var-dialog-size":e.value?"300px":"0"})},[v("div",Je,[(l(!0),m(g,null,P(a.value,p=>(l(),y(q(p.component),{key:p.type,"is-preview":!0,onClick:()=>s(p)},null,8,["onClick"]))),128))])],4)),[[i(ce),c]])}},Qe=w(Ke,[["__scopeId","data-v-97bc81a4"]]);const We={id:"canvas-main",class:"canvas-main"},Ze={__name:"Main",setup(o){const t=k([new f("start"),new f("feat"),new f("switch",{branchList:[[new f("feat")],[new f("feat")],[new f("feat")]]}),new f("end")]);console.log(t.value);const n=k(null);z("addNodeDialogRef",n);const e=k([]);return z("hoverStack",e),(d,u)=>(l(),m("div",We,[x(K,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=c=>t.value=c),"start-line":!1},null,8,["modelValue"]),x(Qe,{ref_key:"addNodeDialogRef",ref:n},null,512)]))}},et=w(Ze,[["__scopeId","data-v-d2c265a3"]]),st={__name:"index",setup(o){return(t,n)=>(l(),y(et))}};export{st as default};
