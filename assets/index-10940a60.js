var Fe=Object.defineProperty;var Oe=(n,a,t)=>a in n?Fe(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t;var be=(n,a,t)=>(Oe(n,typeof a!="symbol"?a+"":a,t),t);import{a as Re,d as Ue,l as ae,i as ue,c as je,_ as ze,w as He}from"./base-b58d5e1d.js";import{i as ye,a as Ke,b as qe,d as Je,c as Ge,E as We}from"./el-button-9ab0e275.js";import{l as ie,A as $e,v as C,r as A,d as ee,k as Xe,o as v,c as N,L as D,i as s,E as P,R as Ye,C as B,w as F,D as Y,G as E,V as O,b as R,H as te,S as W,j as oe,n as Qe,ar as Ne,_ as j,$ as le,t as U,M as q,F as M,B as z,a as T,U as G,a0 as se,as as J,a4 as Ce,am as Le,an as ke,Q as me,at as we,a2 as Ze,a8 as et,I as Z}from"./index-5b955112.js";import{C as Be}from"./index-4c8fdd17.js";import{E as tt,a as nt}from"./el-tab-pane-76728acd.js";import{E as at,a as ot}from"./el-form-item-1005b149.js";import{E as lt,a as st}from"./el-radio-button-d7cea533.js";import{E as rt}from"./el-input-6cdbe077.js";import{u as ct,f as ut,E as ne,l as it}from"./index-e981a558.js";import{i as dt}from"./validator-0541fb42.js";import{U as de,C as ve,I as pe,d as vt,t as pt}from"./event-e06a23af.js";import"./index-957c8a17.js";import"./get-e7313515.js";import"./index-f228ec5c.js";import"./typescript-defaf979.js";import"./strings-dcf7b3c3.js";import"./aria-60e0cdc6.js";import"./vnode-80f18118.js";import"./objects-bab3b41c.js";import"./isNil-c75b1b34.js";const ft=Re({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:ye},inactiveIcon:{type:ye},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:Ue(Function)},size:{type:String,validator:dt},tabindex:{type:[String,Number]}}),mt={[de]:n=>ae(n)||ie(n)||ue(n),[ve]:n=>ae(n)||ie(n)||ue(n),[pe]:n=>ae(n)||ie(n)||ue(n)},ht=["onClick"],_t=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],gt=["aria-hidden"],bt=["aria-hidden"],yt=["aria-hidden"],fe="ElSwitch",Nt=$e({name:fe}),wt=$e({...Nt,props:ft,emits:mt,setup(n,{expose:a,emit:t}){const e=n,u=oe(),{formItem:i}=Ke(),r=qe(),o=je("switch");ct({from:'"value"',replacement:'"model-value" or "v-model"',scope:fe,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},C(()=>{var l;return!!((l=u.vnode.props)!=null&&l.value)}));const{inputId:b}=Je(e,{formItemContext:i}),h=Ge(C(()=>e.loading)),y=A(e.modelValue!==!1),L=A(),$=A(),f=C(()=>[o.b(),o.m(r.value),o.is("disabled",h.value),o.is("checked",d.value)]),V=C(()=>({width:ut(e.width)}));ee(()=>e.modelValue,()=>{y.value=!0}),ee(()=>e.value,()=>{y.value=!1});const w=C(()=>y.value?e.modelValue:e.value),d=C(()=>w.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(w.value)||(t(de,e.inactiveValue),t(ve,e.inactiveValue),t(pe,e.inactiveValue)),ee(d,l=>{var m;L.value.checked=l,e.validateEvent&&((m=i==null?void 0:i.validate)==null||m.call(i,"change").catch(g=>vt()))});const p=()=>{const l=d.value?e.inactiveValue:e.activeValue;t(de,l),t(ve,l),t(pe,l),Qe(()=>{L.value.checked=d.value})},_=()=>{if(h.value)return;const{beforeChange:l}=e;if(!l){p();return}const m=l();[Ne(m),ae(m)].includes(!0)||pt(fe,"beforeChange must return type `Promise<boolean>` or `boolean`"),Ne(m)?m.then(S=>{S&&p()}).catch(S=>{}):m&&p()},I=C(()=>o.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),c=()=>{var l,m;(m=(l=L.value)==null?void 0:l.focus)==null||m.call(l)};return Xe(()=>{L.value.checked=d.value}),a({focus:c,checked:d}),(l,m)=>(v(),N("div",{class:P(s(f)),style:te(s(I)),onClick:W(_,["prevent"])},[D("input",{id:s(b),ref_key:"input",ref:L,class:P(s(o).e("input")),type:"checkbox",role:"switch","aria-checked":s(d),"aria-disabled":s(h),name:l.name,"true-value":l.activeValue,"false-value":l.inactiveValue,disabled:s(h),tabindex:l.tabindex,onChange:p,onKeydown:Ye(_,["enter"])},null,42,_t),!l.inlinePrompt&&(l.inactiveIcon||l.inactiveText)?(v(),N("span",{key:0,class:P([s(o).e("label"),s(o).em("label","left"),s(o).is("active",!s(d))])},[l.inactiveIcon?(v(),B(s(ne),{key:0},{default:F(()=>[(v(),B(Y(l.inactiveIcon)))]),_:1})):E("v-if",!0),!l.inactiveIcon&&l.inactiveText?(v(),N("span",{key:1,"aria-hidden":s(d)},O(l.inactiveText),9,gt)):E("v-if",!0)],2)):E("v-if",!0),D("span",{ref_key:"core",ref:$,class:P(s(o).e("core")),style:te(s(V))},[l.inlinePrompt?(v(),N("div",{key:0,class:P(s(o).e("inner"))},[l.activeIcon||l.inactiveIcon?(v(),B(s(ne),{key:0,class:P(s(o).is("icon"))},{default:F(()=>[(v(),B(Y(s(d)?l.activeIcon:l.inactiveIcon)))]),_:1},8,["class"])):l.activeText||l.inactiveText?(v(),N("span",{key:1,class:P(s(o).is("text")),"aria-hidden":!s(d)},O(s(d)?l.activeText:l.inactiveText),11,bt)):E("v-if",!0)],2)):E("v-if",!0),D("div",{class:P(s(o).e("action"))},[l.loading?(v(),B(s(ne),{key:0,class:P(s(o).is("loading"))},{default:F(()=>[R(s(it))]),_:1},8,["class"])):E("v-if",!0)],2)],6),!l.inlinePrompt&&(l.activeIcon||l.activeText)?(v(),N("span",{key:1,class:P([s(o).e("label"),s(o).em("label","right"),s(o).is("active",s(d))])},[l.activeIcon?(v(),B(s(ne),{key:0},{default:F(()=>[(v(),B(Y(l.activeIcon)))]),_:1})):E("v-if",!0),!l.activeIcon&&l.activeText?(v(),N("span",{key:1,"aria-hidden":!s(d)},O(l.activeText),9,yt)):E("v-if",!0)],2)):E("v-if",!0)],14,ht))}});var It=ze(wt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Se=He(It);const Vt=["onClick"],Dt={key:0,class:"line"},$t={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(n,{emit:a}){const t=n,e=le(),u=U("addNodeDialogRef"),i=h=>{if(h.id==="canvas-main"||!h)return{x:0,y:0};const y=i(h.offsetParent);return{x:y.x+h.offsetLeft,y:y.y+h.offsetTop}},r=h=>{a("toAdd",h)},o=oe(),b=h=>{if(t.addType==="branch")return a("toAdd");const{target:y,offsetY:L}=h,{x:$,y:f}=i(y);u.value.show({x:y.clientWidth+$,y:L+f},r,o)};return(h,y)=>(v(),N(M,null,[D("div",q({class:"add-node"},s(e),{onClick:W(b,["stop"])})," + ",16,Vt),n.endLine?(v(),N("div",Dt)):E("",!0)],64))}},he=j($t,[["__scopeId","data-v-77b265a2"]]);const Ct=["onClick"],Lt={__name:"SubBtn",emits:["toSub"],setup(n,{emit:a}){const t=U("hoverStack"),e=u=>{t.value=[],a("toSub")};return(u,i)=>(v(),N("div",{class:"sub-node",onClick:W(e,["stop"])}," - ",8,Ct))}},Ae=j(Lt,[["__scopeId","data-v-554bf87e"]]),kt={},Bt={class:"node-wrapper"},St={class:"c-circle c-start"};function At(n,a){return v(),N("div",Bt,[D("div",St,[z(n.$slots,"showName",{},()=>[T(" start ")])])])}const xt=j(kt,[["render",At]]),Et={},Tt={class:"node-wrapper"},Pt={class:"c-circle c-end"};function Mt(n,a){return v(),N("div",Tt,[D("div",Pt,[z(n.$slots,"showName",{},()=>[T(" end ")])])])}const Ft=j(Et,[["render",Mt]]),Ot={},Rt={class:"node-wrapper"},Ut={class:"c-circle c-other"};function jt(n,a){return v(),N("div",Rt,[z(n.$slots,"default"),D("div",Ut,[z(n.$slots,"showName",{},()=>[T(" error ")])])])}const xe=j(Ot,[["render",jt]]),_e=n=>{var a;return n?(a=n==null?void 0:n.branchList)!=null&&a.length?n.branchList.reduce((t,e)=>t+Math.max(...e.map(u=>_e(u)),1),0):1:0},Ie=n=>Array.isArray(n)?Math.max(...n.map(a=>_e(a)),1):1,zt=D("div",{class:"line"},null,-1),Ee={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(n,{emit:a}){const t=n,e=C({get:()=>t.modelValue||[],set:c=>a("update:modelValue",c)}),u=C(()=>{var c,l,m,g,S,H;return((c=t.curNode)==null?void 0:c.type)==="switch"?(((m=(l=t.curNode)==null?void 0:l.nodeInfo)==null?void 0:m.branchInfoList)||[]).map(k=>k==null?void 0:k.branchName):((g=t.curNode)==null?void 0:g.type)==="if"?(((H=(S=t.curNode)==null?void 0:S.nodeInfo)==null?void 0:H.branchInfoList)||[]).map(k=>k.branchName):[]}),i=C(()=>_e(t.curNode)),r=C(()=>{var c;return Ie((c=e.value)==null?void 0:c[0])}),o=C(()=>{var c;return Ie((c=e.value)==null?void 0:c[e.value.length-1])}),b=U("activateNode"),h=U("hoverStack"),y=C(()=>h.value[0]),L=c=>h.value.unshift(e.value[c]),$=c=>h.value.shift(),f=A(null),V=c=>{f.value=c,e.value[c]},w=()=>{f.value=null},d=c=>{f.value!==null&&c.preventDefault()},p=(c,l,m)=>{let g=Math.min(l,m),S=Math.max(l,m);const H=c[l];for(;g<S;)l<m?c[g]=c[++g]:c[S]=c[--S],g===S&&(c[g]=H)},_=c=>{var l,m;f.value===c||f.value===null||(p(e.value||[],f.value,c),p(((m=(l=t.curNode)==null?void 0:l.nodeInfo)==null?void 0:m.branchInfoList)||[],f.value,c),f.value=null)},I=c=>{b.value=e.value[c]};return(c,l)=>(v(),N(M,null,[zt,["switch"].includes(n.curNode.type)?(v(),B(he,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:l[0]||(l[0]=m=>a("addBranch"))})):E("",!0),D("div",{class:"branch-wrapper branch-wrapper-width",style:te({"--var-col-count":s(i),"--var-first-branch-col-count":s(r),"--var-last-branch-col-count":s(o)})},[(v(!0),N(M,null,G(s(e),(m,g)=>(v(),B(Pe,{key:g,modelValue:s(e)[g],"onUpdate:modelValue":S=>s(e)[g]=S,class:P({"hover-branch":s(y)===s(e)[g]||s(b)===s(e)[g],"can-drop-branch":f.value!==null&&f.value!==g}),"branch-count":s(e).length,"branch-name":s(u)[g],draggable:!0,onMouseenter:()=>L(g),onMouseleave:()=>$(),onRemoveBranch:()=>a("removeBranch",g),onDragstart:W(()=>V(g),["stop"]),onDragover:l[1]||(l[1]=S=>d(S)),onDropCapture:()=>_(g),onDragend:w,onClick:W(()=>I(g),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},Ht={class:"c-circle c-if"},Kt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:a}){const t=n,e=C({get:()=>t.modelValue.branchList,set:r=>a("update:modelValue",{...t.modelValue,branchList:r})}),u=le(),i=r=>{var o;return r?(o=r==null?void 0:r.branchList)!=null&&o.length?r.branchList.reduce((b,h)=>b+Math.max(...h.map(y=>i(y)),1),0):1:0};return C(()=>i(t.modelValue)),(r,o)=>(v(),N(M,null,[D("div",q({class:"node-wrapper"},s(u)),[z(r.$slots,"default"),D("div",Ht,[z(r.$slots,"showName",{},()=>[T(" if ")])])],16),n.isPreview?E("",!0):(v(),B(Ee,{key:0,modelValue:s(e),"onUpdate:modelValue":o[0]||(o[0]=b=>se(e)?e.value=b:null),"cur-node":n.modelValue},null,8,["modelValue","cur-node"]))],64))}};const qt={class:"c-circle c-switch"},Jt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:a}){const t=n,e=C({get:()=>t.modelValue.branchList||[],set:o=>a("update:modelValue",{...t.modelValue,branchList:o})}),u=le(),i=()=>{const o=e.value.push([]);t.modelValue.nodeInfo.branchInfoList[o]={}},r=o=>{e.value.splice(o,1),t.modelValue.nodeInfo.branchInfoList.splice(o,1)};return(o,b)=>(v(),N(M,null,[D("div",q({class:"node-wrapper"},s(u)),[z(o.$slots,"default",{},void 0,!0),D("div",qt,[z(o.$slots,"showName",{},()=>[T(" switch ")],!0)])],16),n.isPreview?E("",!0):(v(),B(Ee,{key:0,modelValue:s(e),"onUpdate:modelValue":b[0]||(b[0]=h=>se(e)?e.value=h:null),"cur-node":n.modelValue,onAddBranch:i,onRemoveBranch:r},null,8,["modelValue","cur-node"]))],64))}},Gt=j(Jt,[["__scopeId","data-v-c8b2d440"]]),Wt={class:"node-wrapper"},Xt={class:"c-circle c-feat"},Yt={__name:"Feat",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(n){return(a,t)=>(v(),N("div",Wt,[z(a.$slots,"default"),D("div",Xt,[z(a.$slots,"showName",{},()=>[T(" Feat ")])])]))}},ge=[{type:"start",component:J(xt),generateNode:()=>new x("start")},{type:"end",component:J(Ft),generateNode:()=>new x("end")},{type:"if",component:J(Kt),generateNode:()=>new x("if")},{type:"switch",component:J(Gt),generateNode:(n=[[],[]])=>new x("switch",{branchList:n})},{type:"feat",component:J(Yt),generateNode:()=>new x("feat")}],Q=2,Ve=(n,a=Q)=>{const t=n==null?void 0:n.filter(Array.isArray);return t!=null&&t.length?a?t.length>=a?t.slice(0,a):t.slice().concat(new Array(a-t.length).fill(0).map(e=>[])):t.slice():new Array(a).fill(0).map(e=>[])},De=()=>({code:""}),Qt=({type:n,branchList:a})=>{const e={if:{condition:"",branchInfoList:[{branchName:"分支1",type:!0},{branchName:"分支2",type:!1}]},switch:{branchInfoList:(a||[]).map((u,i)=>({branchName:`分支${i}`,condition:""}))}}[n]||{};return e.type=n,e.nodeName=n,e},K=class{constructor(a,t){const{branchList:e=[],nodeInfo:u={}}=t||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++K.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:ge.some(o=>o.type===a)?a:"error"}),a==="if"){const o=Ve(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(o,{get(b,h,y){return Reflect.get(b,h,y)},set(b,h,y,L){return["0","1"].includes(h)?Reflect.set(b,h,y,L):(console.error(`分支数量必须为${Q}`),!1)}})}})}if(a==="switch"){let o=Ve(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>o,set(b){if(b.length<Q)throw new xe(`分支数量至少为${Q}`);o=b}})}const i=Qt(this);Object.assign(i,u);const r=new Proxy(i,{get(o,b,h){return Reflect.get(o,b,h)},set(o,b,h,y){return console.log("修改了",o,"的",b,"为",h),Reflect.set(o,b,h,y)}});this.nodeInfo=r}static copyBranchList(a){return(a==null?void 0:a.map(t=>(t==null?void 0:t.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new K(this.type,{branchList:K.copyBranchList(this.branchList),nodeInfo:JSON.parse(JSON.stringify(this.nodeInfo))})}static executeNode(a,t=[],e){e||(e=De());const{type:u,branchList:i}=a;let r;u==="if"&&(r=K.executeList(i[0],t)),u==="switch"&&(r=K.executeList(i[0],t));const o={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${r.context.code}
        }
      `,switch:()=>`switch(){
        ${r.context.code}
      }
      `};return e.code+=o[u](),{result:t,context:e}}static executeList(a,t=[]){const e=De();return{result:a.reduce((i,r)=>K.executeNode(r,i,e).result,t),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((a,t)=>{let e=`${a},${t}:`;return Array.isArray(this[t])?e+=`[${this[t].toString()}]`:typeof this[t]=="number"?e+=`${this[t].toString()}`:typeof this[t]=="string"?e+=`"${this[t].toString()}"`:e+=`{${this[t].toString()}}`,e},"").slice(1)}}`}};let x=K;be(x,"id",0);const Zt={type:"error",component:J(xe),generateNode:()=>new x("error")},Te=(n,a,t=null)=>{for(let e in n){e=e-0;const u=n[e];if(u===a)return{nodeList:n,parentNode:t,nodeIdx:e,branchIdx:null};for(let i in u.branchList||[]){i=i-0;const r=u.branchList[i];if(r===a)return{nodeList:r,parentNode:u,branchIdx:i,nodeIdx:null};const o=Te(r,a,u);if(o)return o}}return null},X=n=>{var e,u;const a=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],t=((u=window==null?void 0:window.__activateNode)==null?void 0:u.value)||null;return Te(a||[],n||t)},en=["draggable","onDragstart","onClick"],tn=D("div",{class:"line"},null,-1),nn={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(n,{emit:a}){const t=n,e=C({get:()=>t.modelValue,set:c=>a("update:modelValue",c)}),u=C({get:()=>t.nodeList,set:c=>a("update:nodeList",c)}),i=C(()=>(ge.find(c=>c.type===e.value.type)||Zt).component),r=U("hoverStack"),o=U("dragConf"),b=U("activateNode"),h=C(()=>r.value[0]),y=()=>r.value.unshift(e.value),L=()=>r.value.shift(),$=()=>{o.value.customDragData={node:e.value,curBranch:u.value,target:null};const c=[],l=(m,g)=>{var S;!g&&c.push(m),(S=m==null?void 0:m.branchList)!=null&&S.length&&m.branchList.forEach(H=>{c.push(H),H.forEach(k=>l(k))})};l(e.value,!0),o.value.dragFlag=!0,o.value.banDropNodeList=c},f=()=>{o.value.dragFlag=!1,o.value.banDropNodeList=[]},V=oe(),w=()=>{o.value.customDragData&&(o.value.banDropNodeList.includes(e)||Ce(o.value.customDragData.target)===V&&(a("moveTo",o.value.customDragData.node,o.value.customDragData.curBranch),o.value.customDragData=null,r.value=[]))},d=()=>{o.value.customDragData&&(o.value.customDragData.target=V)},p=()=>{o.value.customDragData&&(o.value.customDragData.target=null)},_=c=>{o.value.dragFlag&&!o.value.banDropNodeList.includes(e.value)&&c.preventDefault()},I=()=>{b.value=e.value};return(c,l)=>(v(),N(M,null,[D("div",{draggable:!["start","end"].includes(s(e).type),class:P(["node-box",{"hover-node":s(h)===s(e)||s(b)===s(e),"no-branch-box":!["if","switch"].includes(s(e).type)}]),onMouseenter:y,onMouseleave:L,onDragstart:W($,["stop"]),onDragend:f,onClick:W(I,["stop"])},[(v(),B(Y(s(i)),{modelValue:s(e),"onUpdate:modelValue":l[1]||(l[1]=m=>se(e)?e.value=m:null)},{showName:F(()=>[T(O(s(e).nodeInfo.nodeName||s(e).type),1)]),default:F(()=>[R(Ae,{onToSub:l[0]||(l[0]=m=>a("subNode"))})]),_:1},8,["modelValue"]))],42,en),s(e).type!=="end"?(v(),N(M,{key:0},[tn,R(he,{class:P({canDropFlag:s(o).dragFlag&&!s(o).banDropNodeList.includes(s(e))}),onToAdd:l[2]||(l[2]=m=>a("addNode",m)),onDragover:_,onDrop:w,onDragenter:d,onDragleave:p},null,8,["class"])],64)):E("",!0)],64))}};const an=n=>(Le("data-v-435c42c5"),n=n(),ke(),n),on=an(()=>D("div",{class:"line"},null,-1)),ln={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(n,{emit:a}){const t=n,e=le(),u=C({get:()=>t.modelValue,set:d=>a("update:modelValue",d)}),i=U("branchNameFlag"),r=U("dragConf"),o=U("hoverStack"),b=(d,p)=>{const _=p.generateNode();u.value.splice(d+1,0,_)},h=(d,p,_)=>{const I=p.findIndex(c=>c===d);if(p===u.value){if(I===_+1||I===_)return;I>_?(p.splice(I,1),p.splice(_+1,0,d)):(p.splice(_+1,0,d),p.splice(I,1))}else p.splice(I,1),u.value.splice(_+1,0,d)},y=d=>{u.value.splice(d,1)},L=oe(),$=()=>{r.value.customDragData&&(r.value.banDropNodeList.includes(u)||Ce(r.value.customDragData.target)===L&&(h(r.value.customDragData.node,r.value.customDragData.curBranch,-1),o.value=[],r.value.customDragData=null))},f=()=>{r.value.customDragData&&(r.value.customDragData.target=L)},V=()=>{r.value.customDragData&&(r.value.customDragData.target=null)},w=d=>{r.value.dragFlag&&!r.value.banDropNodeList.includes(u.value)&&d.preventDefault()};return(d,p)=>(v(),N("div",q({class:"render-list-wrapper"},s(e)),[n.startLine?(v(),N(M,{key:0},[n.branchCount>2?(v(),B(Ae,{key:0,onClick:p[0]||(p[0]=_=>a("removeBranch"))})):E("",!0),s(i)?(v(),N("div",{key:1,class:P(["branch-name",{placeholder:!n.branchName}])},O(n.branchName||"未命名"),3)):E("",!0),on,R(he,{class:P({canDropFlag:s(r).dragFlag&&!s(r).banDropNodeList.includes(s(u))}),droppable:s(r).dragFlag&&!s(r).banDropNodeList.includes(s(u)),onToAdd:p[1]||(p[1]=_=>b(-1,_)),onDragover:w,onDrop:$,onDragenter:f,onDragleave:V},null,8,["class","droppable"])],64)):E("",!0),(v(!0),N(M,null,G(s(u),(_,I)=>(v(),B(nn,{key:_.id,modelValue:s(u)[I],"onUpdate:modelValue":c=>s(u)[I]=c,"node-list":s(u),"onUpdate:nodeList":p[2]||(p[2]=c=>se(u)?u.value=c:null),onAddNode:c=>b(I,c),onSubNode:()=>y(I),onMoveTo:(c,l)=>h(c,l,I)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},Pe=j(ln,[["__scopeId","data-v-435c42c5"]]);const sn={class:"select-node-wrapper"},rn={__name:"AddNodeDialog",setup(n,{expose:a}){const t=A({x:1,y:1}),e=A(!1);let u,i;const r=()=>{e.value=!1,u=null,i=null},o=(y,L,$)=>{if(i===$)return r();i=$,u=L,t.value=y,e.value=!0},b=y=>{u==null||u(y),r()},h=A(ge.filter(y=>!["start","end"].includes(y.type)));return a({show:o,close:r}),(y,L)=>me((v(),N("div",{class:"add-node-dialog",style:te({"--var-dialog-left":`${t.value.x}px`,"--var-dialog-top":`${t.value.y}px`,"--var-dialog-size":e.value?"300px":"0"})},[D("div",sn,[(v(!0),N(M,null,G(h.value,$=>(v(),B(Y($.component),{key:$.type,"is-preview":!0,onClick:()=>b($)},null,8,["onClick"]))),128))])],4)),[[s(Be),r]])}},cn=j(rn,[["__scopeId","data-v-7f77c4dd"]]);const un={__name:"Condition",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},attr:{type:Object,default:()=>({})}},emits:["change"],setup(n,{emit:a}){const t=n,e=A(t.modelValue.findIndex(o=>o.type)),u=t.attr.curActivateBranchIdx,i=(t.attr.curActivateBranchIdx+1)%2,r=o=>{t.modelValue[u].type=o===u,t.modelValue[i].type=o!==u,a("change",t.modelValue)};return(o,b)=>{const h=Se;return v(),N("div",null,[R(h,{modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=y=>e.value=y),disabled:n.disabled,"active-value":s(u),"inactive-value":i,onChange:r},null,8,["modelValue","disabled","active-value"])])}}};const dn={class:"tab-pane-content"},vn={class:"module-name"},pn={__name:"NodeInfo",setup(n){const a=U("activateNode"),t=C(()=>Array.isArray(a.value)),e=A(null),u=A(null);ee(()=>a.value,f=>{if(t.value){const{parentNode:V,branchIdx:w}=X(a.value);u.value=w,e.value=V}else u.value=null,e.value=a.value},{deep:!0,immediate:!0});const i=C({get:()=>{var f;return((f=e.value)==null?void 0:f.nodeInfo)||{}},set:f=>{e.value.nodeInfo=f}}),r=f=>{if(!f)return{};const{type:V}=f,w=(d,p,_,I,c={})=>d&&d!==V?!1:{label:p,field:_,type:I,...c};return{base:[{moduleName:"基本信息",attrs:[w(null,"节点类型","type","input",{disabled:!0}),w(null,"节点名称","nodeName","input"),w("if","判断条件","condition","input",{required:!0})].filter(Boolean)},{moduleName:"分支信息",attrs:[w("if","分支名称",`branchInfoList.${u.value}.branchName`,"input",{disabled:!1}),w("if","设为true分支","branchInfoList","custom",{component:J(un),nodeInfo:i,curActivateBranchIdx:u.value}),w("switch","分支名称",`branchInfoList.${u.value}.branchName`,"input"),w("switch","判断条件",`branchInfoList.${u.value}.condition`,"input",{required:!0})].filter(Boolean).filter(d=>t.value)},{moduleName:"输入参数",attrs:[].filter(Boolean)},{moduleName:"输出参数",attrs:[].filter(Boolean)}].filter(d=>{var p;return(p=d==null?void 0:d.attrs)==null?void 0:p.length}),other:[].filter(d=>{var p;return(p=d==null?void 0:d.attrs)==null?void 0:p.length})}},o=C(()=>{const{base:f,other:V}=r(e.value);return[{label:"基础属性",modules:f},{label:"其他属性",modules:V}]}),b=A("基础属性"),h=C({get(){return f=>{const V=(f==null?void 0:f.split("."))||[];return V.reduce((w,d)=>(w==null?void 0:w[d])||void 0,V.length?i.value:void 0)}}}),y=f=>typeof f=="object"&&f!==null,L=(f,V)=>{const w=(V==null?void 0:V.split("."))||[];if(w.length)if(w.length===1)i.value[w[0]]=f;else{const d=w.pop();try{let p="nodeInfo";const _=w.reduce((I,c)=>(p+=`.${c}`,y(I[c])||(console.warn(`${p}不是一个对象，已强制转化为对象`),I[c]={}),I[c]),w.length?i.value:void 0);_[d]=f}catch(p){console.error(`nodeInfo数据异常，无法读取${V}字段`),console.error(p)}}},$=f=>({disabled:f==null?void 0:f.disabled,modelValue:f.field&&h.value(f.field)||f.defaultValue,onInput:V=>L(V,f.field),onChange:V=>L(V,f.field)});return(f,V)=>{const w=rt,d=Se,p=lt,_=st,I=at,c=ot,l=tt,m=nt;return v(),B(m,{modelValue:b.value,"onUpdate:modelValue":V[0]||(V[0]=g=>b.value=g),stretch:!0},{default:F(()=>[(v(!0),N(M,null,G(s(o),g=>(v(),B(l,{key:g.label,label:g.label,name:g.label},{default:F(()=>[R(c,{model:s(i),"label-width":"100px"},{default:F(()=>[T(O(s(i))+" ",1),D("div",dn,[(v(!0),N(M,null,G(g.modules,(S,H)=>(v(),N("div",{key:H,class:"module-content"},[D("div",vn,O(S.moduleName),1),(v(!0),N(M,null,G(S.attrs,(k,Me)=>(v(),N("div",{key:Me},[R(I,{label:k.label,rules:k.required&&[{required:!0,message:""}]},{default:F(()=>[k.type==="input"?(v(),B(w,we(q({key:0},$(k))),null,16)):k.type==="switch"?(v(),B(d,q({key:k},$(k),{"active-value":k.activeValue,"inactive-value":k.inactiveValue}),null,16,["active-value","inactive-value"])):k.type==="radio"?(v(),B(_,we(q({key:2},$(k))),{default:F(()=>[(v(!0),N(M,null,G(k.options,ce=>(v(),B(p,{key:ce.value,label:ce.label,value:ce.value},null,8,["label","value"]))),128))]),_:2},1040)):k.type==="custom"?(v(),B(Y(k.component),q({key:3},$(k),{attr:k}),null,16,["attr"])):E("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},fn=j(pn,[["__scopeId","data-v-270d0857"]]);const mn={__name:"index",setup(n){const a="350px",t=U("activateNode"),e=A(null),u=A(!1);ee(()=>t.value,r=>{r&&(e.value=r,u.value=!0)});const i=()=>{u.value=!1,e.value=null};return(r,o)=>me((v(),N("div",{style:te({"--var-width":a,"--var-right":u.value?0:`-${a}`,"--var-opacity":Number(u.value)}),class:"custom-drawer"},[e.value?(v(),B(fn,{key:0})):E("",!0)],4)),[[s(Be),i]])}},hn=j(mn,[["__scopeId","data-v-04587e00"]]);const re=n=>(Le("data-v-16facda4"),n=n(),ke(),n),_n={style:{display:"inline-block","vertical-align":"top"}},gn=re(()=>D("br",null,null,-1)),bn=re(()=>D("br",null,null,-1)),yn=re(()=>D("br",null,null,-1)),Nn=re(()=>D("br",null,null,-1)),wn={__name:"Main",setup(n){const a=A([new x("start"),new x("feat"),new x("if",{branchList:[[new x("feat")]]}),new x("switch",{branchList:[[new x("feat")],[new x("feat")],[new x("feat")]]}),new x("end")]);window.__nodeList=a;const t=A(null);Z("addNodeDialogRef",t);const e=A([]);Z("hoverStack",e);const u=A({banDropNodeList:[],dragFlag:!1,customDragData:null});Z("dragConf",u);const i=A(null);Z("activateNode",i),window.__activateNode=i,Ze(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const r=A(null),o=()=>{var m;const d=i.value;if(!d||["start","end"].includes(d.type))return;const{parentNode:p,branchIdx:_,nodeList:I,nodeIdx:c}=X(d);let l=null;if(Array.isArray(d)){if(((m=p.branchList)==null?void 0:m.length)<=Q)throw new Error(`分支数量至少为${Q},剪切失败！`);(p.branchList||[]).splice(_,1),l=p.nodeInfo.branchInfoList.splice(_,1)[0]}else I.splice(c,1);r.value={type:"shear",data:d,branchInfo:l}},b=()=>{const d=i.value;if(!d||["start","end"].includes(d.type))return;const{branchIdx:p,parentNode:_}=X();r.value={type:"copy",data:d,branchInfo:p===null?null:JSON.parse(JSON.stringify(_.nodeInfo.branchInfoList[p]||{}))}},h=d=>{if(!r.value)return;const{type:p,data:_,branchInfo:I}=r.value;if(!_||["end"].includes(i.value.type))return;const c={copyNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:m,nodeIdx:g}=X();m.splice(g+1,0,_.copySelf())},shearNode:()=>{if(!i.value||Array.isArray(i.value))return;const{nodeList:m,nodeIdx:g}=X();m.splice(g+1,0,_),r.value=null},copyBranch:()=>{var g;if(((g=i.value)==null?void 0:g.type)!=="switch")return;const m=i.value.branchList.push(_.map(S=>S.copySelf()));i.value.nodeInfo.branchInfoList[m-1]=I},shearBranch:()=>{var g;if(((g=i.value)==null?void 0:g.type)!=="switch")return;const m=i.value.branchList.push(_);i.value.nodeInfo.branchInfoList[m-1]=I,r.value=null}},l=p+(Array.isArray(_)?"Branch":"Node");c[l]()},y=A(!0),L=()=>{y.value=!y.value},$=A(!0),f=()=>{$.value=!$.value};Z("branchNameFlag",$);const V=A(""),w=()=>{console.log("BaseNode.executeList(nodeList.value, [])",x.executeList(a.value,[]));const d=x.executeList(a.value,[]);V.value=d.context.code};return(d,p)=>{var c;const _=We,I=et("mousetrap");return v(),N(M,null,[D("div",{id:"canvas-main",class:"canvas-main",onClickCapture:p[1]||(p[1]=l=>i.value=null)},[D("div",null,[R(_,{onClick:L},{default:F(()=>[T(" 快捷建："+O(y.value?"开启":"关闭"),1)]),_:1}),R(_,{onClick:f},{default:F(()=>[T(" 显示分支名："+O($.value?"开启":"关闭"),1)]),_:1}),R(_,{onClick:w},{default:F(()=>[T(" 执行 ")]),_:1})]),R(Pe,{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=l=>a.value=l),"start-line":!1},null,8,["modelValue"]),D("div",_n,[T(" shearPlate: "+O(r.value)+" ",1),gn,T(" ParentNode: "+O(((c=s(X)())==null?void 0:c.parentNode)||"null")+" ",1),bn,T(" activateNode: "+O(i.value)+" ",1),yn,D("pre",null,[T("      code"),Nn,T(`
      `+O(V.value)+`
    `,1)])])],32),R(cn,{ref_key:"addNodeDialogRef",ref:t},null,512),R(s(hn)),y.value?me((v(),N("div",{key:0,"onMod+c":p[2]||(p[2]=()=>b()),"onMod+x":p[3]||(p[3]=()=>o()),"onMod+v":h},null,544)),[[I,["mod+c","mod+v","mod+x"]]]):E("",!0)],64)}}},In=j(wn,[["__scopeId","data-v-16facda4"]]),Kn={__name:"index",setup(n){return(a,t)=>(v(),B(In))}};export{Kn as default};
