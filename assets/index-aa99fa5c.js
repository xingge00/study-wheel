var Z=Object.defineProperty;var ee=(t,e,o)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var T=(t,e,o)=>(ee(t,typeof e!="symbol"?e+"":e,o),o);import{_ as w,a2 as R,e as Y,o as l,c as p,E as m,G as I,U as A,j as i,y as V,F as g,q as L,f as v,s as y,Y as P,z as H,R as S,am as te,an as ne,ar as N,w as oe,b as C,v as X,x as ae,g as se,r as B,P as re,A as E}from"./index-475c69c6.js";import{C as le}from"./index-13ba8354.js";import"./types-47f56961.js";const de=["onClick"],ce={key:0,class:"line"},ue={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(t,{emit:e}){const o=t,n=R(),d=Y("addNodeDialogRef"),c=s=>{if(s.id==="canvas-main"||!s)return{x:0,y:0};const u=c(s.offsetParent);return{x:u.x+s.offsetLeft,y:u.y+s.offsetTop}},r=s=>{e("toAdd",s)},a=s=>{if(o.addType==="branch")return e("toAdd");const{x:u,y:_}=c(s.target);d.value.show({x:s.offsetX+u,y:s.offsetY+_},r)};return(s,u)=>(l(),p(g,null,[m("div",I({class:"add-node"},i(n),{onClick:A(a,["stop"])})," + ",16,de),t.endLine?(l(),p("div",ce)):V("",!0)],64))}},j=w(ue,[["__scopeId","data-v-4349605a"]]);const ie=["onClick"],_e={__name:"SubBtn",emits:["toSub"],setup(t,{emit:e}){const o=n=>e("toSub");return(n,d)=>(l(),p("div",{class:"sub-node",onClick:A(o,["stop"])}," - ",8,ie))}},q=w(_e,[["__scopeId","data-v-77d9fe80"]]),pe={},fe={class:"node-wrapper"},me=m("div",{class:"c-circle c-start"}," start ",-1),ve=[me];function he(t,e){return l(),p("div",fe,ve)}const ge=w(pe,[["render",he]]),ye={},we={class:"node-wrapper"},be=m("div",{class:"c-circle c-end"}," end ",-1),Ve=[be];function $e(t,e){return l(),p("div",we,Ve)}const Ne=w(ye,[["render",$e]]),Be={},ke={class:"node-wrapper"},Ce=m("div",{class:"c-circle c-other"}," Error ",-1);function xe(t,e){return l(),p("div",ke,[L(t.$slots,"default"),Ce])}const D=w(Be,[["render",xe]]),O=t=>{var e;return t?(e=t==null?void 0:t.branchList)!=null&&e.length?t.branchList.reduce((o,n)=>o+Math.max(...n.map(d=>O(d)),1),0):1:0},z=t=>Array.isArray(t)?Math.max(...t.map(e=>O(e)),1):1,Ae=m("div",{class:"line"},null,-1),G={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(t,{emit:e}){const o=t,n=v({get:()=>o.modelValue||[],set:a=>e("update:modelValue",a)}),d=v(()=>O(o.curNode)),c=v(()=>{var a;return z((a=n.value)==null?void 0:a[0])}),r=v(()=>{var a;return z((a=n.value)==null?void 0:a[n.value.length-1])});return(a,s)=>(l(),p(g,null,[Ae,t.curNode.type==="switch"?(l(),y(j,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:s[0]||(s[0]=u=>e("addBranch"))})):V("",!0),m("div",{class:"branch-wrapper branch-wrapper-width",style:H({"--var-col-count":i(d),"--var-first-branch-col-count":i(c),"--var-last-branch-col-count":i(r)})},[(l(!0),p(g,null,P(i(n),(u,_)=>(l(),y(J,{key:_,modelValue:i(n)[_],"onUpdate:modelValue":b=>i(n)[_]=b,"branch-count":i(n).length,onRemoveBranch:()=>e("removeBranch",_)},null,8,["modelValue","onUpdate:modelValue","branch-count","onRemoveBranch"]))),128))],4)],64))}},Le=m("div",{class:"c-circle c-if"}," if ",-1),Se={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const o=t,n=v({get:()=>o.modelValue.branchList,set:r=>e("update:modelValue",{...o.modelValue,branchList:r})}),d=R(),c=r=>{var a;return r?(a=r==null?void 0:r.branchList)!=null&&a.length?r.branchList.reduce((s,u)=>s+Math.max(...u.map(_=>c(_)),1),0):1:0};return v(()=>c(o.modelValue)),(r,a)=>(l(),p(g,null,[m("div",I({class:"node-wrapper"},i(d)),[L(r.$slots,"default"),Le],16),t.isPreview?V("",!0):(l(),y(G,{key:0,modelValue:i(n),"onUpdate:modelValue":a[0]||(a[0]=s=>S(n)?n.value=s:null),"cur-node":t.modelValue},null,8,["modelValue","cur-node"]))],64))}};const De=t=>(te("data-v-653f9187"),t=t(),ne(),t),Re=De(()=>m("div",{class:"c-circle c-switch"}," switch ",-1)),Ie={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const o=t,n=v({get:()=>o.modelValue.branchList||[],set:a=>e("update:modelValue",{...o.modelValue,branchList:a})}),d=R(),c=()=>{n.value.push([])},r=a=>{n.value.splice(a,1)};return(a,s)=>(l(),p(g,null,[m("div",I({class:"node-wrapper"},i(d)),[L(a.$slots,"default",{},void 0,!0),Re],16),t.isPreview?V("",!0):(l(),y(G,{key:0,modelValue:i(n),"onUpdate:modelValue":s[0]||(s[0]=u=>S(n)?n.value=u:null),"cur-node":t.modelValue,onAddBranch:c,onRemoveBranch:r},null,8,["modelValue","cur-node"]))],64))}},Pe=w(Ie,[["__scopeId","data-v-653f9187"]]),je={},Oe={class:"node-wrapper"},Ue=m("div",{class:"c-circle c-feat"}," Feat ",-1);function Me(t,e){return l(),p("div",Oe,[L(t.$slots,"default"),Ue])}const Te=w(je,[["render",Me]]),U=[{type:"start",component:N(ge),generateNode:()=>new f("start")},{type:"end",component:N(Ne),generateNode:()=>new f("end")},{type:"if",component:N(Se),generateNode:()=>new f("if")},{type:"switch",component:N(Pe),generateNode:(t=[[],[]])=>new f("switch",{branchList:t})},{type:"feat",component:N(Te),generateNode:()=>new f("feat")}],k=2,F=(t,e=k)=>{const o=t==null?void 0:t.filter(Array.isArray);return o!=null&&o.length?e?o.length>=e?o.slice(0,e):o.slice().concat(new Array(e-o.length).fill(0).map(n=>[])):o.slice():new Array(e).fill(0).map(n=>[])},M=class{constructor(e,o={branchList:[]}){const{branchList:n}=o;if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++M.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:U.some(d=>d.type===e)?e:"error"}),e==="if"){let d=F(n);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>d,set(c){if(c.length!==k)throw new D(`分支数量必须为${k}`);d=c}})}if(e==="switch"){let d=F(n,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>d,set(c){if(c.length<k)throw new D(`分支数量至少为${k}`);d=c}})}}};let f=M;T(f,"id",0);const Ee={type:"error",component:N(D),generateNode:()=>new f("error")},ze=["draggable"],Fe=m("div",{class:"line"},null,-1),Ye={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","addNode","subNode","update:nodeList"],setup(t,{emit:e}){const o=t,n=v({get:()=>o.modelValue,set:h=>e("update:modelValue",h)});v({get:()=>o.nodeList,set:h=>e("update:nodeList",h)});const d=v(()=>(U.find(h=>h.type===n.value.type)||Ee).component),c=Y("hoverStack"),r=v(()=>c.value[0]),a=()=>c.value.unshift(n.value),s=()=>c.value.shift(),u=h=>{console.log("dragstart"),h.dataTransfer.effectAllowed="move"},_=h=>{console.log("ondragend"),window.__custom_drop_instance&&window.__custom_drop_instance.emit("addNode",n.value)},b=se(),K=()=>{console.log("drop")},Q=h=>{window.__custom_drop_instance=b,console.log("dragenter")},W=h=>{window.__custom_drop_instance=null,console.log("dragleave")};return(h,$)=>(l(),p(g,null,[m("div",{draggable:!["start","end"].includes(i(n).type),class:ae(["node-box",{"hover-node":i(r)===i(n),"border-box":["if","switch"].includes(i(n).type)}]),onMouseenter:a,onMouseleave:s,onDragstart:u,onDragend:_},[(l(),y(X(i(d)),{modelValue:i(n),"onUpdate:modelValue":$[1]||($[1]=x=>S(n)?n.value=x:null)},{default:oe(()=>[C(q,{onToSub:$[0]||($[0]=x=>e("subNode"))})]),_:1},8,["modelValue"]))],42,ze),i(n).type!=="end"?(l(),p(g,{key:0},[Fe,C(j,{droppable:!0,onToAdd:$[2]||($[2]=x=>e("addNode",x)),onDrop:K,onDragenter:A(Q,["prevent"]),onDragleave:A(W,["prevent"])},null,8,["onDragenter","onDragleave"])],64)):V("",!0)],64))}},He={class:"render-list-wrapper"},Xe=m("div",{class:"line"},null,-1),J={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1}},emits:["update:modelValue","removeBranch"],setup(t,{emit:e}){const o=t,n=v({get:()=>o.modelValue,set:r=>e("update:modelValue",r)}),d=(r,a)=>{const s=a.generateNode();n.value.splice(r+1,0,s)},c=r=>{n.value.splice(r,1)};return(r,a)=>(l(),p("div",He,[t.startLine?(l(),p(g,{key:0},[t.branchCount>2?(l(),y(q,{key:0,onClick:a[0]||(a[0]=s=>e("removeBranch"))})):V("",!0),Xe,C(j,{onToAdd:a[1]||(a[1]=s=>d(-1,s))})],64)):V("",!0),(l(!0),p(g,null,P(i(n),(s,u)=>(l(),y(Ye,{key:s.id,modelValue:i(n)[u],"onUpdate:modelValue":_=>i(n)[u]=_,"node-list":i(n),"onUpdate:nodeList":a[2]||(a[2]=_=>S(n)?n.value=_:null),onAddNode:_=>d(u,_),onSubNode:()=>c(u)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode"]))),128))]))}};const qe={class:"select-node-wrapper"},Ge={__name:"AddNodeDialog",setup(t,{expose:e}){const o=B({x:1,y:1}),n=B(!1);let d;const c=(u,_)=>{d=_,o.value=u,n.value=!0},r=()=>{n.value=!1},a=u=>{r(),d(u)},s=B(U.filter(u=>!["start","end"].includes(u.type)));return e({show:c,close:r}),(u,_)=>re((l(),p("div",{class:"add-node-dialog",style:H({"--var-dialog-left":`${o.value.x}px`,"--var-dialog-top":`${o.value.y}px`,"--var-dialog-size":n.value?"300px":"0"})},[m("div",qe,[(l(!0),p(g,null,P(s.value,b=>(l(),y(X(b.component),{key:b.type,"is-preview":!0,onClick:()=>a(b)},null,8,["onClick"]))),128))])],4)),[[i(le),r]])}},Je=w(Ge,[["__scopeId","data-v-97bc81a4"]]);const Ke={id:"canvas-main",class:"canvas-main"},Qe={__name:"Main",setup(t){const e=B([new f("start"),new f("feat"),new f("if",{branchList:[]}),new f("switch",{branchList:[[new f("feat")],[new f("feat")],[new f("feat")]]}),new f("end")]);console.log(e.value);const o=B(null);E("addNodeDialogRef",o);const n=B([]);return E("hoverStack",n),(d,c)=>(l(),p("div",Ke,[C(J,{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=r=>e.value=r),"start-line":!1},null,8,["modelValue"]),C(Je,{ref_key:"addNodeDialogRef",ref:o},null,512)]))}},We=w(Qe,[["__scopeId","data-v-9484df20"]]),ot={__name:"index",setup(t){return(e,o)=>(l(),y(We))}};export{ot as default};
