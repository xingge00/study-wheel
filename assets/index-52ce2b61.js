var Me=Object.defineProperty;var Re=(t,n,a)=>n in t?Me(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;var Ne=(t,n,a)=>(Re(t,typeof n!="symbol"?n+"":n,a),a);import{a as Fe,d as Oe,l as ae,i as ue,c as Ue,_ as je,w as ze}from"./base-a164ee90.js";import{i as we,a as He,b as Ke,d as qe,c as Ge,E as We}from"./el-button-222ce6e7.js";import{l as ie,A as ke,v as V,r as B,d as Q,k as Xe,o as v,c as D,L as I,i as l,E,R as Ye,C,w as P,D as J,G as S,V as F,b as O,H as Z,S as G,j as ne,n as Qe,ar as De,_ as M,$ as oe,t as U,M as q,F as T,B as le,U as K,a0 as se,am as me,an as he,as as W,a4 as Le,Q as _e,a as j,at as Ie,a2 as Je,a8 as Ze,I as ee}from"./index-a2021f7b.js";import{C as Be}from"./index-14309b08.js";import{E as et,a as tt}from"./el-tab-pane-362506ec.js";import{E as at,a as nt}from"./el-form-item-c3c57f44.js";import{E as ot,a as lt}from"./el-radio-button-820db238.js";import{E as st}from"./el-input-fc9754b5.js";import{u as rt,f as ct,E as te,l as ut}from"./index-34b3565c.js";import{i as it}from"./validator-6c3ec59e.js";import{U as de,C as ve,I as pe,d as dt,t as vt}from"./event-e06a23af.js";import"./index-22b8f683.js";import"./get-e7313515.js";import"./index-cd54cfc7.js";import"./typescript-defaf979.js";import"./strings-38c53b76.js";import"./aria-60e0cdc6.js";import"./vnode-57634ce3.js";import"./objects-370c3d2c.js";import"./isNil-c75b1b34.js";const pt=Fe({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:we},inactiveIcon:{type:we},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:Oe(Function)},size:{type:String,validator:it},tabindex:{type:[String,Number]}}),ft={[de]:t=>ae(t)||ie(t)||ue(t),[ve]:t=>ae(t)||ie(t)||ue(t),[pe]:t=>ae(t)||ie(t)||ue(t)},mt=["onClick"],ht=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],_t=["aria-hidden"],gt=["aria-hidden"],bt=["aria-hidden"],fe="ElSwitch",yt=ke({name:fe}),Nt=ke({...yt,props:pt,emits:ft,setup(t,{expose:n,emit:a}){const e=t,u=ne(),{formItem:s}=He(),i=Ke(),o=Ue("switch");rt({from:'"value"',replacement:'"model-value" or "v-model"',scope:fe,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},V(()=>{var c;return!!((c=u.vnode.props)!=null&&c.value)}));const{inputId:N}=qe(e,{formItemContext:s}),b=Ge(V(()=>e.loading)),w=B(e.modelValue!==!1),k=B(),$=B(),p=V(()=>[o.b(),o.m(i.value),o.is("disabled",b.value),o.is("checked",d.value)]),m=V(()=>({width:ct(e.width)}));Q(()=>e.modelValue,()=>{w.value=!0}),Q(()=>e.value,()=>{w.value=!1});const f=V(()=>w.value?e.modelValue:e.value),d=V(()=>f.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(f.value)||(a(de,e.inactiveValue),a(ve,e.inactiveValue),a(pe,e.inactiveValue)),Q(d,c=>{var _;k.value.checked=c,e.validateEvent&&((_=s==null?void 0:s.validate)==null||_.call(s,"change").catch(A=>dt()))});const y=()=>{const c=d.value?e.inactiveValue:e.activeValue;a(de,c),a(ve,c),a(pe,c),Qe(()=>{k.value.checked=d.value})},g=()=>{if(b.value)return;const{beforeChange:c}=e;if(!c){y();return}const _=c();[De(_),ae(_)].includes(!0)||vt(fe,"beforeChange must return type `Promise<boolean>` or `boolean`"),De(_)?_.then(R=>{R&&y()}).catch(R=>{}):_&&y()},r=V(()=>o.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),h=()=>{var c,_;(_=(c=k.value)==null?void 0:c.focus)==null||_.call(c)};return Xe(()=>{k.value.checked=d.value}),n({focus:h,checked:d}),(c,_)=>(v(),D("div",{class:E(l(p)),style:Z(l(r)),onClick:G(g,["prevent"])},[I("input",{id:l(N),ref_key:"input",ref:k,class:E(l(o).e("input")),type:"checkbox",role:"switch","aria-checked":l(d),"aria-disabled":l(b),name:c.name,"true-value":c.activeValue,"false-value":c.inactiveValue,disabled:l(b),tabindex:c.tabindex,onChange:y,onKeydown:Ye(g,["enter"])},null,42,ht),!c.inlinePrompt&&(c.inactiveIcon||c.inactiveText)?(v(),D("span",{key:0,class:E([l(o).e("label"),l(o).em("label","left"),l(o).is("active",!l(d))])},[c.inactiveIcon?(v(),C(l(te),{key:0},{default:P(()=>[(v(),C(J(c.inactiveIcon)))]),_:1})):S("v-if",!0),!c.inactiveIcon&&c.inactiveText?(v(),D("span",{key:1,"aria-hidden":l(d)},F(c.inactiveText),9,_t)):S("v-if",!0)],2)):S("v-if",!0),I("span",{ref_key:"core",ref:$,class:E(l(o).e("core")),style:Z(l(m))},[c.inlinePrompt?(v(),D("div",{key:0,class:E(l(o).e("inner"))},[c.activeIcon||c.inactiveIcon?(v(),C(l(te),{key:0,class:E(l(o).is("icon"))},{default:P(()=>[(v(),C(J(l(d)?c.activeIcon:c.inactiveIcon)))]),_:1},8,["class"])):c.activeText||c.inactiveText?(v(),D("span",{key:1,class:E(l(o).is("text")),"aria-hidden":!l(d)},F(l(d)?c.activeText:c.inactiveText),11,gt)):S("v-if",!0)],2)):S("v-if",!0),I("div",{class:E(l(o).e("action"))},[c.loading?(v(),C(l(te),{key:0,class:E(l(o).is("loading"))},{default:P(()=>[O(l(ut))]),_:1},8,["class"])):S("v-if",!0)],2)],6),!c.inlinePrompt&&(c.activeIcon||c.activeText)?(v(),D("span",{key:1,class:E([l(o).e("label"),l(o).em("label","right"),l(o).is("active",l(d))])},[c.activeIcon?(v(),C(l(te),{key:0},{default:P(()=>[(v(),C(J(c.activeIcon)))]),_:1})):S("v-if",!0),!c.activeIcon&&c.activeText?(v(),D("span",{key:1,"aria-hidden":!l(d)},F(c.activeText),9,bt)):S("v-if",!0)],2)):S("v-if",!0)],14,mt))}});var wt=je(Nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Dt=ze(wt);const It=["onClick"],Vt={key:0,class:"line"},$t={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(t,{emit:n}){const a=t,e=oe(),u=U("addNodeDialogRef"),s=b=>{if(b.id==="canvas-main"||!b)return{x:0,y:0};const w=s(b.offsetParent);return{x:w.x+b.offsetLeft,y:w.y+b.offsetTop}},i=b=>{n("toAdd",b)},o=ne(),N=b=>{if(a.addType==="branch")return n("toAdd");const{target:w,offsetY:k}=b,{x:$,y:p}=s(w);u.value.show({x:w.clientWidth+$,y:k+p},i,o)};return(b,w)=>(v(),D(T,null,[I("div",q({class:"add-node"},l(e),{onClick:G(N,["stop"])})," + ",16,It),t.endLine?(v(),D("div",Vt)):S("",!0)],64))}},ge=M($t,[["__scopeId","data-v-77b265a2"]]);const Ct=["onClick"],kt={__name:"SubBtn",emits:["toSub"],setup(t,{emit:n}){const a=U("hoverStack"),e=u=>{a.value=[],n("toSub")};return(u,s)=>(v(),D("div",{class:"sub-node",onClick:G(e,["stop"])}," - ",8,Ct))}},Se=M(kt,[["__scopeId","data-v-554bf87e"]]),Lt={},Bt={class:"node-wrapper"},St=I("div",{class:"c-circle c-start"}," start ",-1),At=[St];function xt(t,n){return v(),D("div",Bt,At)}const Et=M(Lt,[["render",xt]]),Tt={},Pt={class:"node-wrapper"},Mt=I("div",{class:"c-circle c-end"}," end ",-1),Rt=[Mt];function Ft(t,n){return v(),D("div",Pt,Rt)}const Ot=M(Tt,[["render",Ft]]),Ut={},jt={class:"node-wrapper"},zt=I("div",{class:"c-circle c-other"}," Error ",-1);function Ht(t,n){return v(),D("div",jt,[le(t.$slots,"default"),zt])}const Ae=M(Ut,[["render",Ht]]),be=t=>{var n;return t?(n=t==null?void 0:t.branchList)!=null&&n.length?t.branchList.reduce((a,e)=>a+Math.max(...e.map(u=>be(u)),1),0):1:0},Ve=t=>Array.isArray(t)?Math.max(...t.map(n=>be(n)),1):1,Kt=I("div",{class:"line"},null,-1),xe={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(t,{emit:n}){const a=t,e=V({get:()=>a.modelValue||[],set:r=>n("update:modelValue",r)}),u=V(()=>{var r,h,c,_,A,R,z;return console.log((r=a.curNode)==null?void 0:r.nodeInfo),((h=a.curNode)==null?void 0:h.type)==="switch"?(((_=(c=a.curNode)==null?void 0:c.nodeInfo)==null?void 0:_.branchInfoList)||[]).map(x=>x.branchName):((A=a.curNode)==null?void 0:A.type)==="if"?((z=(R=a.curNode)==null?void 0:R.nodeInfo)==null?void 0:z.trueBranchIdx)===1?["true","false"]:["false","true"]:[]}),s=V(()=>be(a.curNode)),i=V(()=>{var r;return Ve((r=e.value)==null?void 0:r[0])}),o=V(()=>{var r;return Ve((r=e.value)==null?void 0:r[e.value.length-1])}),N=U("activateNode"),b=U("hoverStack"),w=V(()=>b.value[0]),k=r=>b.value.unshift(e.value[r]),$=r=>b.value.shift(),p=B(null),m=r=>{p.value=r,e.value[r]},f=()=>{p.value=null},d=r=>{p.value!==null&&r.preventDefault()},y=r=>{if(p.value===r||p.value===null)return;let h=Math.min(p.value,r),c=Math.max(p.value,r);const _=e.value[p.value];for(;h<c;)p.value<r?e.value[h]=e.value[++h]:e.value[c]=e.value[--c],h===c&&(e.value[h]=_);p.value=null},g=r=>{N.value=e.value[r]};return(r,h)=>(v(),D(T,null,[Kt,["switch"].includes(t.curNode.type)?(v(),C(ge,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:h[0]||(h[0]=c=>n("addBranch"))})):S("",!0),I("div",{class:"branch-wrapper branch-wrapper-width",style:Z({"--var-col-count":l(s),"--var-first-branch-col-count":l(i),"--var-last-branch-col-count":l(o)})},[(v(!0),D(T,null,K(l(e),(c,_)=>(v(),C(Te,{key:_,modelValue:l(e)[_],"onUpdate:modelValue":A=>l(e)[_]=A,class:E({"hover-branch":l(w)===l(e)[_]||l(N)===l(e)[_],"can-drop-branch":p.value!==null&&p.value!==_}),"branch-count":l(e).length,"branch-name":l(u)[_],draggable:!0,onMouseenter:()=>k(_),onMouseleave:()=>$(),onRemoveBranch:()=>n("removeBranch",_),onDragstart:G(()=>m(_),["stop"]),onDragover:h[1]||(h[1]=A=>d(A)),onDropCapture:()=>y(_),onDragend:f,onClick:G(()=>g(_),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","branch-name","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},qt=I("div",{class:"c-circle c-if"}," if ",-1),Gt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:n}){const a=t,e=V({get:()=>a.modelValue.branchList,set:i=>n("update:modelValue",{...a.modelValue,branchList:i})}),u=oe(),s=i=>{var o;return i?(o=i==null?void 0:i.branchList)!=null&&o.length?i.branchList.reduce((N,b)=>N+Math.max(...b.map(w=>s(w)),1),0):1:0};return V(()=>s(a.modelValue)),(i,o)=>(v(),D(T,null,[I("div",q({class:"node-wrapper"},l(u)),[le(i.$slots,"default"),qt],16),t.isPreview?S("",!0):(v(),C(xe,{key:0,modelValue:l(e),"onUpdate:modelValue":o[0]||(o[0]=N=>se(e)?e.value=N:null),"cur-node":t.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Wt=t=>(me("data-v-653f9187"),t=t(),he(),t),Xt=Wt(()=>I("div",{class:"c-circle c-switch"}," switch ",-1)),Yt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:n}){const a=t,e=V({get:()=>a.modelValue.branchList||[],set:o=>n("update:modelValue",{...a.modelValue,branchList:o})}),u=oe(),s=()=>{e.value.push([])},i=o=>{e.value.splice(o,1)};return(o,N)=>(v(),D(T,null,[I("div",q({class:"node-wrapper"},l(u)),[le(o.$slots,"default",{},void 0,!0),Xt],16),t.isPreview?S("",!0):(v(),C(xe,{key:0,modelValue:l(e),"onUpdate:modelValue":N[0]||(N[0]=b=>se(e)?e.value=b:null),"cur-node":t.modelValue,onAddBranch:s,onRemoveBranch:i},null,8,["modelValue","cur-node"]))],64))}},Qt=M(Yt,[["__scopeId","data-v-653f9187"]]),Jt={},Zt={class:"node-wrapper"},ea=I("div",{class:"c-circle c-feat"}," Feat ",-1);function ta(t,n){return v(),D("div",Zt,[le(t.$slots,"default"),ea])}const aa=M(Jt,[["render",ta]]),ye=[{type:"start",component:W(Et),generateNode:()=>new L("start")},{type:"end",component:W(Ot),generateNode:()=>new L("end")},{type:"if",component:W(Gt),generateNode:()=>new L("if")},{type:"switch",component:W(Qt),generateNode:(t=[[],[]])=>new L("switch",{branchList:t})},{type:"feat",component:W(aa),generateNode:()=>new L("feat")}],X=2,$e=(t,n=X)=>{const a=t==null?void 0:t.filter(Array.isArray);return a!=null&&a.length?n?a.length>=n?a.slice(0,n):a.slice().concat(new Array(n-a.length).fill(0).map(e=>[])):a.slice():new Array(n).fill(0).map(e=>[])},Ce=()=>({code:""}),na=t=>{const a={if:{condition:"",trueBranchIdx:1},switch:{branchInfoList:[{branchName:"分支1",condition:""},{branchName:"分支2",condition:""}]}}[t]||{};return a.nodeName=t,a},H=class{constructor(n,a){const{branchList:e=[],nodeInfo:u={}}=a||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++H.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:ye.some(i=>i.type===n)?n:"error"}),n==="if"){const i=$e(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(i,{get(o,N,b){return Reflect.get(o,N,b)},set(o,N,b,w){return["0","1"].includes(N)?Reflect.set(o,N,b,w):(console.error(`分支数量必须为${X}`),!1)}})}})}if(n==="switch"){let i=$e(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>i,set(o){if(o.length<X)throw new Ae(`分支数量至少为${X}`);i=o}})}const s=na(this.type);Object.assign(s,u),Object.defineProperty(this,"nodeInfo",{configurable:!1,get(){return new Proxy(s,{get(i,o,N){return Reflect.get(i,o,N)},set(i,o,N,b){return console.log("修改了",i,"的",o,"为",N),Reflect.set(i,o,N,b)}})}})}static copyBranchList(n){return(n==null?void 0:n.map(a=>(a==null?void 0:a.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new H(this.type,{branchList:H.copyBranchList(this.branchList)})}static executeNode(n,a=[],e){e||(e=Ce());const{type:u,branchList:s}=n;let i;["if","switch"].includes(u)&&(i=H.executeList(s[0],a));const o={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${i.context.code}
        }
      `,switch:()=>`switch(){
        ${i.context.code}
      }
      `};return e.code+=o[u](),{result:a,context:e}}static executeList(n,a=[]){const e=Ce();return{result:n.reduce((s,i)=>H.executeNode(i,s,e).result,a),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((n,a)=>{let e=`${n},${a}:`;return Array.isArray(this[a])?e+=`[${this[a].toString()}]`:typeof this[a]=="number"?e+=`${this[a].toString()}`:typeof this[a]=="string"?e+=`"${this[a].toString()}"`:e+=`{${this[a].toString()}}`,e},"").slice(1)}}`}};let L=H;Ne(L,"id",0);const oa={type:"error",component:W(Ae),generateNode:()=>new L("error")},Ee=(t,n,a=null)=>{for(let e in t){e=e-0;const u=t[e];if(u===n)return{nodeList:t,parentNode:a,nodeIdx:e,branchIdx:null};for(let s in u.branchList||[]){s=s-0;const i=u.branchList[s];if(i===n)return{nodeList:i,parentNode:u,branchIdx:s,nodeIdx:null};const o=Ee(i,n,u);if(o)return o}}return null},Y=t=>{var e,u;const n=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],a=((u=window==null?void 0:window.__activateNode)==null?void 0:u.value)||null;return Ee(n||[],t||a)},la=["draggable","onDragstart","onClick"],sa=I("div",{class:"line"},null,-1),ra={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(t,{emit:n}){const a=t,e=V({get:()=>a.modelValue,set:h=>n("update:modelValue",h)}),u=V({get:()=>a.nodeList,set:h=>n("update:nodeList",h)}),s=V(()=>(ye.find(h=>h.type===e.value.type)||oa).component),i=U("hoverStack"),o=U("dragConf"),N=U("activateNode"),b=V(()=>i.value[0]),w=()=>i.value.unshift(e.value),k=()=>i.value.shift(),$=()=>{o.value.customDragData={node:e.value,curBranch:u.value,target:null};const h=[],c=(_,A)=>{var R;!A&&h.push(_),(R=_==null?void 0:_.branchList)!=null&&R.length&&_.branchList.forEach(z=>{h.push(z),z.forEach(x=>c(x))})};c(e.value,!0),o.value.dragFlag=!0,o.value.banDropNodeList=h},p=()=>{o.value.dragFlag=!1,o.value.banDropNodeList=[]},m=ne(),f=()=>{o.value.customDragData&&(o.value.banDropNodeList.includes(e)||Le(o.value.customDragData.target)===m&&(n("moveTo",o.value.customDragData.node,o.value.customDragData.curBranch),o.value.customDragData=null,i.value=[]))},d=()=>{o.value.customDragData&&(o.value.customDragData.target=m)},y=()=>{o.value.customDragData&&(o.value.customDragData.target=null)},g=h=>{o.value.dragFlag&&!o.value.banDropNodeList.includes(e.value)&&h.preventDefault()},r=()=>{N.value=e.value};return(h,c)=>(v(),D(T,null,[I("div",{draggable:!["start","end"].includes(l(e).type),class:E(["node-box",{"hover-node":l(b)===l(e)||l(N)===l(e),"no-branch-box":!["if","switch"].includes(l(e).type)}]),onMouseenter:w,onMouseleave:k,onDragstart:G($,["stop"]),onDragend:p,onClick:G(r,["stop"])},[(v(),C(J(l(s)),{modelValue:l(e),"onUpdate:modelValue":c[1]||(c[1]=_=>se(e)?e.value=_:null)},{default:P(()=>[O(Se,{onToSub:c[0]||(c[0]=_=>n("subNode"))})]),_:1},8,["modelValue"]))],42,la),l(e).type!=="end"?(v(),D(T,{key:0},[sa,O(ge,{class:E({canDropFlag:l(o).dragFlag&&!l(o).banDropNodeList.includes(l(e))}),onToAdd:c[2]||(c[2]=_=>n("addNode",_)),onDragover:g,onDrop:f,onDragenter:d,onDragleave:y},null,8,["class"])],64)):S("",!0)],64))}};const ca=t=>(me("data-v-982ace86"),t=t(),he(),t),ua=ca(()=>I("div",{class:"line"},null,-1)),ia={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1},branchName:{type:String,default:""}},emits:["update:modelValue","removeBranch"],setup(t,{emit:n}){const a=t,e=oe(),u=V({get:()=>a.modelValue,set:f=>n("update:modelValue",f)}),s=U("dragConf"),i=U("hoverStack"),o=(f,d)=>{const y=d.generateNode();u.value.splice(f+1,0,y)},N=(f,d,y)=>{const g=d.findIndex(r=>r===f);if(d===u.value){if(g===y+1||g===y)return;g>y?(d.splice(g,1),d.splice(y+1,0,f)):(d.splice(y+1,0,f),d.splice(g,1))}else d.splice(g,1),u.value.splice(y+1,0,f)},b=f=>{u.value.splice(f,1)},w=ne(),k=()=>{s.value.customDragData&&(s.value.banDropNodeList.includes(u)||Le(s.value.customDragData.target)===w&&(N(s.value.customDragData.node,s.value.customDragData.curBranch,-1),i.value=[],s.value.customDragData=null))},$=()=>{s.value.customDragData&&(s.value.customDragData.target=w)},p=()=>{s.value.customDragData&&(s.value.customDragData.target=null)},m=f=>{s.value.dragFlag&&!s.value.banDropNodeList.includes(u.value)&&f.preventDefault()};return(f,d)=>(v(),D("div",q({class:"render-list-wrapper"},l(e)),[t.startLine?(v(),D(T,{key:0},[t.branchCount>2?(v(),C(Se,{key:0,onClick:d[0]||(d[0]=y=>n("removeBranch"))})):S("",!0),I("div",{class:E(["branch-name",{placeholder:!t.branchName}])},F(t.branchName||"未命名"),3),ua,O(ge,{class:E({canDropFlag:l(s).dragFlag&&!l(s).banDropNodeList.includes(l(u))}),droppable:l(s).dragFlag&&!l(s).banDropNodeList.includes(l(u)),onToAdd:d[1]||(d[1]=y=>o(-1,y)),onDragover:m,onDrop:k,onDragenter:$,onDragleave:p},null,8,["class","droppable"])],64)):S("",!0),(v(!0),D(T,null,K(l(u),(y,g)=>(v(),C(ra,{key:y.id,modelValue:l(u)[g],"onUpdate:modelValue":r=>l(u)[g]=r,"node-list":l(u),"onUpdate:nodeList":d[2]||(d[2]=r=>se(u)?u.value=r:null),onAddNode:r=>o(g,r),onSubNode:()=>b(g),onMoveTo:(r,h)=>N(r,h,g)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}},Te=M(ia,[["__scopeId","data-v-982ace86"]]);const da={class:"select-node-wrapper"},va={__name:"AddNodeDialog",setup(t,{expose:n}){const a=B({x:1,y:1}),e=B(!1);let u,s;const i=()=>{e.value=!1,u=null,s=null},o=(w,k,$)=>{if(s===$)return i();s=$,u=k,a.value=w,e.value=!0},N=w=>{u==null||u(w),i()},b=B(ye.filter(w=>!["start","end"].includes(w.type)));return n({show:o,close:i}),(w,k)=>_e((v(),D("div",{class:"add-node-dialog",style:Z({"--var-dialog-left":`${a.value.x}px`,"--var-dialog-top":`${a.value.y}px`,"--var-dialog-size":e.value?"300px":"0"})},[I("div",da,[(v(!0),D(T,null,K(b.value,$=>(v(),C(J($.component),{key:$.type,"is-preview":!0,onClick:()=>N($)},null,8,["onClick"]))),128))])],4)),[[l(Be),i]])}},pa=M(va,[["__scopeId","data-v-7f77c4dd"]]);const fa={class:"tab-pane-content"},ma={class:"module-name"},ha={__name:"NodeInfo",setup(t){const n=U("activateNode"),a=V(()=>Array.isArray(n.value)),e=B(null),u=B(null);Q(()=>n.value,p=>{if(a.value){const{parentNode:m,branchIdx:f}=Y(n.value);u.value=f,e.value=m}else u.value=null,e.value=n.value},{deep:!0,immediate:!0});const s=V({get:()=>{var p;return((p=e.value)==null?void 0:p.nodeInfo)||{}},set:p=>{e.value.nodeInfo=p}}),i=p=>{const m=(d,y,g,r={})=>({label:d,field:y,type:g,...r});if(!p)return{};const f=({base:d=[],other:y=[]})=>({base:d.filter(g=>{var r;return(r=g==null?void 0:g.attrs)==null?void 0:r.length}),other:y.filter(g=>{var r;return(r=g==null?void 0:g.attrs)==null?void 0:r.length})});switch(p.type){case"if":return f({base:[{moduleName:"基本信息",attrs:[m("节点名称","nodeName","input"),m("判断条件","condition","input",{required:!0}),m("true分支索引","trueBranchIdx","radio",{options:[{label:1,value:1},{label:2,value:2}]})]},{moduleName:"分支信息",attrs:[m("分支名称","","input",{disabled:!0,defaultValue:`分支${u.value+1}`}),m("置为true分支","trueBranchIdx","switch",{activeValue:u.value===0?1:2,inactiveValue:u.value===0?2:1})].filter(d=>a.value)},{moduleName:"输入参数",attrs:[]},{moduleName:"输出参数",attrs:[]}],other:[]});case"switch":return f({base:[{moduleName:"基本信息",attrs:[m("节点名称","nodeName","input")]},{moduleName:"分支信息",attrs:[m("分支名称",`branchInfoList.${u.value}.branchName`,"input"),m("判断条件",`branchInfoList.${u.value}.condition`,"input",{required:!0})].filter(d=>a.value)}],other:[]});case"feat":return f({base:[{moduleName:"基本信息",attrs:[m("节点名称","nodeName","input")]}]});default:return{base:[],other:[]}}},o=V(()=>{const{base:p,other:m}=i(e.value);return[{label:"基础属性",modules:p},{label:"其他属性",modules:m}]}),N=B("基础属性"),b=V({get(){return p=>{const m=(p==null?void 0:p.split("."))||[];return m.reduce((f,d)=>(f==null?void 0:f[d])||void 0,m.length?s.value:void 0)}}}),w=p=>typeof p=="object"&&p!==null,k=(p,m)=>{const f=(m==null?void 0:m.split("."))||[];if(f.length)if(f.length===1)s.value[f[0]]=p;else{const d=f.pop();try{let y="nodeInfo";const g=f.reduce((r,h)=>(y+=`.${h}`,w(r[h])||(console.warn(`${y}不是一个对象，已强制转化为对象`),r[h]={}),r[h]),f.length?s.value:void 0);g[d]=p}catch(y){console.error(`nodeInfo数据异常，无法读取${m}字段`),console.error(y)}}},$=p=>({disabled:p==null?void 0:p.disabled,modelValue:p.field&&b.value(p.field)||p.defaultValue,onInput:m=>k(m,p.field),onChange:m=>k(m,p.field)});return(p,m)=>{const f=st,d=Dt,y=ot,g=lt,r=at,h=nt,c=et,_=tt;return v(),C(_,{modelValue:N.value,"onUpdate:modelValue":m[0]||(m[0]=A=>N.value=A),stretch:!0},{default:P(()=>[(v(!0),D(T,null,K(l(o),A=>(v(),C(c,{key:A.label,label:A.label,name:A.label},{default:P(()=>[O(h,{model:l(s),"label-width":"100px"},{default:P(()=>[j(F(l(s))+" ",1),I("div",fa,[(v(!0),D(T,null,K(A.modules,(R,z)=>(v(),D("div",{key:z,class:"module-content"},[I("div",ma,F(R.moduleName),1),(v(!0),D(T,null,K(R.attrs,(x,Pe)=>(v(),D("div",{key:Pe},[O(r,{label:x.label,rules:x.required&&[{required:!0,message:""}]},{default:P(()=>[x.type==="input"?(v(),C(f,Ie(q({key:0},$(x))),null,16)):x.type==="switch"?(v(),C(d,q({key:x},$(x),{"active-value":x.activeValue,"inactive-value":x.inactiveValue}),null,16,["active-value","inactive-value"])):x.type==="radio"?(v(),C(g,Ie(q({key:2},$(x))),{default:P(()=>[(v(!0),D(T,null,K(x.options,ce=>(v(),C(y,{key:ce.value,label:ce.label,value:ce.value},null,8,["label","value"]))),128))]),_:2},1040)):S("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},_a=M(ha,[["__scopeId","data-v-061c2b0c"]]);const ga={__name:"index",setup(t){const n="350px",a=U("activateNode"),e=B(null),u=B(!1);Q(()=>a.value,i=>{i&&(e.value=i,u.value=!0)});const s=()=>{u.value=!1,e.value=null};return(i,o)=>_e((v(),D("div",{style:Z({"--var-width":n,"--var-right":u.value?0:`-${n}`,"--var-opacity":Number(u.value)}),class:"custom-drawer"},[e.value?(v(),C(_a,{key:0})):S("",!0)],4)),[[l(Be),s]])}},ba=M(ga,[["__scopeId","data-v-3de69590"]]);const re=t=>(me("data-v-5ea59a69"),t=t(),he(),t),ya={style:{display:"inline-block","vertical-align":"top"}},Na=re(()=>I("br",null,null,-1)),wa=re(()=>I("br",null,null,-1)),Da=re(()=>I("br",null,null,-1)),Ia=re(()=>I("br",null,null,-1)),Va={__name:"Main",setup(t){const n=B([new L("start"),new L("feat"),new L("if",{branchList:[[new L("feat")]]}),new L("switch",{branchList:[[new L("feat")],[new L("feat")],[new L("feat")]]}),new L("end")]);window.__nodeList=n;const a=B(null);ee("addNodeDialogRef",a);const e=B([]);ee("hoverStack",e);const u=B({banDropNodeList:[],dragFlag:!1,customDragData:null});ee("dragConf",u);const s=B(null);ee("activateNode",s),window.__activateNode=s,Je(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const i=B(null),o=()=>{var r;const m=s.value;if(!m||["start","end"].includes(m.type))return;const{parentNode:f,branchIdx:d,nodeList:y,nodeIdx:g}=Y();if(Array.isArray(m)){if(((r=f.branchList)==null?void 0:r.length)<=X)throw new Error(`分支数量至少为${X},剪切失败！`);(f.branchList||[]).splice(d,1)}else y.splice(g,1);i.value={type:"shear",data:m}},N=()=>{const m=s.value;m&&(["start","end"].includes(m.type)||(i.value={type:"copy",data:m}))},b=m=>{if(!i.value)return;const{type:f,data:d}=i.value;if(!d||["end"].includes(s.value.type))return;const y={copyNode:()=>{if(!s.value||Array.isArray(s.value))return;const{nodeList:r,nodeIdx:h}=Y();console.log({branchNodeList:r,nodeIdx:h}),r.splice(h+1,0,d.copySelf())},shearNode:()=>{if(!s.value||Array.isArray(s.value))return;const{nodeList:r,nodeIdx:h}=Y();r.splice(h+1,0,d),i.value=null},copyBranch:()=>{var r;((r=s.value)==null?void 0:r.type)==="switch"&&s.value.branchList.push(d.map(h=>h.copySelf()))},shearBranch:()=>{var r;((r=s.value)==null?void 0:r.type)==="switch"&&(s.value.branchList.push(d),i.value=null)}},g=f+(Array.isArray(d)?"Branch":"Node");y[g]()},w=B(!0),k=()=>{w.value=!w.value},$=B(""),p=()=>{console.log("BaseNode.executeList(nodeList.value, [])",L.executeList(n.value,[]));const m=L.executeList(n.value,[]);$.value=m.context.code};return(m,f)=>{var g;const d=We,y=Ze("mousetrap");return v(),D(T,null,[I("div",{id:"canvas-main",class:"canvas-main",onClickCapture:f[1]||(f[1]=r=>s.value=null)},[O(d,{onClick:k},{default:P(()=>[j(" 快捷建："+F(w.value?"开启":"关闭"),1)]),_:1}),O(d,{onClick:p},{default:P(()=>[j(" 执行 ")]),_:1}),O(Te,{modelValue:n.value,"onUpdate:modelValue":f[0]||(f[0]=r=>n.value=r),"start-line":!1},null,8,["modelValue"]),I("div",ya,[j(" shearPlate: "+F(i.value)+" ",1),Na,j(" ParentNode: "+F(((g=l(Y)())==null?void 0:g.parentNode)||"null")+" ",1),wa,j(" activateNode: "+F(s.value)+" ",1),Da,I("pre",null,[j("      code"),Ia,j(`
      `+F($.value)+`
    `,1)])])],32),O(pa,{ref_key:"addNodeDialogRef",ref:a},null,512),O(l(ba)),w.value?_e((v(),D("div",{key:0,"onMod+c":f[2]||(f[2]=()=>N()),"onMod+x":f[3]||(f[3]=()=>o()),"onMod+v":b},null,544)),[[y,["mod+c","mod+v","mod+x"]]]):S("",!0)],64)}}},$a=M(Va,[["__scopeId","data-v-5ea59a69"]]),Wa={__name:"index",setup(t){return(n,a)=>(v(),C($a))}};export{Wa as default};
