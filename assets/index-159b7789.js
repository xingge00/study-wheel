var Me=Object.defineProperty;var Re=(n,t,a)=>t in n?Me(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var be=(n,t,a)=>(Re(n,typeof t!="symbol"?t+"":t,a),a);import{a as Fe,d as Oe,l as ae,i as ue,c as Ue,_ as je,w as ze}from"./base-fc88d408.js";import{i as ye,a as He,b as Ke,d as qe,c as Ge,E as We}from"./el-button-7c2dd60d.js";import{l as ie,A as $e,v as I,r as B,d as Y,k as Xe,o as v,c as D,L as V,i as l,E as T,R as Ye,C,w as P,D as Q,G as S,V as M,b as R,H as J,S as q,j as ne,n as Qe,ar as Ne,_ as O,$ as oe,t as F,M as K,F as A,B as le,a as U,U as H,a0 as se,am as Ce,an as ke,as as G,a4 as Le,Q as me,at as we,a2 as Je,a8 as Ze,I as ee}from"./index-275378bc.js";import{C as Be}from"./index-e584593d.js";import{E as et,a as tt}from"./el-tab-pane-8dabadd1.js";import{E as at,a as nt}from"./el-form-item-9d7c5f46.js";import{E as ot,a as lt}from"./el-radio-button-3d71de66.js";import{E as st}from"./el-input-8a67cc8e.js";import{u as rt,f as ct,E as te,l as ut}from"./index-93923ab1.js";import{i as it}from"./validator-65102801.js";import{U as de,C as ve,I as pe,d as dt,t as vt}from"./event-e06a23af.js";import"./index-792503c0.js";import"./get-e7313515.js";import"./index-fcacae8c.js";import"./typescript-defaf979.js";import"./strings-0248e459.js";import"./aria-60e0cdc6.js";import"./vnode-015650a5.js";import"./objects-d8c7a786.js";import"./isNil-c75b1b34.js";const pt=Fe({modelValue:{type:[Boolean,String,Number],default:!1},value:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:!1},width:{type:[String,Number],default:""},inlinePrompt:{type:Boolean,default:!1},activeIcon:{type:ye},inactiveIcon:{type:ye},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},borderColor:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},id:String,loading:{type:Boolean,default:!1},beforeChange:{type:Oe(Function)},size:{type:String,validator:it},tabindex:{type:[String,Number]}}),ft={[de]:n=>ae(n)||ie(n)||ue(n),[ve]:n=>ae(n)||ie(n)||ue(n),[pe]:n=>ae(n)||ie(n)||ue(n)},mt=["onClick"],ht=["id","aria-checked","aria-disabled","name","true-value","false-value","disabled","tabindex","onKeydown"],_t=["aria-hidden"],gt=["aria-hidden"],bt=["aria-hidden"],fe="ElSwitch",yt=$e({name:fe}),Nt=$e({...yt,props:pt,emits:ft,setup(n,{expose:t,emit:a}){const e=n,u=ne(),{formItem:s}=He(),i=Ke(),o=Ue("switch");rt({from:'"value"',replacement:'"model-value" or "v-model"',scope:fe,version:"2.3.0",ref:"https://element-plus.org/en-US/component/switch.html#attributes",type:"Attribute"},I(()=>{var c;return!!((c=u.vnode.props)!=null&&c.value)}));const{inputId:N}=qe(e,{formItemContext:s}),g=Ge(I(()=>e.loading)),w=B(e.modelValue!==!1),k=B(),$=B(),p=I(()=>[o.b(),o.m(i.value),o.is("disabled",g.value),o.is("checked",d.value)]),m=I(()=>({width:ct(e.width)}));Y(()=>e.modelValue,()=>{w.value=!0}),Y(()=>e.value,()=>{w.value=!1});const f=I(()=>w.value?e.modelValue:e.value),d=I(()=>f.value===e.activeValue);[e.activeValue,e.inactiveValue].includes(f.value)||(a(de,e.inactiveValue),a(ve,e.inactiveValue),a(pe,e.inactiveValue)),Y(d,c=>{var y;k.value.checked=c,e.validateEvent&&((y=s==null?void 0:s.validate)==null||y.call(s,"change").catch(x=>dt()))});const b=()=>{const c=d.value?e.inactiveValue:e.activeValue;a(de,c),a(ve,c),a(pe,c),Qe(()=>{k.value.checked=d.value})},_=()=>{if(g.value)return;const{beforeChange:c}=e;if(!c){b();return}const y=c();[Ne(y),ae(y)].includes(!0)||vt(fe,"beforeChange must return type `Promise<boolean>` or `boolean`"),Ne(y)?y.then(j=>{j&&b()}).catch(j=>{}):y&&b()},r=I(()=>o.cssVarBlock({...e.activeColor?{"on-color":e.activeColor}:null,...e.inactiveColor?{"off-color":e.inactiveColor}:null,...e.borderColor?{"border-color":e.borderColor}:null})),h=()=>{var c,y;(y=(c=k.value)==null?void 0:c.focus)==null||y.call(c)};return Xe(()=>{k.value.checked=d.value}),t({focus:h,checked:d}),(c,y)=>(v(),D("div",{class:T(l(p)),style:J(l(r)),onClick:q(_,["prevent"])},[V("input",{id:l(N),ref_key:"input",ref:k,class:T(l(o).e("input")),type:"checkbox",role:"switch","aria-checked":l(d),"aria-disabled":l(g),name:c.name,"true-value":c.activeValue,"false-value":c.inactiveValue,disabled:l(g),tabindex:c.tabindex,onChange:b,onKeydown:Ye(_,["enter"])},null,42,ht),!c.inlinePrompt&&(c.inactiveIcon||c.inactiveText)?(v(),D("span",{key:0,class:T([l(o).e("label"),l(o).em("label","left"),l(o).is("active",!l(d))])},[c.inactiveIcon?(v(),C(l(te),{key:0},{default:P(()=>[(v(),C(Q(c.inactiveIcon)))]),_:1})):S("v-if",!0),!c.inactiveIcon&&c.inactiveText?(v(),D("span",{key:1,"aria-hidden":l(d)},M(c.inactiveText),9,_t)):S("v-if",!0)],2)):S("v-if",!0),V("span",{ref_key:"core",ref:$,class:T(l(o).e("core")),style:J(l(m))},[c.inlinePrompt?(v(),D("div",{key:0,class:T(l(o).e("inner"))},[c.activeIcon||c.inactiveIcon?(v(),C(l(te),{key:0,class:T(l(o).is("icon"))},{default:P(()=>[(v(),C(Q(l(d)?c.activeIcon:c.inactiveIcon)))]),_:1},8,["class"])):c.activeText||c.inactiveText?(v(),D("span",{key:1,class:T(l(o).is("text")),"aria-hidden":!l(d)},M(l(d)?c.activeText:c.inactiveText),11,gt)):S("v-if",!0)],2)):S("v-if",!0),V("div",{class:T(l(o).e("action"))},[c.loading?(v(),C(l(te),{key:0,class:T(l(o).is("loading"))},{default:P(()=>[R(l(ut))]),_:1},8,["class"])):S("v-if",!0)],2)],6),!c.inlinePrompt&&(c.activeIcon||c.activeText)?(v(),D("span",{key:1,class:T([l(o).e("label"),l(o).em("label","right"),l(o).is("active",l(d))])},[c.activeIcon?(v(),C(l(te),{key:0},{default:P(()=>[(v(),C(Q(c.activeIcon)))]),_:1})):S("v-if",!0),!c.activeIcon&&c.activeText?(v(),D("span",{key:1,"aria-hidden":!l(d)},M(c.activeText),9,bt)):S("v-if",!0)],2)):S("v-if",!0)],14,mt))}});var wt=je(Nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Dt=ze(wt);const Vt=["onClick"],It={key:0,class:"line"},$t={__name:"AddNodeBtn",props:{endLine:{type:Boolean,default:!0},addType:{type:String,default:"node"}},emits:["toAdd"],setup(n,{emit:t}){const a=n,e=oe(),u=F("addNodeDialogRef"),s=g=>{if(g.id==="canvas-main"||!g)return{x:0,y:0};const w=s(g.offsetParent);return{x:w.x+g.offsetLeft,y:w.y+g.offsetTop}},i=g=>{t("toAdd",g)},o=ne(),N=g=>{if(a.addType==="branch")return t("toAdd");const{target:w,offsetY:k}=g,{x:$,y:p}=s(w);u.value.show({x:w.clientWidth+$,y:k+p},i,o)};return(g,w)=>(v(),D(A,null,[V("div",K({class:"add-node"},l(e),{onClick:q(N,["stop"])})," + ",16,Vt),n.endLine?(v(),D("div",It)):S("",!0)],64))}},he=O($t,[["__scopeId","data-v-77b265a2"]]);const Ct=["onClick"],kt={__name:"SubBtn",emits:["toSub"],setup(n,{emit:t}){const a=F("hoverStack"),e=u=>{a.value=[],t("toSub")};return(u,s)=>(v(),D("div",{class:"sub-node",onClick:q(e,["stop"])}," - ",8,Ct))}},Se=O(kt,[["__scopeId","data-v-554bf87e"]]),Lt={},Bt={class:"node-wrapper"},St=V("div",{class:"c-circle c-start"}," start ",-1),At=[St];function xt(n,t){return v(),D("div",Bt,At)}const Et=O(Lt,[["render",xt]]),Tt={},Pt={class:"node-wrapper"},Mt=V("div",{class:"c-circle c-end"}," end ",-1),Rt=[Mt];function Ft(n,t){return v(),D("div",Pt,Rt)}const Ot=O(Tt,[["render",Ft]]),Ut={},jt={class:"node-wrapper"},zt=V("div",{class:"c-circle c-other"}," Error ",-1);function Ht(n,t){return v(),D("div",jt,[le(n.$slots,"default"),zt])}const Ae=O(Ut,[["render",Ht]]),_e=n=>{var t;return n?(t=n==null?void 0:n.branchList)!=null&&t.length?n.branchList.reduce((a,e)=>a+Math.max(...e.map(u=>_e(u)),1),0):1:0},De=n=>Array.isArray(n)?Math.max(...n.map(t=>_e(t)),1):1,Kt=V("div",{class:"line"},null,-1),xe={__name:"BranchRender",props:{modelValue:{type:Object,default:()=>({})},curNode:{type:Object,default:()=>({})}},emits:["addBranch","removeBranch","update:modelValue"],setup(n,{emit:t}){const a=n,e=I({get:()=>a.modelValue||[],set:r=>t("update:modelValue",r)}),u=I(()=>{var r,h;return(((h=(r=a.curNode)==null?void 0:r.nodeInfo)==null?void 0:h.branchInfoList)||[]).map(c=>c.branchName)}),s=I(()=>_e(a.curNode)),i=I(()=>{var r;return De((r=e.value)==null?void 0:r[0])}),o=I(()=>{var r;return De((r=e.value)==null?void 0:r[e.value.length-1])}),N=F("activateNode"),g=F("hoverStack"),w=I(()=>g.value[0]),k=r=>g.value.unshift(e.value[r]),$=r=>g.value.shift(),p=B(null),m=r=>{p.value=r,e.value[r]},f=()=>{p.value=null},d=r=>{p.value!==null&&r.preventDefault()},b=r=>{if(p.value===r||p.value===null)return;let h=Math.min(p.value,r),c=Math.max(p.value,r);const y=e.value[p.value];for(;h<c;)p.value<r?e.value[h]=e.value[++h]:e.value[c]=e.value[--c],h===c&&(e.value[h]=y);p.value=null},_=r=>{N.value=e.value[r]};return(r,h)=>(v(),D(A,null,[Kt,["switch"].includes(n.curNode.type)?(v(),C(he,{key:0,class:"on-bottom","end-line":!1,"add-type":"branch",onToAdd:h[0]||(h[0]=c=>t("addBranch"))})):S("",!0),V("div",{class:"branch-wrapper branch-wrapper-width",style:J({"--var-col-count":l(s),"--var-first-branch-col-count":l(i),"--var-last-branch-col-count":l(o)})},[U(M(l(u))+" ",1),(v(!0),D(A,null,H(l(e),(c,y)=>(v(),C(Te,{key:y,modelValue:l(e)[y],"onUpdate:modelValue":x=>l(e)[y]=x,class:T({"hover-branch":l(w)===l(e)[y]||l(N)===l(e)[y],"can-drop-branch":p.value!==null&&p.value!==y}),"branch-count":l(e).length,draggable:!0,onMouseenter:()=>k(y),onMouseleave:()=>$(),onRemoveBranch:()=>t("removeBranch",y),onDragstart:q(()=>m(y),["stop"]),onDragover:h[1]||(h[1]=x=>d(x)),onDropCapture:()=>b(y),onDragend:f,onClick:q(()=>_(y),["stop"])},null,8,["modelValue","onUpdate:modelValue","class","branch-count","onMouseenter","onMouseleave","onRemoveBranch","onDragstart","onDropCapture","onClick"]))),128))],4)],64))}},qt=V("div",{class:"c-circle c-if"}," if ",-1),Gt={__name:"If",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:t}){const a=n,e=I({get:()=>a.modelValue.branchList,set:i=>t("update:modelValue",{...a.modelValue,branchList:i})}),u=oe(),s=i=>{var o;return i?(o=i==null?void 0:i.branchList)!=null&&o.length?i.branchList.reduce((N,g)=>N+Math.max(...g.map(w=>s(w)),1),0):1:0};return I(()=>s(a.modelValue)),(i,o)=>(v(),D(A,null,[V("div",K({class:"node-wrapper"},l(u)),[le(i.$slots,"default"),qt],16),n.isPreview?S("",!0):(v(),C(xe,{key:0,modelValue:l(e),"onUpdate:modelValue":o[0]||(o[0]=N=>se(e)?e.value=N:null),"cur-node":n.modelValue},null,8,["modelValue","cur-node"]))],64))}};const Wt=n=>(Ce("data-v-653f9187"),n=n(),ke(),n),Xt=Wt(()=>V("div",{class:"c-circle c-switch"}," switch ",-1)),Yt={__name:"Switch",props:{modelValue:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:t}){const a=n,e=I({get:()=>a.modelValue.branchList||[],set:o=>t("update:modelValue",{...a.modelValue,branchList:o})}),u=oe(),s=()=>{e.value.push([])},i=o=>{e.value.splice(o,1)};return(o,N)=>(v(),D(A,null,[V("div",K({class:"node-wrapper"},l(u)),[le(o.$slots,"default",{},void 0,!0),Xt],16),n.isPreview?S("",!0):(v(),C(xe,{key:0,modelValue:l(e),"onUpdate:modelValue":N[0]||(N[0]=g=>se(e)?e.value=g:null),"cur-node":n.modelValue,onAddBranch:s,onRemoveBranch:i},null,8,["modelValue","cur-node"]))],64))}},Qt=O(Yt,[["__scopeId","data-v-653f9187"]]),Jt={},Zt={class:"node-wrapper"},ea=V("div",{class:"c-circle c-feat"}," Feat ",-1);function ta(n,t){return v(),D("div",Zt,[le(n.$slots,"default"),ea])}const aa=O(Jt,[["render",ta]]),ge=[{type:"start",component:G(Et),generateNode:()=>new L("start")},{type:"end",component:G(Ot),generateNode:()=>new L("end")},{type:"if",component:G(Gt),generateNode:()=>new L("if")},{type:"switch",component:G(Qt),generateNode:(n=[[],[]])=>new L("switch",{branchList:n})},{type:"feat",component:G(aa),generateNode:()=>new L("feat")}],W=2,Ve=(n,t=W)=>{const a=n==null?void 0:n.filter(Array.isArray);return a!=null&&a.length?t?a.length>=t?a.slice(0,t):a.slice().concat(new Array(t-a.length).fill(0).map(e=>[])):a.slice():new Array(t).fill(0).map(e=>[])},Ie=()=>({code:""}),na=n=>{const a={if:{condition:"",trueBranchIdx:1},switch:{branchInfoList:[{branchName:"分支1",condition:""},{branchName:"分支2",condition:""}]}}[n]||{};return a.nodeName=n,a},z=class{constructor(t,a){const{branchList:e=[],nodeInfo:u={}}=a||{};if(Object.defineProperty(this,"id",{configurable:!1,writable:!1,value:++z.id}),Object.defineProperty(this,"type",{configurable:!1,writable:!1,value:ge.some(i=>i.type===t)?t:"error"}),t==="if"){const i=Ve(e);Object.defineProperty(this,"branchList",{configurable:!1,get(){return new Proxy(i,{get(o,N,g){return Reflect.get(o,N,g)},set(o,N,g,w){return["0","1"].includes(N)?Reflect.set(o,N,g,w):(console.error(`分支数量必须为${W}`),!1)}})}})}if(t==="switch"){let i=Ve(e,0);Object.defineProperty(this,"branchList",{configurable:!1,get:()=>i,set(o){if(o.length<W)throw new Ae(`分支数量至少为${W}`);i=o}})}const s=na(this.type);Object.assign(s,u),Object.defineProperty(this,"nodeInfo",{configurable:!1,get(){return new Proxy(s,{get(i,o,N){return Reflect.get(i,o,N)},set(i,o,N,g){return console.log("修改了",i,"的",o,"为",N),Reflect.set(i,o,N,g)}})}})}static copyBranchList(t){return(t==null?void 0:t.map(a=>(a==null?void 0:a.map(e=>e.copySelf()))||[]))||[]}copySelf(){return new z(this.type,{branchList:z.copyBranchList(this.branchList)})}static executeNode(t,a=[],e){e||(e=Ie());const{type:u,branchList:s}=t;let i;["if","switch"].includes(u)&&(i=z.executeList(s[0],a));const o={start:()=>`start
      `,feat:()=>`feat
      `,end:()=>`end
      `,if:()=>`if(){
        ${i.context.code}
        }
      `,switch:()=>`switch(){
        ${i.context.code}
      }
      `};return e.code+=o[u](),{result:a,context:e}}static executeList(t,a=[]){const e=Ie();return{result:t.reduce((s,i)=>z.executeNode(i,s,e).result,a),context:e}}toString(){return`{${Object.getOwnPropertyNames(this).reduce((t,a)=>{let e=`${t},${a}:`;return Array.isArray(this[a])?e+=`[${this[a].toString()}]`:typeof this[a]=="number"?e+=`${this[a].toString()}`:typeof this[a]=="string"?e+=`"${this[a].toString()}"`:e+=`{${this[a].toString()}}`,e},"").slice(1)}}`}};let L=z;be(L,"id",0);const oa={type:"error",component:G(Ae),generateNode:()=>new L("error")},Ee=(n,t,a=null)=>{for(let e in n){e=e-0;const u=n[e];if(u===t)return{nodeList:n,parentNode:a,nodeIdx:e,branchIdx:null};for(let s in u.branchList||[]){s=s-0;const i=u.branchList[s];if(i===t)return{nodeList:i,parentNode:u,branchIdx:s,nodeIdx:null};const o=Ee(i,t,u);if(o)return o}}return null},X=n=>{var e,u;const t=((e=window==null?void 0:window.__nodeList)==null?void 0:e.value)||[],a=((u=window==null?void 0:window.__activateNode)==null?void 0:u.value)||null;return Ee(t||[],n||a)},la=["draggable","onDragstart","onClick"],sa=V("div",{class:"line"},null,-1),ra={__name:"RenderItem",props:{modelValue:{type:Object,default:()=>({})},nodeList:{type:Array,default:()=>[]}},emits:["update:modelValue","update:nodeList","addNode","subNode","moveTo"],setup(n,{emit:t}){const a=n,e=I({get:()=>a.modelValue,set:h=>t("update:modelValue",h)}),u=I({get:()=>a.nodeList,set:h=>t("update:nodeList",h)}),s=I(()=>(ge.find(h=>h.type===e.value.type)||oa).component),i=F("hoverStack"),o=F("dragConf"),N=F("activateNode"),g=I(()=>i.value[0]),w=()=>i.value.unshift(e.value),k=()=>i.value.shift(),$=()=>{o.value.customDragData={node:e.value,curBranch:u.value,target:null};const h=[],c=(y,x)=>{var j;!x&&h.push(y),(j=y==null?void 0:y.branchList)!=null&&j.length&&y.branchList.forEach(Z=>{h.push(Z),Z.forEach(E=>c(E))})};c(e.value,!0),o.value.dragFlag=!0,o.value.banDropNodeList=h},p=()=>{o.value.dragFlag=!1,o.value.banDropNodeList=[]},m=ne(),f=()=>{o.value.customDragData&&(o.value.banDropNodeList.includes(e)||Le(o.value.customDragData.target)===m&&(t("moveTo",o.value.customDragData.node,o.value.customDragData.curBranch),o.value.customDragData=null,i.value=[]))},d=()=>{o.value.customDragData&&(o.value.customDragData.target=m)},b=()=>{o.value.customDragData&&(o.value.customDragData.target=null)},_=h=>{o.value.dragFlag&&!o.value.banDropNodeList.includes(e.value)&&h.preventDefault()},r=()=>{N.value=e.value};return(h,c)=>(v(),D(A,null,[V("div",{draggable:!["start","end"].includes(l(e).type),class:T(["node-box",{"hover-node":l(g)===l(e)||l(N)===l(e),"no-branch-box":!["if","switch"].includes(l(e).type)}]),onMouseenter:w,onMouseleave:k,onDragstart:q($,["stop"]),onDragend:p,onClick:q(r,["stop"])},[(v(),C(Q(l(s)),{modelValue:l(e),"onUpdate:modelValue":c[1]||(c[1]=y=>se(e)?e.value=y:null)},{default:P(()=>[R(Se,{onToSub:c[0]||(c[0]=y=>t("subNode"))})]),_:1},8,["modelValue"]))],42,la),l(e).type!=="end"?(v(),D(A,{key:0},[sa,R(he,{class:T({canDropFlag:l(o).dragFlag&&!l(o).banDropNodeList.includes(l(e))}),onToAdd:c[2]||(c[2]=y=>t("addNode",y)),onDragover:_,onDrop:f,onDragenter:d,onDragleave:b},null,8,["class"])],64)):S("",!0)],64))}},ca=V("div",{class:"line"},null,-1),Te={__name:"RenderList",props:{modelValue:{type:Array,default:()=>[]},startLine:{type:Boolean,default:!0},branchCount:{type:Number,default:1}},emits:["update:modelValue","removeBranch"],setup(n,{emit:t}){const a=n,e=oe(),u=I({get:()=>a.modelValue,set:f=>t("update:modelValue",f)}),s=F("dragConf"),i=F("hoverStack"),o=(f,d)=>{const b=d.generateNode();u.value.splice(f+1,0,b)},N=(f,d,b)=>{const _=d.findIndex(r=>r===f);if(d===u.value){if(_===b+1||_===b)return;_>b?(d.splice(_,1),d.splice(b+1,0,f)):(d.splice(b+1,0,f),d.splice(_,1))}else d.splice(_,1),u.value.splice(b+1,0,f)},g=f=>{u.value.splice(f,1)},w=ne(),k=()=>{s.value.customDragData&&(s.value.banDropNodeList.includes(u)||Le(s.value.customDragData.target)===w&&(N(s.value.customDragData.node,s.value.customDragData.curBranch,-1),i.value=[],s.value.customDragData=null))},$=()=>{s.value.customDragData&&(s.value.customDragData.target=w)},p=()=>{s.value.customDragData&&(s.value.customDragData.target=null)},m=f=>{s.value.dragFlag&&!s.value.banDropNodeList.includes(u.value)&&f.preventDefault()};return(f,d)=>(v(),D("div",K({class:"render-list-wrapper"},l(e)),[n.startLine?(v(),D(A,{key:0},[n.branchCount>2?(v(),C(Se,{key:0,onClick:d[0]||(d[0]=b=>t("removeBranch"))})):S("",!0),ca,R(he,{class:T({canDropFlag:l(s).dragFlag&&!l(s).banDropNodeList.includes(l(u))}),droppable:l(s).dragFlag&&!l(s).banDropNodeList.includes(l(u)),onToAdd:d[1]||(d[1]=b=>o(-1,b)),onDragover:m,onDrop:k,onDragenter:$,onDragleave:p},null,8,["class","droppable"])],64)):S("",!0),(v(!0),D(A,null,H(l(u),(b,_)=>(v(),C(ra,{key:b.id,modelValue:l(u)[_],"onUpdate:modelValue":r=>l(u)[_]=r,"node-list":l(u),"onUpdate:nodeList":d[2]||(d[2]=r=>se(u)?u.value=r:null),onAddNode:r=>o(_,r),onSubNode:()=>g(_),onMoveTo:(r,h)=>N(r,h,_)},null,8,["modelValue","onUpdate:modelValue","node-list","onAddNode","onSubNode","onMoveTo"]))),128))],16))}};const ua={class:"select-node-wrapper"},ia={__name:"AddNodeDialog",setup(n,{expose:t}){const a=B({x:1,y:1}),e=B(!1);let u,s;const i=()=>{e.value=!1,u=null,s=null},o=(w,k,$)=>{if(s===$)return i();s=$,u=k,a.value=w,e.value=!0},N=w=>{u==null||u(w),i()},g=B(ge.filter(w=>!["start","end"].includes(w.type)));return t({show:o,close:i}),(w,k)=>me((v(),D("div",{class:"add-node-dialog",style:J({"--var-dialog-left":`${a.value.x}px`,"--var-dialog-top":`${a.value.y}px`,"--var-dialog-size":e.value?"300px":"0"})},[V("div",ua,[(v(!0),D(A,null,H(g.value,$=>(v(),C(Q($.component),{key:$.type,"is-preview":!0,onClick:()=>N($)},null,8,["onClick"]))),128))])],4)),[[l(Be),i]])}},da=O(ia,[["__scopeId","data-v-7f77c4dd"]]);const va={class:"tab-pane-content"},pa={class:"module-name"},fa={__name:"NodeInfo",setup(n){const t=F("activateNode"),a=I(()=>Array.isArray(t.value)),e=B(null),u=B(null);Y(()=>t.value,p=>{if(a.value){const{parentNode:m,branchIdx:f}=X(t.value);u.value=f,e.value=m}else u.value=null,e.value=t.value},{deep:!0,immediate:!0});const s=I({get:()=>{var p;return((p=e.value)==null?void 0:p.nodeInfo)||{}},set:p=>{e.value.nodeInfo=p}}),i=p=>{const m=(d,b,_,r={})=>({label:d,field:b,type:_,...r});if(!p)return{};const f=({base:d=[],other:b=[]})=>({base:d.filter(_=>{var r;return(r=_==null?void 0:_.attrs)==null?void 0:r.length}),other:b.filter(_=>{var r;return(r=_==null?void 0:_.attrs)==null?void 0:r.length})});switch(p.type){case"if":return f({base:[{moduleName:"基本信息",attrs:[m("节点名称","nodeName","input"),m("判断条件","condition","input",{required:!0}),m("true分支索引","trueBranchIdx","radio",{options:[{label:1,value:1},{label:2,value:2}]})]},{moduleName:"分支信息",attrs:[m("分支名称","","input",{disabled:!0,defaultValue:`分支${u.value+1}`}),m("置为true分支","trueBranchIdx","switch",{activeValue:u.value===0?1:2,inactiveValue:u.value===0?2:1})].filter(d=>a.value)},{moduleName:"输入参数",attrs:[]},{moduleName:"输出参数",attrs:[]}],other:[]});case"switch":return f({base:[{moduleName:"基本信息",attrs:[m("节点名称","nodeName","input")]},{moduleName:"分支信息",attrs:[m("分支名称",`branchInfoList.${u.value}.branchName`,"input"),m("判断条件",`branchInfoList.${u.value}.condition`,"input",{required:!0})].filter(d=>a.value)}],other:[]});case"feat":return f({base:[{moduleName:"基本信息",attrs:[m("节点名称","nodeName","input")]}]});default:return{base:[],other:[]}}},o=I(()=>{const{base:p,other:m}=i(e.value);return[{label:"基础属性",modules:p},{label:"其他属性",modules:m}]}),N=B("基础属性"),g=I({get(){return p=>{const m=(p==null?void 0:p.split("."))||[];return m.reduce((f,d)=>(f==null?void 0:f[d])||void 0,m.length?s.value:void 0)}}}),w=p=>typeof p=="object"&&p!==null,k=(p,m)=>{const f=(m==null?void 0:m.split("."))||[];if(f.length)if(f.length===1)s.value[f[0]]=p;else{const d=f.pop();try{let b="nodeInfo";const _=f.reduce((r,h)=>(b+=`.${h}`,w(r[h])||(console.warn(`${b}不是一个对象，已强制转化为对象`),r[h]={}),r[h]),f.length?s.value:void 0);_[d]=p}catch(b){console.error(`nodeInfo数据异常，无法读取${m}字段`),console.error(b)}}},$=p=>({disabled:p==null?void 0:p.disabled,modelValue:p.field&&g.value(p.field)||p.defaultValue,onInput:m=>k(m,p.field),onChange:m=>k(m,p.field)});return(p,m)=>{const f=st,d=Dt,b=ot,_=lt,r=at,h=nt,c=et,y=tt;return v(),C(y,{modelValue:N.value,"onUpdate:modelValue":m[0]||(m[0]=x=>N.value=x),stretch:!0},{default:P(()=>[(v(!0),D(A,null,H(l(o),x=>(v(),C(c,{key:x.label,label:x.label,name:x.label},{default:P(()=>[R(h,{model:l(s),"label-width":"100px"},{default:P(()=>[U(M(l(s))+" ",1),V("div",va,[(v(!0),D(A,null,H(x.modules,(j,Z)=>(v(),D("div",{key:Z,class:"module-content"},[V("div",pa,M(j.moduleName),1),(v(!0),D(A,null,H(j.attrs,(E,Pe)=>(v(),D("div",{key:Pe},[R(r,{label:E.label,rules:E.required&&[{required:!0,message:""}]},{default:P(()=>[E.type==="input"?(v(),C(f,we(K({key:0},$(E))),null,16)):E.type==="switch"?(v(),C(d,K({key:E},$(E),{"active-value":E.activeValue,"inactive-value":E.inactiveValue}),null,16,["active-value","inactive-value"])):E.type==="radio"?(v(),C(_,we(K({key:2},$(E))),{default:P(()=>[(v(!0),D(A,null,H(E.options,ce=>(v(),C(b,{key:ce.value,label:ce.label,value:ce.value},null,8,["label","value"]))),128))]),_:2},1040)):S("",!0)]),_:2},1032,["label","rules"])]))),128))]))),128))])]),_:2},1032,["model"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}},ma=O(fa,[["__scopeId","data-v-dfa20d70"]]);const ha={__name:"index",setup(n){const t="350px",a=F("activateNode"),e=B(null),u=B(!1);Y(()=>a.value,i=>{i&&(e.value=i,u.value=!0)});const s=()=>{u.value=!1,e.value=null};return(i,o)=>me((v(),D("div",{style:J({"--var-width":t,"--var-right":u.value?0:`-${t}`,"--var-opacity":Number(u.value)}),class:"custom-drawer"},[e.value?(v(),C(ma,{key:0})):S("",!0)],4)),[[l(Be),s]])}},_a=O(ha,[["__scopeId","data-v-3de69590"]]);const re=n=>(Ce("data-v-5ea59a69"),n=n(),ke(),n),ga={style:{display:"inline-block","vertical-align":"top"}},ba=re(()=>V("br",null,null,-1)),ya=re(()=>V("br",null,null,-1)),Na=re(()=>V("br",null,null,-1)),wa=re(()=>V("br",null,null,-1)),Da={__name:"Main",setup(n){const t=B([new L("start"),new L("feat"),new L("if",{branchList:[[new L("feat")]]}),new L("switch",{branchList:[[new L("feat")],[new L("feat")],[new L("feat")]]}),new L("end")]);window.__nodeList=t;const a=B(null);ee("addNodeDialogRef",a);const e=B([]);ee("hoverStack",e);const u=B({banDropNodeList:[],dragFlag:!1,customDragData:null});ee("dragConf",u);const s=B(null);ee("activateNode",s),window.__activateNode=s,Je(()=>{window.__activateNode=void 0,window.__nodeList=void 0});const i=B(null),o=()=>{var r;const m=s.value;if(!m||["start","end"].includes(m.type))return;const{parentNode:f,branchIdx:d,nodeList:b,nodeIdx:_}=X();if(Array.isArray(m)){if(((r=f.branchList)==null?void 0:r.length)<=W)throw new Error(`分支数量至少为${W},剪切失败！`);(f.branchList||[]).splice(d,1)}else b.splice(_,1);i.value={type:"shear",data:m}},N=()=>{const m=s.value;m&&(["start","end"].includes(m.type)||(i.value={type:"copy",data:m}))},g=m=>{if(!i.value)return;const{type:f,data:d}=i.value;if(!d||["end"].includes(s.value.type))return;const b={copyNode:()=>{if(!s.value||Array.isArray(s.value))return;const{nodeList:r,nodeIdx:h}=X();console.log({branchNodeList:r,nodeIdx:h}),r.splice(h+1,0,d.copySelf())},shearNode:()=>{if(!s.value||Array.isArray(s.value))return;const{nodeList:r,nodeIdx:h}=X();r.splice(h+1,0,d),i.value=null},copyBranch:()=>{var r;((r=s.value)==null?void 0:r.type)==="switch"&&s.value.branchList.push(d.map(h=>h.copySelf()))},shearBranch:()=>{var r;((r=s.value)==null?void 0:r.type)==="switch"&&(s.value.branchList.push(d),i.value=null)}},_=f+(Array.isArray(d)?"Branch":"Node");b[_]()},w=B(!0),k=()=>{w.value=!w.value},$=B(""),p=()=>{console.log("BaseNode.executeList(nodeList.value, [])",L.executeList(t.value,[]));const m=L.executeList(t.value,[]);$.value=m.context.code};return(m,f)=>{var _;const d=We,b=Ze("mousetrap");return v(),D(A,null,[V("div",{id:"canvas-main",class:"canvas-main",onClickCapture:f[1]||(f[1]=r=>s.value=null)},[R(d,{onClick:k},{default:P(()=>[U(" 快捷建："+M(w.value?"开启":"关闭"),1)]),_:1}),R(d,{onClick:p},{default:P(()=>[U(" 执行 ")]),_:1}),R(Te,{modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=r=>t.value=r),"start-line":!1},null,8,["modelValue"]),V("div",ga,[U(" shearPlate: "+M(i.value)+" ",1),ba,U(" ParentNode: "+M(((_=l(X)())==null?void 0:_.parentNode)||"null")+" ",1),ya,U(" activateNode: "+M(s.value)+" ",1),Na,V("pre",null,[U("      code"),wa,U(`
      `+M($.value)+`
    `,1)])])],32),R(da,{ref_key:"addNodeDialogRef",ref:a},null,512),R(l(_a)),w.value?me((v(),D("div",{key:0,"onMod+c":f[2]||(f[2]=()=>N()),"onMod+x":f[3]||(f[3]=()=>o()),"onMod+v":g},null,544)),[[b,["mod+c","mod+v","mod+x"]]]):S("",!0)],64)}}},Va=O(Da,[["__scopeId","data-v-5ea59a69"]]),qa={__name:"index",setup(n){return(t,a)=>(v(),C(Va))}};export{qa as default};
